{"id":"tick-77cbba","title":"Portal","status":"done","priority":2,"created":"2026-02-22T21:28:04Z","updated":"2026-02-24T09:53:48Z","closed":"2026-02-24T09:53:48Z"}
{"id":"tick-57d5a4","title":"Phase 1: Walking Skeleton -- Session List and Attach","status":"done","priority":2,"parent":"tick-77cbba","created":"2026-02-22T21:28:07Z","updated":"2026-02-23T14:07:17Z","closed":"2026-02-23T14:07:17Z"}
{"id":"tick-fc2921","title":"Go Module and Cobra Root Command","status":"done","priority":2,"description":"**Problem**: No Go project exists yet. Portal needs an initialised Go module with a CLI framework (Cobra) and the portal open subcommand wired up as the entry point for the TUI.\n\n**Solution**: Initialise a Go module, add Cobra as a dependency, and create the root command (portal) with an open subcommand that prints a placeholder.\n\n**Outcome**: go build produces a portal binary. portal open prints a placeholder message and exits cleanly.\n\n**Do**:\n- Run go mod init github.com/leeovery/portal\n- Add Cobra dependency: go get github.com/spf13/cobra@latest\n- Add Bubble Tea dependency: go get github.com/charmbracelet/bubbletea@latest\n- Create main.go calling cmd.Execute()\n- Create cmd/root.go with root Cobra command\n- Create cmd/open.go with open subcommand\n- Ensure go build ./... and go vet ./... pass\n\n**Acceptance Criteria**:\n- [ ] go.mod exists with module path github.com/leeovery/portal\n- [ ] go.sum exists and Cobra + Bubble Tea are listed as dependencies\n- [ ] go build -o portal . produces a binary without errors\n- [ ] ./portal open prints a placeholder message and exits with code 0\n- [ ] ./portal --help shows usage including the open subcommand\n- [ ] go vet ./... reports no issues\n\n**Tests**:\n- root command executes without error\n- open subcommand is registered on root\n- open subcommand executes without error\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Architecture, CLI Interface, Dependencies sections.","parent":"tick-57d5a4","created":"2026-02-22T21:28:19Z","updated":"2026-02-23T13:03:53Z","closed":"2026-02-23T13:03:53Z"}
{"id":"tick-442b28","title":"tmux Session Listing and Parsing","status":"done","priority":2,"description":"**Problem**: Portal needs to query tmux for running sessions and parse the output into structured data. The tmux command may fail if no server is running.\n\n**Solution**: Create a tmux package with ListSessions() that runs tmux list-sessions -F '#{session_name}|#{session_windows}|#{session_attached}', parses each line into a Session struct. Handle no-server case by returning empty slice.\n\n**Outcome**: Tested tmux package with ListSessions() returning []Session with Name, Windows, Attached fields. Returns empty slice and nil error when no server running.\n\n**Do**:\n- Create internal/tmux/tmux.go with Session struct: Name string, Windows int, Attached bool\n- Define Commander interface with Run(args ...string) (string, error) for testability\n- Create Client struct with ListSessions() ([]Session, error)\n- Implement parsing: split by newlines, parse pipe-delimited fields\n- Handle non-zero exit (no server) -\u003e return empty slice, nil error\n- Create RealCommander using os/exec\n- Create internal/tmux/tmux_test.go with MockCommander\n\n**Acceptance Criteria**:\n- [ ] Session struct with Name, Windows, Attached fields\n- [ ] ListSessions() correctly parses multi-session output\n- [ ] Returns empty slice and nil error when tmux exits non-zero\n- [ ] Attached is true when session_attached \u003e 0\n- [ ] All tests pass\n\n**Tests**:\n- parses multiple sessions correctly\n- parses single session\n- returns empty slice when tmux server is not running\n- returns empty slice when output is empty\n- attached is true when session_attached \u003e 0\n- attached is false when session_attached is 0\n- handles session name with special characters\n\n**Edge Cases**:\n- No tmux server running: non-zero exit -\u003e empty slice, nil error\n- Empty session list: empty output -\u003e empty slice\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Session Info Display, Session Discovery, tmux Integration sections.","parent":"tick-57d5a4","created":"2026-02-22T21:28:33Z","updated":"2026-02-23T13:07:45Z","closed":"2026-02-23T13:07:45Z"}
{"id":"tick-afcc27","title":"Session List TUI Model","status":"done","priority":2,"description":"**Problem**: Portal needs a full-screen Bubble Tea TUI that displays running tmux sessions. The portal open command needs to launch a Bubble Tea program that fetches sessions and renders them with name, window count, and attached indicator.\n\n**Solution**: Create a Bubble Tea model in internal/tui/ that takes a tmux Client, calls ListSessions() on init, and renders a full-screen list. Wire portal open to launch with tea.NewProgram(model, tea.WithAltScreen()).\n\n**Outcome**: portal open launches full-screen TUI. Sessions appear in list with name, window count, attached indicator. First session highlighted by default. Sessions displayed in tmux list-sessions order (no additional sorting).\n\n**Do**:\n- Create internal/tui/model.go with Model struct: sessions []tmux.Session, cursor int, tmuxClient\n- Implement Init() returning command to fetch sessions\n- Define sessionsMsg type for async result\n- Implement Update() to handle sessionsMsg\n- Implement View() to render session list with cursor indicator, name, window count, attached indicator\n- Use Lip Gloss for styling\n- Update cmd/open.go to create Client, Model, and run tea.NewProgram\n- Create internal/tui/model_test.go\n- Preserve tmux list-sessions order; do not apply additional sorting\n\n**Acceptance Criteria**:\n- [ ] portal open launches full-screen alternate-screen TUI\n- [ ] Sessions appear with name, window count, attached indicator\n- [ ] Sessions displayed in tmux list-sessions order (no additional sorting)\n- [ ] Window count uses correct pluralisation (1 window vs N windows)\n- [ ] Attached sessions show indicator; detached do not\n- [ ] First session highlighted by default (cursor at 0)\n- [ ] All tests pass\n\n**Tests**:\n- view renders all session names\n- view shows window count for each session\n- view shows attached indicator\n- cursor starts at first session\n- single session renders correctly\n- long session name renders without truncation\n- sessions displayed in order returned by tmux (no sorting applied)\n\n**Edge Cases**:\n- Single session in list: must render correctly\n- Long session names: render fully, no truncation\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- TUI Design, Session Info Display, Sorting sections.","parent":"tick-57d5a4","created":"2026-02-22T21:28:49Z","updated":"2026-02-23T13:45:41Z","closed":"2026-02-23T13:45:41Z"}
{"id":"tick-27a6f2","title":"Keyboard Navigation","status":"done","priority":2,"description":"**Problem**: TUI renders a session list but does not respond to keyboard input for navigation. Users need to move cursor up/down using arrow keys and vim-style j/k keys.\n\n**Solution**: Add key message handling to Update function. Handle up/k (move up), down/j (move down). Clamp cursor to [0, len(sessions)-1].\n\n**Outcome**: Arrow keys and j/k move cursor through session list. Cursor clamps at boundaries (does not wrap). View reflects cursor position after each keypress.\n\n**Do**:\n- In internal/tui/model.go, extend Update to handle tea.KeyMsg\n- For KeyDown and 'j': increment cursor if cursor \u003c len(sessions)-1\n- For KeyUp and 'k': decrement cursor if cursor \u003e 0\n- Ensure cursor clamped: never \u003c 0, never \u003e len(sessions)-1\n- When len(sessions) == 0, navigation is no-op\n- Add tests in internal/tui/model_test.go\n\n**Acceptance Criteria**:\n- [ ] Down arrow or j moves cursor to next session\n- [ ] Up arrow or k moves cursor to previous session\n- [ ] Cursor does not go above first item\n- [ ] Cursor does not go below last item\n- [ ] View shows highlight on new cursor position\n- [ ] All tests pass\n\n**Tests**:\n- down arrow moves cursor down\n- j key moves cursor down\n- up arrow moves cursor up\n- k key moves cursor up\n- cursor does not go below last item\n- cursor does not go above first item\n- navigation is no-op with single session\n- view highlights correct row after navigation\n\n**Edge Cases**:\n- Single-item list: up/down are no-ops, cursor stays at 0\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Keyboard Shortcuts section.","parent":"tick-57d5a4","created":"2026-02-22T21:29:01Z","updated":"2026-02-23T13:55:27Z","closed":"2026-02-23T13:55:27Z"}
{"id":"tick-0f5439","title":"Quit Handling","status":"done","priority":2,"description":"**Problem**: TUI has no way to exit. Users need to quit cleanly with q or Esc.\n\n**Solution**: Add q and Esc key handling to Update. Return tea.Quit to cleanly exit and restore terminal state.\n\n**Outcome**: Pressing q or Esc exits program cleanly. Terminal restored to normal state. Process exits code 0.\n\n**Do**:\n- In internal/tui/model.go, extend Update to check for 'q' rune and tea.KeyEsc\n- When detected, return model and tea.Quit\n- Also handle tea.KeyCtrlC for robustness\n- Add tests in internal/tui/model_test.go\n\n**Acceptance Criteria**:\n- [ ] q exits TUI and returns to shell\n- [ ] Esc exits TUI and returns to shell\n- [ ] Ctrl+C exits TUI and returns to shell\n- [ ] Update returns tea.Quit when quit key pressed\n- [ ] Terminal state restored after quit\n- [ ] All tests pass\n\n**Tests**:\n- q key triggers quit\n- Esc key triggers quit\n- Ctrl+C triggers quit\n- navigation keys do not trigger quit\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Keyboard Shortcuts section.","parent":"tick-57d5a4","created":"2026-02-22T21:29:10Z","updated":"2026-02-23T13:58:30Z","closed":"2026-02-23T13:58:30Z"}
{"id":"tick-9776d9","title":"Attach on Enter","status":"done","priority":2,"description":"**Problem**: TUI displays and navigates sessions but Enter does nothing. The core flow -- selecting a session and attaching -- is missing.\n\n**Solution**: Handle Enter key in Update. Store selected session name, send tea.Quit, then after program exits call syscall.Exec to replace Portal process with tmux attach-session -t \u003cname\u003e.\n\n**Outcome**: Enter on highlighted session quits TUI and attaches to that tmux session via exec. Portal process replaced by tmux.\n\n**Do**:\n- In internal/tui/model.go, add selected string field\n- Handle tea.KeyEnter: if sessions loaded and cursor valid, set m.selected = m.sessions[m.cursor].Name, return tea.Quit\n- Add Selected() string method for caller to retrieve chosen session\n- In cmd/open.go, after tea.NewProgram().Run() returns, check model.Selected()\n- If non-empty, call syscall.Exec with tmux attach-session -t \u003cname\u003e\n- Use exec.LookPath(\"tmux\") to find binary path for syscall.Exec (required to get absolute path)\n- If LookPath fails, return error (centralised tmux dependency check is added in Phase 6, task portal-6-6)\n- If Selected() empty (user quit), exit cleanly with code 0\n- Add tests in internal/tui/model_test.go\n\n**Acceptance Criteria**:\n- [ ] Enter sets selected session and triggers tea.Quit\n- [ ] After TUI exits, syscall.Exec invoked with tmux attach-session -t \u003cname\u003e\n- [ ] Portal process replaced by tmux (exec, not subprocess)\n- [ ] Quitting without selecting does not trigger attach\n- [ ] Enter with zero sessions is no-op\n- [ ] All tests pass\n\n**Tests**:\n- Enter sets selected session and triggers quit\n- Enter with no sessions is a no-op\n- quit without selecting leaves selected empty\n- selected returns correct session after navigation and Enter\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Keyboard Shortcuts, Running Inside tmux, Process Handoff, tmux Integration sections.","parent":"tick-57d5a4","created":"2026-02-22T21:29:24Z","updated":"2026-02-23T14:03:28Z","closed":"2026-02-23T14:03:28Z"}
{"id":"tick-e70af4","title":"Empty State Display","status":"done","priority":2,"description":"**Problem**: When no tmux sessions exist, TUI shows empty list with no indication. User needs clear message: \"No active sessions\".\n\n**Solution**: In View(), check if sessions loaded (via loaded bool flag) and slice empty. When both true, render \"No active sessions\" instead of session list.\n\n**Outcome**: When portal open runs with no sessions, TUI displays \"No active sessions\". User can still quit with q/Esc.\n\n**Do**:\n- In internal/tui/model.go, add loaded bool field, initially false\n- In Update, when handling sessionsMsg, set m.loaded = true\n- In View, if m.loaded \u0026\u0026 len(m.sessions) == 0, render \"No active sessions\"\n- Quit keys still work in empty state\n- Navigation and Enter are no-ops in empty state (already handled)\n- Add tests in internal/tui/model_test.go\n\n**Acceptance Criteria**:\n- [ ] No sessions displays \"No active sessions\"\n- [ ] No tmux server (empty slice returned) displays \"No active sessions\"\n- [ ] Empty state message appears only after sessions fetched\n- [ ] Quit keys work in empty state\n- [ ] All tests pass\n\n**Tests**:\n- empty sessions shows no active sessions message\n- non-empty sessions does not show empty message\n- empty state is not shown before sessions are loaded\n- quit works in empty state\n- Enter is no-op in empty state\n\n**Edge Cases**:\n- tmux server disappears between list and display: handled at attach layer (tmux reports error)\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Empty States, Session Discovery sections.","parent":"tick-57d5a4","created":"2026-02-22T21:29:36Z","updated":"2026-02-23T14:07:10Z","closed":"2026-02-23T14:07:10Z"}
{"id":"tick-a8f83d","title":"Phase 2: New Session from Directory -- Project Memory and Session Creation","status":"done","priority":2,"parent":"tick-77cbba","created":"2026-02-22T21:45:35Z","updated":"2026-02-23T14:50:58Z","closed":"2026-02-23T14:50:58Z"}
{"id":"tick-2bb2d0","title":"Git Root Resolution","status":"done","priority":2,"description":"**Problem**: When a directory is selected for a new session, Portal must resolve it to the git repository root. Non-git directories used as-is.\n\n**Solution**: Implement ResolveGitRoot function using git -C \u003cdir\u003e rev-parse --show-toplevel. Return original dir on failure. Use CommandRunner interface for testability.\n\n**Outcome**: Tested, reusable function that resolves any directory to its git root or returns unchanged for non-git directories.\n\n**Do**:\n- Create internal/resolver/gitroot.go with ResolveGitRoot(dir string) (string, error)\n- Use exec.Command for git command\n- On success (exit 0), return trimmed stdout\n- On failure (any non-zero exit), return original dir unchanged with no error\n- Check directory existence before running git\n- Accept CommandRunner interface for testing\n\n**Acceptance Criteria**:\n- [ ] ResolveGitRoot returns git root for subdirectory of git repo\n- [ ] ResolveGitRoot returns original dir for non-git directory\n- [ ] ResolveGitRoot returns original dir when git not installed\n- [ ] No user-facing output during resolution\n\n**Tests**:\n- resolves subdirectory to git repository root\n- returns original directory for non-git directory\n- returns original directory when git is not installed\n- trims whitespace from git output\n- returns error when directory does not exist\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Git Root Resolution section","parent":"tick-a8f83d","created":"2026-02-22T21:45:47Z","updated":"2026-02-23T14:14:05Z","closed":"2026-02-23T14:14:05Z"}
{"id":"tick-4ebf36","title":"Session Name Generation","status":"done","priority":2,"description":"**Problem**: Portal needs to auto-generate unique tmux session names in format {project-name}-{nanoid}. Project name must be sanitised (no periods or colons), and collisions must be handled.\n\n**Solution**: Implement GenerateSessionName function that sanitises name, appends 6-char nanoid, checks for collisions, retries up to 10 times.\n\n**Outcome**: Tested session name generation that produces sanitised, unique names in {project}-{nanoid} format with collision retry.\n\n**Do**:\n- Create internal/session/naming.go\n- SanitiseProjectName: replace . and : with -\n- GenerateSessionName(projectName, exists func) returns unique name\n- Injectable nanoid generator for testing\n\n**Acceptance Criteria**:\n- [ ] Returns name matching pattern {project}-[a-zA-Z0-9]{6}\n- [ ] Periods replaced with hyphens\n- [ ] Colons replaced with hyphens\n- [ ] Retries on collision\n- [ ] Error after max retries\n\n**Tests**:\n- generates name in correct format\n- sanitises periods/colons\n- retries on collision\n- returns error after max retries\n- handles empty project name\n\n**Edge Cases**:\n- Empty project name: produces -{nanoid} format (or error, to be decided)\n- Max collision retries exhausted: returns descriptive error\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Session Naming section","parent":"tick-a8f83d","created":"2026-02-22T21:45:56Z","updated":"2026-02-23T14:18:07Z","closed":"2026-02-23T14:18:07Z"}
{"id":"tick-248cf4","title":"Project Store (projects.json)","status":"done","priority":2,"description":"**Problem**: Portal needs to persist remembered project directories in projects.json at ~/.config/portal/.\n\n**Solution**: Implement ProjectStore with CRUD operations. Load handles missing/malformed files gracefully. Save uses atomic writes. Upsert by path. List sorted by last_used.\n\n**Outcome**: Tested ProjectStore with Load, Save, Upsert, List, and Remove operations persisting projects to ~/.config/portal/projects.json with graceful handling of missing/malformed files.\n\n**Do**:\n- Create internal/project/store.go\n- Project struct: Path, Name, LastUsed\n- Load(): handle missing file, malformed JSON\n- Save(): create dir, atomic write (temp+rename)\n- Upsert(path, name): add/update project\n- List(): sorted by last_used descending\n- Remove(path): delete entry\n\n**Acceptance Criteria**:\n- [ ] Load returns empty list when file missing\n- [ ] Load returns empty list for malformed JSON\n- [ ] Save creates config directory\n- [ ] Upsert adds new or updates existing\n- [ ] List sorted by last_used descending\n\n**Tests**:\n- loads empty list when file does not exist\n- loads projects from valid JSON\n- handles malformed JSON\n- creates config directory on save\n- upsert adds/updates project\n- list returns sorted projects\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Configuration \u0026 Storage, projects.json Structure","parent":"tick-a8f83d","created":"2026-02-22T21:46:06Z","updated":"2026-02-23T14:24:56Z","closed":"2026-02-23T14:24:56Z"}
{"id":"tick-275824","title":"Stale Project Cleanup","status":"done","priority":2,"description":"**Problem**: Project directories can be deleted after being remembered. Stale projects should be automatically removed when project picker is displayed.\n\n**Solution**: Implement CleanStale() method on ProjectStore. Check each directory with os.Stat, remove non-existent ones, retain permission-denied dirs.\n\n**Outcome**: CleanStale() removes projects with non-existent directories, retains those with permission errors, and returns the count of removed entries.\n\n**Do**:\n- Add CleanStale() (int, error) to ProjectStore\n- Iterate projects, os.Stat each path\n- If os.IsNotExist, mark for removal\n- If permission error, keep the project\n- Save only if changes made\n- Return count of removed\n\n**Acceptance Criteria**:\n- [ ] Removes projects with non-existent directories\n- [ ] Retains projects with existing directories\n- [ ] Retains projects with permission denied\n- [ ] Returns 0 when no stale projects\n\n**Tests**:\n- removes project with non-existent directory\n- retains project with existing directory\n- retains project with permission denied\n- returns zero on empty list\n- removes multiple stale in single call\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Stale Project Cleanup section","parent":"tick-a8f83d","created":"2026-02-22T21:46:15Z","updated":"2026-02-23T14:31:25Z","closed":"2026-02-23T14:31:25Z"}
{"id":"tick-f924e3","title":"Session Creation from Project","status":"done","priority":2,"description":"**Problem**: Portal needs to create a new tmux session from a project directory, orchestrating git root resolution, name generation, project store update, and tmux command.\n\n**Solution**: Implement SessionCreator.CreateFromDir that coordinates the full flow: resolve git root, derive project name, generate session name, upsert project, create tmux session.\n\n**Outcome**: SessionCreator.CreateFromDir creates a tmux session with auto-generated name in the git-root-resolved directory, registers/updates the project in store, and returns the session name for handoff.\n\n**Do**:\n- Create internal/session/create.go\n- SessionCreator struct with dependencies: GitResolver, ProjectStore, TmuxClient\n- CreateFromDir(dir): resolve git root, derive name from basename, generate session name, upsert project, call tmux NewSession\n- Extend TmuxClient: HasSession(name) bool, NewSession(name, dir) error\n- Validate directory exists before tmux call\n\n**Acceptance Criteria**:\n- [ ] Resolves directory to git root\n- [ ] Generates session name from basename with nanoid\n- [ ] Upserts project in store\n- [ ] Creates tmux session with correct name and dir\n- [ ] Works when no tmux server running\n- [ ] Returns error when directory missing\n\n**Tests**:\n- creates session with git-root-resolved directory\n- derives project name from basename\n- generates unique session name\n- upserts project in store\n- handles tmux server not running\n- returns error for non-existent directory\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- New Session Flow, How Directories are Added","parent":"tick-a8f83d","created":"2026-02-22T21:46:25Z","updated":"2026-02-23T14:36:34Z","closed":"2026-02-23T14:36:34Z"}
{"id":"tick-4c54e1","title":"Project Picker TUI View","status":"done","priority":2,"description":"**Problem**: Portal needs a project picker TUI showing remembered projects sorted by recency with browse option at bottom and empty state handling.\n\n**Solution**: Implement ProjectPickerModel as Bubble Tea component. Display projects from store, always show browse option, handle empty state. Support filter mode via / key.\n\n**Outcome**: Project picker TUI displays remembered projects sorted by last_used, browse option always visible, filter mode via /, and handles empty state gracefully.\n\n**Do**:\n- Create internal/ui/projectpicker.go with ProjectPickerModel\n- Init: call store.CleanStale(), store.List()\n- Render: header, project list with cursor, separator, browse option\n- Navigation: Up/Down/j/k, Enter selects, Esc returns\n- Empty state: \"No saved projects yet.\" with browse still visible\n- Return selection message (project path or browse action)\n- / key activates filter mode with fuzzy matching against project names\n- Filter mode: browse option always visible, Backspace/Esc behavior\n\n**Acceptance Criteria**:\n- [ ] Displays projects sorted by last_used\n- [ ] browse option always visible at bottom\n- [ ] Arrow keys and j/k navigate list\n- [ ] Enter on project returns selection\n- [ ] Enter on browse returns browse action\n- [ ] Esc returns to session list\n- [ ] Empty state with browse still selectable\n- [ ] / activates filter mode; typing fuzzy-matches against project names\n- [ ] Filter mode: [n]/browse option always visible regardless of filter\n- [ ] Filter mode: Backspace removes last char; on empty filter exits filter mode\n- [ ] Filter mode: Esc clears filter and exits filter mode\n\n**Tests**:\n- displays projects sorted by last_used\n- shows browse option at bottom\n- empty state shows message\n- enter on project emits path\n- esc emits back message\n- slash activates filter mode in project picker\n- typing narrows project list by fuzzy match\n- browse option always visible during filter\n- backspace on empty filter exits filter mode\n- esc clears filter and exits filter mode\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Project Picker Interaction, Empty States","parent":"tick-a8f83d","created":"2026-02-22T21:46:36Z","updated":"2026-02-23T14:43:11Z","closed":"2026-02-23T14:43:11Z"}
{"id":"tick-444a76","title":"Main TUI New in Project Integration","status":"done","priority":2,"description":"**Problem**: Main session list needs [n] new in project... option that transitions to project picker. After selection, create session and attach.\n\n**Solution**: Extend Phase 1 session list with new option below divider, wire n shortcut, implement view switching between session list and project picker.\n\n**Outcome**: Main TUI shows [n] new in project... option below sessions, transitions to project picker on select, creates session from selected project, and handles navigation back to session list.\n\n**Do**:\n- Add [n] new in project... option below sessions with divider\n- n shortcut jumps to the option\n- View states: viewSessionList, viewProjectPicker\n- Enter on option switches to project picker\n- Esc in picker returns to session list\n- Project selection triggers SessionCreator.CreateFromDir then tmux exec\n- Browse action is placeholder for Phase 3\n\n**Acceptance Criteria**:\n- [ ] [n] new in project... appears below sessions with divider\n- [ ] n key jumps to new option\n- [ ] Enter on option transitions to project picker\n- [ ] Selecting project creates session and attaches\n- [ ] Esc in picker returns to session list\n- [ ] Empty session list still shows option\n- [ ] Combined empty state (no sessions + no projects) navigable\n\n**Tests**:\n- session list includes new in project option\n- n key jumps to option\n- enter switches to project picker\n- esc returns to session list\n- project selection triggers creation\n- empty session list shows option\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- TUI Design, Keyboard Shortcuts","parent":"tick-a8f83d","created":"2026-02-22T21:46:49Z","updated":"2026-02-23T14:50:47Z","closed":"2026-02-23T14:50:47Z"}
{"id":"tick-f6e9a1","title":"Phase 3: File Browser and CLI Quick-Start","status":"done","priority":2,"parent":"tick-77cbba","created":"2026-02-22T21:59:41Z","updated":"2026-02-23T15:42:45Z","closed":"2026-02-23T15:42:45Z"}
{"id":"tick-f26ed6","title":"Directory Listing Model","status":"done","priority":2,"description":"**Problem**: The file browser needs a directory listing function that returns only directories, with optional hidden directory filtering. This is the data layer for the file browser TUI.\n\n**Solution**: Implement ListDirectories(path, showHidden) returning a sorted slice of directory entries. Files are excluded. Hidden directories (starting with `.`) are excluded unless showHidden is true.\n\n**Outcome**: Tested function returning directory-only entries, handling empty dirs, permission denied, and symlinks gracefully.\n\n**Do**:\n- Create internal/browser/listing.go with DirEntry struct (Name string, IsSymlink bool)\n- ListDirectories(path string, showHidden bool) ([]DirEntry, error)\n- Read directory entries via os.ReadDir, filter to directories only (files not displayed per spec)\n- Exclude entries starting with `.` when showHidden is false\n- Sort entries alphabetically by name\n- Return empty slice (not error) on permission denied\n- Follow symlinks to check if target is a directory\n\n**Acceptance Criteria**:\n- [ ] Returns only directory entries, no files\n- [ ] Hidden directories excluded when showHidden is false\n- [ ] Hidden directories included when showHidden is true\n- [ ] Entries sorted alphabetically\n- [ ] Returns empty slice on permission denied\n- [ ] Symlinked directories included; symlinked files excluded\n- [ ] Returns empty slice for empty directory\n\n**Tests**:\n- returns only directories\n- excludes hidden when showHidden=false\n- includes hidden when showHidden=true\n- returns empty for empty directory\n- handles permission denied gracefully\n- sorts entries alphabetically\n- includes symlinked directories\n- excludes symlinked files\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- File Browser (Content: shows directories only)","parent":"tick-f6e9a1","created":"2026-02-22T21:59:48Z","updated":"2026-02-23T14:55:54Z","closed":"2026-02-23T14:55:54Z"}
{"id":"tick-62c4f1","title":"File Browser TUI -- Core Navigation","status":"done","priority":2,"description":"**Problem**: Portal needs an interactive file browser TUI for navigating the filesystem to select a directory for new session creation. The browser must support descending into directories, ascending to parent, and showing a `.` entry to select the current directory.\n\n**Solution**: Implement a Bubble Tea FileBrowserModel that starts at the current working directory, renders the directory listing with cursor navigation, and supports Enter/right-arrow to descend and Backspace/left-arrow to ascend.\n\n**Outcome**: Interactive file browser TUI with directory navigation. Enter/right descends, Backspace/left ascends, `.` entry at top represents current directory. Navigation stops at root.\n\n**Do**:\n- Create internal/ui/browser.go with FileBrowserModel struct\n- Init with starting path set to current working directory (per spec: \"Starting directory: Current working directory\")\n- Render: current path header, `.` entry at top (current dir indicator), then directory listing with cursor\n- Enter or right-arrow on a directory: descend into it, refresh listing\n- Backspace or left-arrow: go to parent directory; no-op at filesystem root\n- Up/Down and j/k: navigate the listing\n- Cursor resets to 0 when entering a new directory\n\n**Acceptance Criteria**:\n- [ ] Browser starts at current working directory\n- [ ] Current path displayed as header\n- [ ] `.` entry shown at top of listing\n- [ ] Enter on directory descends into it\n- [ ] Right-arrow on directory descends into it\n- [ ] Backspace goes to parent directory\n- [ ] Left-arrow goes to parent directory\n- [ ] Navigation is no-op at filesystem root\n- [ ] Up/Down and j/k navigate listing\n- [ ] Cursor resets when entering subdirectory\n\n**Tests**:\n- displays current path\n- shows dot entry at top\n- enter descends into directory\n- right arrow descends into directory\n- backspace goes to parent\n- left arrow goes to parent\n- no-op at root directory\n- cursor navigation works\n- cursor resets on directory change\n- starts at cwd\n\n**Edge Cases**:\n- Root directory: Backspace/left-arrow are no-ops\n- Single subdirectory: cursor stays at 0\n- Deeply nested path: header shows full path\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- File Browser (Behavior) section","parent":"tick-f6e9a1","created":"2026-02-22T21:59:55Z","updated":"2026-02-23T15:03:41Z","closed":"2026-02-23T15:03:41Z"}
{"id":"tick-cebbcb","title":"File Browser Inline Filter","status":"done","priority":2,"description":"**Problem**: The file browser needs inline filtering so users can quickly narrow the directory listing by typing. The spec defines dual-purpose Backspace (filter char removal or parent navigation) and dual-purpose Esc (clear filter or cancel browser).\n\n**Solution**: Add filter state to the browser model. Typing narrows visible entries by fuzzy match at the current directory level. Backspace removes the last filter character; when filter is empty, Backspace reverts to navigation (go to parent). Esc clears active filter; if no filter is active, Esc cancels the browser.\n\n**Outcome**: Typing fuzzy-filters directory listing. Backspace and Esc have context-sensitive behavior based on filter state.\n\n**Do**:\n- Add filterText string to FileBrowserModel\n- Rune keypresses: append to filterText, recompute visible entries by fuzzy match\n- Backspace: if filterText non-empty, remove last char and re-filter; if filterText empty, go to parent directory\n- Esc: if filterText non-empty, clear filterText and show full listing; if filterText empty, cancel browser (emit cancel message)\n- Filter resets (filterText = \"\") when entering a subdirectory via Enter/right-arrow\n- Cursor resets to 0 when filter changes\n\n**Acceptance Criteria**:\n- [ ] Typing narrows directory listing by fuzzy match\n- [ ] Backspace removes last filter character when filter active\n- [ ] Backspace goes to parent when filter is empty\n- [ ] Esc clears filter when filter is active\n- [ ] Esc cancels browser when no filter is active\n- [ ] Filter resets when entering a subdirectory\n- [ ] Cursor resets when filter changes\n\n**Tests**:\n- typing filters directory listing\n- backspace removes filter char\n- backspace on empty filter goes to parent\n- esc clears active filter\n- esc cancels browser when no filter\n- filter resets on directory change\n- cursor resets on filter change\n- filter matches nothing shows empty listing\n\n**Edge Cases**:\n- Filter matches nothing: empty listing shown, no directories selectable\n- Filter then navigate to child: filter resets\n- All characters deleted via Backspace: filter empty, full listing restored\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- File Browser (Filtering) section","parent":"tick-f6e9a1","created":"2026-02-22T22:00:03Z","updated":"2026-02-23T15:12:22Z","closed":"2026-02-23T15:12:22Z"}
{"id":"tick-feea91","title":"File Browser Hidden Directory Toggle and Selection","status":"done","priority":2,"description":"**Problem**: The file browser needs two additional features: toggling hidden directory visibility and selecting the current directory for session creation. Hidden directories (`.` prefix) are hidden by default and toggled with the `.` key. The current directory is selected via Space or Enter on the `.` entry.\n\n**Solution**: Add a showHidden toggle activated by the `.` key (only outside filter mode to avoid conflict with typing). Space or Enter on the `.` entry at the top of the listing selects the current directory, emitting a selection message. The toggle is session-scoped (resets on next browser open).\n\n**Outcome**: `.` key toggles hidden directory visibility. Space/Enter on `.` entry selects current directory for session creation.\n\n**Do**:\n- `.` key toggles showHidden flag and refreshes listing (only when not in filter mode, to avoid conflict with typing `.` as filter text)\n- Space on `.` entry: emit selection message with current directory path\n- Enter on `.` entry: same behavior as Space\n- Validate directory still exists before emitting selection\n- Selection message carries the path for downstream processing (git root resolution, project registration, session creation)\n- Toggle applies only to current browser session; resets on next open\n\n**Acceptance Criteria**:\n- [ ] `.` key toggles hidden directory visibility\n- [ ] Hidden directories shown after toggle\n- [ ] Hidden directories hidden again after second toggle\n- [ ] Space on `.` entry emits directory selection\n- [ ] Enter on `.` entry emits directory selection\n- [ ] Selection message contains current directory path\n- [ ] `.` key ignored when filter is active\n- [ ] Toggle resets on next browser open\n- [ ] Selected directory auto-added to projects.json (via integration)\n\n**Tests**:\n- dot key toggles hidden visibility\n- space on dot entry emits selection\n- enter on dot entry emits selection\n- selection message contains current path\n- dot key ignored when filtering\n- directory has only hidden subdirectories and toggle reveals them\n- selected directory removed between browse and select produces error\n\n**Edge Cases**:\n- Directory has only hidden subdirectories: listing appears empty until `.` toggle\n- Selected directory removed between browse and select: error at selection time\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- File Browser (Hidden directories, Select current directory) section","parent":"tick-f6e9a1","created":"2026-02-22T22:00:09Z","updated":"2026-02-23T15:20:06Z","closed":"2026-02-23T15:20:06Z"}
{"id":"tick-9d6404","title":"File Browser Integration with Project Picker","status":"done","priority":2,"description":"**Problem**: The file browser must be wired into the project picker flow. When the user selects \"browse for directory...\" in the project picker, the file browser opens. A directory selection flows through git root resolution, project registration, and session creation. Cancelling returns to the project picker.\n\n**Solution**: Connect the project picker's browse option to the file browser. On selection, resolve git root, register the project in projects.json, create the tmux session, and exec/switch. On cancel (Esc with no filter), return to the project picker view.\n\n**Outcome**: End-to-end flow from project picker browse option through file browser to session creation. Cancel returns to project picker.\n\n**Do**:\n- In project picker: Enter on browse option transitions to file browser view\n- File browser selection: resolve directory to git root, upsert project in store, create session (reuse Phase 2 SessionCreator)\n- File browser cancel (Esc with no filter): transition back to project picker view\n- Works from empty project list (browse is the only selectable option)\n\n**Acceptance Criteria**:\n- [ ] Browse option in project picker opens file browser\n- [ ] Selected directory resolved to git root before session creation\n- [ ] Selected directory registered in projects.json\n- [ ] Session created with auto-generated name and resolved directory\n- [ ] Cancel in browser returns to project picker\n- [ ] Browse works from empty project list (only browse option available)\n\n**Tests**:\n- browse option opens file browser\n- selection creates session with git-root-resolved path\n- selection registers project in store\n- cancel returns to project picker\n- browse works from empty project list\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- File Browser (Access, Behavior), Project Memory (How Directories are Added)","parent":"tick-f6e9a1","created":"2026-02-22T22:00:17Z","updated":"2026-02-23T15:25:15Z","closed":"2026-02-23T15:25:15Z"}
{"id":"tick-33fb7f","title":"CLI Quick-Start Path Resolution","status":"done","priority":2,"description":"**Problem**: Portal needs non-interactive quick-start paths (`portal open .` and `portal open \u003cpath\u003e`) that resolve a directory and create a session without launching the TUI. Paths must be validated, expanded, and resolved.\n\n**Solution**: Implement ResolvePath for tilde expansion and relative-to-absolute conversion. Implement IsPathArgument to detect path-like arguments. Wire into `portal open`: if the argument is a path, resolve it and skip the TUI. Validate the resolved path exists and is a directory.\n\n**Outcome**: `portal open .` resolves cwd, `portal open \u003cpath\u003e` resolves the given path. Non-existent paths print error and exit 1. No TUI is launched.\n\n**Do**:\n- Create internal/resolver/path.go with ResolvePath(arg string) (string, error)\n- Expand `~` to user home directory\n- Resolve relative paths to absolute using filepath.Abs\n- Validate path exists (os.Stat); if not, return error with \"Directory not found: {path}\"\n- Validate path is a directory (not a file); if file, return error\n- IsPathArgument(arg string) bool: true if arg contains `/` or starts with `.` or `~`\n- Wire into cmd/open.go: check IsPathArgument; if true, call ResolvePath and skip TUI, proceed to session creation\n\n**Acceptance Criteria**:\n- [ ] `portal open .` resolves current working directory\n- [ ] `portal open \u003crelative-path\u003e` resolves to absolute path\n- [ ] `portal open ~/path` expands tilde to home directory\n- [ ] Non-existent path prints \"Directory not found: {path}\" and exits with code 1\n- [ ] Path that is a file (not directory) prints error and exits with code 1\n- [ ] TUI is not launched for path arguments\n\n**Tests**:\n- resolves relative path to absolute\n- expands tilde to home directory\n- returns error for non-existent path\n- returns error when path is a file\n- portal open . resolves cwd\n- IsPathArgument true for paths with /\n- IsPathArgument true for paths starting with .\n- IsPathArgument true for paths starting with ~\n- IsPathArgument false for plain words\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- x (The Launcher, Quick-start shortcuts), Query Resolution (Path detection heuristic, Path validation)","parent":"tick-f6e9a1","created":"2026-02-22T22:00:25Z","updated":"2026-02-23T15:31:57Z","closed":"2026-02-23T15:31:57Z"}
{"id":"tick-afb187","title":"CLI Quick-Start Session Creation","status":"done","priority":2,"description":"**Problem**: After path resolution, Portal must orchestrate the full session creation flow: git root resolution, project registration, session name generation, tmux session creation, and process handoff. This wires the CLI quick-start paths through the existing Phase 2 primitives.\n\n**Solution**: Implement a QuickStart function that takes a resolved path and executes the full creation pipeline. Reuse GitResolver, ProjectStore, and SessionCreator from Phase 2. Update last_used if the project already exists in the store.\n\n**Outcome**: `portal open .` and `portal open \u003cpath\u003e` create a tmux session in the resolved directory with git root resolution, project registration, and exec handoff.\n\n**Do**:\n- Implement QuickStart(path string) in cmd/open.go or internal/session/\n- Steps: resolve git root -\u003e derive project name from basename -\u003e upsert project (add or update last_used) -\u003e generate session name -\u003e tmux new-session -A -s \u003cname\u003e -c \u003cdir\u003e -\u003e exec handoff\n- Reuse Phase 2 primitives: GitResolver, ProjectStore.Upsert, SessionCreator\n- Update last_used timestamp if project already exists in projects.json\n- Exec handoff replaces Portal process with tmux (same as TUI attach path)\n\n**Acceptance Criteria**:\n- [ ] Resolved path goes through git root resolution\n- [ ] New project registered in projects.json with name from directory basename\n- [ ] Existing project's last_used timestamp updated\n- [ ] Session name auto-generated ({project}-{nanoid})\n- [ ] tmux session created with resolved directory via -c flag\n- [ ] Portal process replaced by tmux via exec\n\n**Tests**:\n- creates session with git-root-resolved directory\n- registers new project in store\n- updates last_used for existing project\n- exec replaces process with tmux\n- session name follows {project}-{nanoid} format\n- project name derived from directory basename after git root resolution\n\n**Edge Cases**:\n- cwd is inside git repo subdirectory: resolved to git root, project name from root basename\n- Project already in projects.json: last_used updated, no duplicate entry\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Directory Change for New Sessions, Git Root Resolution, How Directories are Added, Session Naming, Process Handoff","parent":"tick-f6e9a1","created":"2026-02-22T22:00:31Z","updated":"2026-02-23T15:42:33Z","closed":"2026-02-23T15:42:33Z"}
{"id":"tick-0c342f","title":"Phase 4: Query Resolution, Aliases, and Shell Integration","status":"done","priority":2,"parent":"tick-77cbba","created":"2026-02-22T22:06:48Z","updated":"2026-02-23T16:46:07Z","closed":"2026-02-23T16:46:07Z"}
{"id":"tick-5533b4","title":"Alias Store","status":"done","priority":2,"description":"**Problem**: Portal needs persistent alias storage in a flat key=value file at ~/.config/portal/aliases. Aliases map short names to directory paths for quick navigation.\n\n**Solution**: Implement AliasStore with Load/Save/Get/Set/Delete/List operations managing the aliases file. Handle missing file, missing config directory, empty file, and duplicate keys gracefully.\n\n**Outcome**: Tested AliasStore that reads and writes ~/.config/portal/aliases in flat key=value format with full CRUD operations.\n\n**Do**:\n- Create internal/alias/store.go with AliasStore struct\n- File format: one alias per line, `name=path` (e.g., `m2api=/Users/lee/Code/mac2/api`)\n- Load(): read file, parse lines, handle missing file (return empty), handle empty file (return empty), handle duplicate keys (last wins)\n- Save(): create config directory if needed, write all aliases to file\n- Get(name string) (string, bool): return path for alias name\n- Set(name, path string): add or overwrite alias (aliases must be unique per spec)\n- Delete(name string) bool: remove alias, return whether it existed\n- List() []Alias: return all aliases sorted by name\n\n**Acceptance Criteria**:\n- [ ] Load returns empty map when file does not exist\n- [ ] Load returns empty map for empty file\n- [ ] Load handles duplicate keys (last value wins)\n- [ ] Save creates ~/.config/portal/ directory if needed\n- [ ] Set adds new alias\n- [ ] Set overwrites existing alias (uniqueness enforced)\n- [ ] Delete removes alias and returns true; returns false if not found\n- [ ] List returns all aliases sorted by name\n- [ ] File format is flat key=value, one per line\n\n**Tests**:\n- loads empty map when file does not exist\n- loads aliases from valid file\n- handles duplicate keys (last wins)\n- creates config directory on save\n- set adds new alias\n- set overwrites existing alias\n- delete removes existing alias\n- delete returns false for non-existent alias\n- list returns sorted aliases\n- handles empty file\n\n**Context**:\n\u003e Per spec: \"Aliases are stored separately from projects in ~/.config/portal/aliases, using a flat key-value format.\" Aliases must be unique -- each name maps to exactly one path.\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Alias Storage section","parent":"tick-0c342f","created":"2026-02-22T22:06:57Z","updated":"2026-02-23T15:46:49Z","closed":"2026-02-23T15:46:49Z"}
{"id":"tick-a2e7bd","title":"Alias Set Command with Path Normalisation","status":"done","priority":2,"description":"**Problem**: Portal needs a `portal alias set \u003cname\u003e \u003cpath\u003e` CLI command that stores an alias with path normalization. Paths must have tilde expanded and relative paths resolved to absolute before storage.\n\n**Solution**: Implement the Cobra command for `portal alias set`. Normalize the path (expand `~`, resolve relative to absolute) before storing via AliasStore. The aliases file always contains absolute paths per spec.\n\n**Outcome**: `portal alias set m2api ~/Code/mac2/api` stores the alias with the fully resolved absolute path.\n\n**Do**:\n- Create cmd/alias.go with `portal alias` parent command and `portal alias set` subcommand\n- Accept exactly two positional arguments: name and path\n- NormalisePath(path string) string: expand `~` to os.UserHomeDir(), resolve relative paths to absolute via filepath.Abs()\n- Call AliasStore.Set(name, normalisedPath)\n- Save the aliases file after setting\n- If overwriting an existing alias, do so silently (spec: setting existing alias overwrites)\n\n**Acceptance Criteria**:\n- [ ] `portal alias set \u003cname\u003e \u003cpath\u003e` stores alias\n- [ ] Tilde expanded to home directory before storage\n- [ ] Relative paths resolved to absolute before storage\n- [ ] Aliases file always contains absolute paths\n- [ ] Setting existing alias overwrites silently\n- [ ] Exit 0 on success\n\n**Tests**:\n- sets new alias with absolute path\n- expands tilde in path\n- resolves relative path to absolute\n- overwrites existing alias silently\n- aliases file contains absolute path after set\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Alias Storage (Path normalization), xctl alias commands","parent":"tick-0c342f","created":"2026-02-22T22:06:58Z","updated":"2026-02-23T15:55:26Z","closed":"2026-02-23T15:55:26Z"}
{"id":"tick-26cdeb","title":"Alias Remove and List Commands","status":"done","priority":2,"description":"**Problem**: Portal needs `portal alias rm \u003cname\u003e` and `portal alias list` CLI commands for alias management.\n\n**Solution**: Implement Cobra subcommands for alias removal and listing. Remove prints error and exits 1 if alias not found. List outputs all aliases sorted; empty output when none.\n\n**Outcome**: Complete alias management CLI: set, remove, and list operations.\n\n**Do**:\n- Add `portal alias rm` subcommand: accept one positional argument (name)\n- If alias not found, print error to stderr and exit 1\n- If alias found, delete and save; exit 0\n- Add `portal alias list` subcommand: no arguments\n- List all aliases in format `name=path`, sorted by name\n- Empty output (nothing printed) when no aliases exist; exit 0\n\n**Acceptance Criteria**:\n- [ ] `portal alias rm \u003cname\u003e` removes alias and exits 0\n- [ ] `portal alias rm \u003cname\u003e` prints error and exits 1 when alias not found\n- [ ] `portal alias list` outputs all aliases sorted by name\n- [ ] `portal alias list` produces empty output when no aliases\n- [ ] Both commands exit 0 on success\n\n**Tests**:\n- rm removes existing alias\n- rm prints error for non-existent alias\n- rm exits 1 for non-existent alias\n- list outputs aliases sorted by name\n- list produces empty output when no aliases\n- list exits 0\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- xctl alias commands, Alias Storage","parent":"tick-0c342f","created":"2026-02-22T22:06:59Z","updated":"2026-02-23T16:01:21Z","closed":"2026-02-23T16:01:21Z"}
{"id":"tick-b3b992","title":"Zoxide Query Integration","status":"done","priority":2,"description":"**Problem**: Portal needs zoxide integration as an optional step in query resolution. Zoxide provides frecency-based directory matching but may not be installed.\n\n**Solution**: Implement ZoxideResolver that wraps `zoxide query \u003cterms\u003e`. Return the best match on success. Use sentinel errors for \"not installed\" and \"no match\" conditions. Skip silently when zoxide is not installed.\n\n**Outcome**: Tested zoxide integration that resolves queries via frecency, with graceful degradation when zoxide is absent.\n\n**Do**:\n- Create internal/resolver/zoxide.go with ZoxideResolver struct\n- Query(terms string) (string, error): run `zoxide query \u003cterms\u003e`, return trimmed stdout on exit 0\n- Use exec.LookPath(\"zoxide\") to check availability before running\n- If LookPath fails: return \"\", ErrZoxideNotInstalled (caller skips silently)\n- If zoxide exits non-zero (no match): return \"\", ErrNoMatch\n- Define sentinel errors: ErrZoxideNotInstalled, ErrNoMatch\n\n**Acceptance Criteria**:\n- [ ] Returns best zoxide match on success\n- [ ] Returns ErrZoxideNotInstalled when zoxide not on PATH\n- [ ] Returns ErrNoMatch when zoxide finds no match\n- [ ] Caller can skip silently on ErrZoxideNotInstalled\n- [ ] Output trimmed of whitespace\n\n**Tests**:\n- returns best match from zoxide query\n- returns ErrZoxideNotInstalled when zoxide not installed\n- returns ErrNoMatch when zoxide returns no match\n- trims whitespace from zoxide output\n- handles multi-word query terms\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Query Resolution (Zoxide query step), Dependencies (Zoxide is optional soft dependency)","parent":"tick-0c342f","created":"2026-02-22T22:07:00Z","updated":"2026-02-23T16:08:18Z","closed":"2026-02-23T16:08:18Z"}
{"id":"tick-fe7c90","title":"Query Resolution Chain","status":"done","priority":2,"description":"**Problem**: Portal needs a unified query resolution chain for `portal open \u003cquery\u003e`. The argument must be resolved through a priority chain: path detection, alias lookup, zoxide query, then TUI fallback. After resolution, the directory must be validated.\n\n**Solution**: Implement QueryResolver that applies the resolution chain in order. Path detection uses a heuristic: arguments containing `/` or starting with `.` or `~` are treated as paths. Non-path arguments check alias store, then zoxide, then fall back to TUI with the query pre-filled as filter text.\n\n**Outcome**: `portal open \u003cquery\u003e` resolves through the full chain. Resolved directories are validated. Unresolved queries fall back to the TUI with the query pre-filled as filter text in the session list (or project picker if command pending).\n\n**Do**:\n- Create internal/resolver/query.go with QueryResolver struct\n- IsPathArgument(arg): true if contains `/` or starts with `.` or `~`\n- Resolve(query): path detection -\u003e alias lookup -\u003e zoxide query -\u003e TUI fallback\n- After alias or zoxide resolution, validate directory exists on disk\n- If directory not found after resolution, print \"Directory not found: {path}\" and exit 1\n- On TUI fallback: return a FallbackResult containing the query string for pre-filling the filter\n- Wire into portal open: when FallbackResult returned, launch TUI with query as initial filter text in session list\n\n**Acceptance Criteria**:\n- [ ] Path-like arguments (containing `/`, starting with `.` or `~`) resolved directly as paths\n- [ ] Non-path arguments checked against alias store first\n- [ ] Alias miss falls through to zoxide query\n- [ ] Zoxide miss (or not installed) falls through to TUI fallback\n- [ ] TUI fallback pre-fills the query as filter text in the session list\n- [ ] Resolved directory validated; \"Directory not found: {path}\" and exit 1 if missing\n- [ ] Zoxide skipped silently when not installed\n\n**Tests**:\n- path-like argument resolved directly (contains /)\n- path-like argument resolved directly (starts with .)\n- path-like argument resolved directly (starts with ~)\n- non-path argument resolved via alias\n- alias miss falls through to zoxide\n- zoxide miss falls through to TUI fallback\n- TUI fallback includes query string for filter pre-fill\n- resolved directory validated for existence\n- non-existent resolved directory prints error and exits 1\n- zoxide not installed skipped silently\n- query matches alias; alias path used (not zoxide)\n\n**Edge Cases**:\n- Query matches both alias and zoxide: alias wins (alias is checked first)\n- Resolved directory does not exist: error message and exit 1\n- Path-like query (e.g., ./mydir): treated as path, not sent through alias/zoxide chain\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Query Resolution section","parent":"tick-0c342f","created":"2026-02-22T22:07:01Z","updated":"2026-02-23T16:21:14Z","closed":"2026-02-23T16:21:14Z"}
{"id":"tick-83fe89","title":"Shell Init for Zsh","status":"done","priority":2,"description":"**Problem**: Portal needs a `portal init zsh` command that outputs shell integration: the `x()` and `xctl()` shell functions plus tab completions wired to the function names.\n\n**Solution**: Implement `portal init` Cobra command with zsh subcommand/argument. Emit shell functions that route `x` to `portal open` and `xctl` to `portal`. Emit Cobra-generated completions. Wire completions to function names via `compdef`.\n\n**Outcome**: `eval \"$(portal init zsh)\"` sets up shell functions and tab completions for zsh.\n\n**Do**:\n- Create cmd/init.go with `portal init` command accepting shell name as positional argument\n- For zsh: emit `function x() { portal open \"$@\" }` and `function xctl() { portal \"$@\" }`\n- Emit Cobra-generated zsh completions via rootCmd.GenZshCompletion()\n- Wire completions to function names: `compdef x=portal` and `compdef xctl=portal` (or equivalent)\n- All output goes to stdout for eval consumption\n- The init script is the single source of shell integration per spec\n\n**Acceptance Criteria**:\n- [ ] `portal init zsh` emits x() function routing to portal open\n- [ ] `portal init zsh` emits xctl() function routing to portal\n- [ ] Tab completions emitted for zsh\n- [ ] Completions wired to x and xctl names (not just portal binary)\n- [ ] Output is valid zsh that can be eval'd\n\n**Tests**:\n- init zsh outputs x function definition\n- init zsh outputs xctl function definition\n- init zsh outputs completion setup\n- completions wired to x and xctl names\n- output is valid shell syntax\n\n**Context**:\n\u003e Per spec: \"portal init also emits shell tab completions for the portal binary (generated by Cobra). The init script is the single source of shell integration -- functions, aliases, and completions are all emitted together.\" Completions must work for the shell function names: \"xctl\u003cTAB\u003e completes subcommands (e.g., compdef xctl=portal for zsh).\"\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Shell Functions, CLI Interface (portal init)","parent":"tick-0c342f","created":"2026-02-22T22:07:02Z","updated":"2026-02-23T16:26:17Z","closed":"2026-02-23T16:26:17Z"}
{"id":"tick-457428","title":"Shell Init Custom Command Names","status":"done","priority":2,"description":"**Problem**: The `portal init` command needs a `--cmd` flag that customizes the shell function names. `portal init zsh --cmd p` should emit `p()` and `pctl()` instead of `x()` and `xctl()`.\n\n**Solution**: Add a `--cmd` string flag to `portal init`. When provided, use the custom name as the launcher function and append `ctl` for the control plane function. Wire completions to the custom names.\n\n**Outcome**: `eval \"$(portal init zsh --cmd p)\"` creates `p()` and `pctl()` with completions wired to those names.\n\n**Do**:\n- Add --cmd string flag to portal init command (default: \"x\")\n- Launcher function name: value of --cmd (e.g., \"p\")\n- Control plane function name: value of --cmd + \"ctl\" (e.g., \"pctl\")\n- Emit functions with custom names\n- Wire completions to custom names (e.g., `compdef p=portal` and `compdef pctl=portal`)\n\n**Acceptance Criteria**:\n- [ ] --cmd p emits p() and pctl() functions\n- [ ] Completions wired to custom names\n- [ ] Default (no --cmd) emits x() and xctl()\n- [ ] Custom names work for all supported shells\n\n**Tests**:\n- cmd flag changes function names\n- default without cmd flag uses x and xctl\n- completions wired to custom names\n- ctl suffix appended to cmd name\n\n**Edge Cases**:\n- cmd name conflicts with shell builtins: not Portal's concern; user's choice\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Architecture (Command names configurable via --cmd), Shell Functions","parent":"tick-0c342f","created":"2026-02-22T22:07:03Z","updated":"2026-02-23T16:31:14Z","closed":"2026-02-23T16:31:14Z"}
{"id":"tick-19ad25","title":"Shell Init for Bash and Fish","status":"done","priority":2,"description":"**Problem**: Portal needs `portal init bash` and `portal init fish` commands that emit shell-specific functions and completions. Unsupported shell names should produce an error.\n\n**Solution**: Extend portal init to support bash and fish alongside zsh. Each shell gets appropriate syntax for function definitions and completions. Unsupported shell names produce an error with exit code 2.\n\n**Outcome**: portal init works for bash, zsh, and fish. Unsupported shells produce a clear error.\n\n**Do**:\n- Implement bash output: bash function syntax, Cobra bash completions\n- Implement fish output: fish function syntax, Cobra fish completions\n- Validate shell argument: must be \"bash\", \"zsh\", or \"fish\"\n- Unsupported shell: print error message to stderr, exit 2 (invalid usage per spec exit codes)\n- No powershell support per spec (Portal wraps tmux, which doesn't run on Windows)\n\n**Acceptance Criteria**:\n- [ ] `portal init bash` emits valid bash functions and completions\n- [ ] `portal init fish` emits valid fish functions and completions\n- [ ] Unsupported shell name prints error and exits with code 2\n- [ ] bash/zsh/fish are the only supported shells\n- [ ] --cmd flag works for all three shells\n\n**Tests**:\n- init bash outputs valid bash syntax\n- init fish outputs valid fish syntax\n- unsupported shell returns exit code 2\n- unsupported shell prints error message\n- cmd flag works with bash\n- cmd flag works with fish\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- CLI Interface (portal init, Supported shells)","parent":"tick-0c342f","created":"2026-02-22T22:07:04Z","updated":"2026-02-23T16:38:26Z","closed":"2026-02-23T16:38:26Z"}
{"id":"tick-b92526","title":"File Browser Alias Shortcut","status":"done","priority":2,"description":"**Problem**: The file browser needs an `a` shortcut that prompts for an alias name and saves the highlighted directory as an alias. The directory is git-root-resolved before saving. No session is started.\n\n**Solution**: Handle the `a` key in the file browser. Prompt for an alias name via inline text input. On confirmation, resolve the highlighted directory to git root, then save to the aliases file via AliasStore. No session creation occurs.\n\n**Outcome**: Pressing `a` in the file browser creates an alias for the highlighted directory without starting a session.\n\n**Do**:\n- Handle `a` key in file browser: enter alias prompt mode\n- Render inline text input for alias name\n- On Enter: validate non-empty name, resolve highlighted directory to git root, call AliasStore.Set(name, resolvedDir), save\n- On Esc: cancel, return to browser\n- If alias name already exists, overwrite (per spec: \"setting an alias that already exists overwrites it\")\n- No session is started after alias creation\n\n**Acceptance Criteria**:\n- [ ] `a` key prompts for alias name\n- [ ] Enter confirms and saves alias\n- [ ] Directory git-root-resolved before saving\n- [ ] Alias stored in ~/.config/portal/aliases\n- [ ] No session started after alias creation\n- [ ] Esc cancels alias prompt\n- [ ] Existing alias name overwrites silently\n\n**Tests**:\n- a key enters alias prompt\n- enter saves alias with git-root-resolved path\n- esc cancels alias prompt\n- empty alias name not saved\n- existing alias name overwrites\n- no session started after alias creation\n\n**Context**:\n\u003e Per spec: \"Add alias: a on a highlighted directory prompts for an alias name. Saves to ~/.config/portal/aliases (directory is resolved to git root first). No session is started.\"\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- File Browser (Add alias) section","parent":"tick-0c342f","created":"2026-02-22T22:07:05Z","updated":"2026-02-23T16:45:55Z","closed":"2026-02-23T16:45:55Z"}
{"id":"tick-d5a1e0","title":"Phase 5: Inside-tmux Mode, Session Management, and Filter Mode","status":"done","priority":2,"parent":"tick-77cbba","created":"2026-02-22T23:00:00Z","updated":"2026-02-23T21:46:15Z","closed":"2026-02-23T21:46:15Z"}
{"id":"tick-e1b2c3","title":"Inside-tmux Detection and Switch-Client","status":"done","priority":2,"description":"**Problem**: Portal always uses exec tmux attach-session to connect to sessions, but when running inside an existing tmux session this would nest tmux (which tmux prevents). Portal needs to detect when it is inside tmux and use switch-client instead of attach.\n\n**Solution**: Create an InsideTmux() detection function that checks the TMUX environment variable. Introduce an abstraction (e.g., SessionConnector interface or mode flag) that selects between attach-session (outside) and switch-client (inside). Wire this into the existing session selection flow so that Enter on a session uses the correct tmux command. When inside tmux, Portal exits normally after issuing switch-client (no exec/process replacement needed).\n\n**Outcome**: Selecting a session from the TUI while inside tmux issues tmux switch-client -t \u003cname\u003e and Portal exits cleanly. Outside tmux, existing exec tmux attach-session behaviour is unchanged.\n\n**Do**:\n- Create internal/tmux/detect.go with InsideTmux() bool -- checks os.Getenv(\"TMUX\") is non-empty\n- Create CurrentSessionName() (string, error) -- runs tmux display-message -p '#{session_name}' to get current session\n- Add SwitchClient(name string) error method to TmuxClient -- runs tmux switch-client -t \u003cname\u003e\n- Modify the session selection handler in cmd/open.go: if InsideTmux(), call SwitchClient then os.Exit(0) instead of syscall.Exec with attach-session\n- Ensure the TUI model carries the insideTmux flag so downstream handlers know which path to take\n\n**Acceptance Criteria**:\n- [ ] InsideTmux() returns true when TMUX env var is set and non-empty\n- [ ] InsideTmux() returns false when TMUX env var is unset or empty\n- [ ] Session selection inside tmux calls tmux switch-client -t \u003cname\u003e\n- [ ] Session selection outside tmux calls exec tmux attach-session -t \u003cname\u003e (unchanged)\n- [ ] Portal exits normally (not exec) after switch-client\n- [ ] All tests pass\n\n**Tests**:\n- InsideTmux returns true when TMUX is set\n- InsideTmux returns false when TMUX is unset\n- InsideTmux returns false when TMUX is empty string\n- session selection inside tmux calls switch-client\n- session selection outside tmux calls attach-session\n- CurrentSessionName returns session name from tmux output\n\n**Edge Cases**:\n- TMUX env var set but empty: treated as outside tmux (empty string is falsy)\n- TMUX var points to dead session: switch-client will fail with tmux error; this is handled at the tmux command layer (error returned to caller)\n\n**Context**:\n\u003e Per spec: \"Portal detects if it's running inside an existing tmux session via the TMUX environment variable.\" Inside tmux, switch-client is used instead of attach. \"No exec is needed -- switch-client is a tmux command sent to the server, not a process replacement. Portal exits normally after issuing the tmux commands.\"\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Running Inside tmux (Detection, Behavior, Session Actions), Process Handoff sections.","parent":"tick-d5a1e0","created":"2026-02-22T23:00:01Z","updated":"2026-02-23T20:13:05Z","closed":"2026-02-23T20:13:05Z"}
{"id":"tick-f4d5e6","title":"Inside-tmux Session List Exclusion and Header","status":"done","priority":2,"description":"**Problem**: When running inside tmux, the current session appears in the session list. Selecting it would switch-client to the session you are already in, which is confusing and pointless. The user also has no visual indicator of which session they are currently in.\n\n**Solution**: When InsideTmux() is true, call CurrentSessionName() to get the current session, filter it out of the session list before display, and render a header line showing the current session name (e.g., \"Current: my-project-x7k2m9\"). When all sessions are filtered out (only current session running), show \"No other sessions\" empty state instead of \"No active sessions\".\n\n**Outcome**: Inside tmux, the TUI excludes the current session from the list, shows a header with the current session name, and displays \"No other sessions\" when no other sessions exist.\n\n**Do**:\n- In the TUI model Init or sessionsMsg handler, if insideTmux, call CurrentSessionName() and store as currentSession\n- Filter sessions: remove any session where Name == currentSession\n- In View(), if insideTmux, render \"Current: {currentSession}\" as the first line before the SESSIONS header\n- Change empty state text: if insideTmux and filtered list empty, render \"No other sessions\" instead of \"No active sessions\"\n- Ensure [n] new in project... option remains visible in all states\n\n**Acceptance Criteria**:\n- [ ] Current session excluded from session list when inside tmux\n- [ ] Header shows \"Current: {session_name}\" when inside tmux\n- [ ] No header shown when outside tmux\n- [ ] \"No other sessions\" displayed when only current session exists\n- [ ] \"No active sessions\" still used when outside tmux with zero sessions\n- [ ] [n] new in project... always visible\n- [ ] All tests pass\n\n**Tests**:\n- current session excluded from list inside tmux\n- header renders current session name inside tmux\n- no header rendered outside tmux\n- empty state shows \"No other sessions\" when only current session\n- empty state shows \"No active sessions\" outside tmux\n- multiple sessions minus current renders correctly\n- very long current session name renders in header without truncation\n\n**Edge Cases**:\n- Only one session running (the current one): list is empty after exclusion, \"No other sessions\" shown\n- Current session name very long: header still renders fully\n\n**Context**:\n\u003e Per spec: \"Current session is excluded from the session list (you're already in it). Header shows current session name for context (e.g., from TMUX env var parsing or tmux display-message -p '#{session_name}').\" The spec shows a distinct empty state: \"No other sessions\" for the inside-tmux case.\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- TUI Differences When Inside tmux, Empty States sections.","parent":"tick-d5a1e0","created":"2026-02-22T23:00:02Z","updated":"2026-02-23T20:44:53Z","closed":"2026-02-23T20:44:53Z"}
{"id":"tick-a7b8c9","title":"Inside-tmux New Session Creation","status":"done","priority":2,"description":"**Problem**: When inside tmux, creating a new session with the standard tmux new-session -A -s \u003cname\u003e -c \u003cdir\u003e followed by exec would attempt to nest tmux. New sessions must be created detached, then switch-client used to move to them.\n\n**Solution**: Modify the session creation flow to detect inside-tmux mode. When inside tmux, use tmux new-session -d -s \u003cname\u003e -c \u003cdir\u003e (detached) followed by tmux switch-client -t \u003cname\u003e. When outside tmux, retain the existing exec tmux new-session -A -s \u003cname\u003e -c \u003cdir\u003e behaviour.\n\n**Outcome**: Creating a new session from the project picker or file browser while inside tmux creates the session detached and switches to it. Outside tmux, existing behaviour unchanged.\n\n**Do**:\n- Add NewSessionDetached(name, dir string) error to TmuxClient -- runs tmux new-session -d -s \u003cname\u003e -c \u003cdir\u003e\n- Modify SessionCreator.CreateFromDir to accept an insideTmux flag (or use the SessionConnector pattern)\n- When insideTmux: call NewSessionDetached then SwitchClient, then exit normally\n- When outside: call existing NewSession (with -A flag) then exec handoff\n- Wire through from both TUI project selection and file browser selection paths\n\n**Acceptance Criteria**:\n- [ ] Inside tmux: new session created with -d flag (detached)\n- [ ] Inside tmux: switch-client called after detached creation\n- [ ] Inside tmux: Portal exits normally (no exec)\n- [ ] Outside tmux: new-session with -A flag and exec handoff (unchanged)\n- [ ] Session name collision retry works in detached mode\n- [ ] All tests pass\n\n**Tests**:\n- inside tmux creates session detached then switches\n- outside tmux creates session with exec handoff\n- detached creation uses -d flag not -A flag\n- switch-client called with correct session name\n- session name collision triggers regeneration in detached mode\n\n**Edge Cases**:\n- Session name collision during detached creation: GenerateSessionName retry logic applies identically; the collision check uses tmux has-session which works regardless of attach mode\n\n**Context**:\n\u003e Per spec: \"New session from project: tmux new-session -d -s \u003cname\u003e -c \u003cdir\u003e then tmux switch-client -t \u003cname\u003e\" for inside-tmux case. The -d flag creates the session without attaching. switch-client then moves the current client to it.\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Inside tmux: Session Actions, tmux Integration (Create detached) sections.","parent":"tick-d5a1e0","created":"2026-02-22T23:00:03Z","updated":"2026-02-23T20:50:54Z","closed":"2026-02-23T20:50:54Z"}
{"id":"tick-d1e2f3","title":"Inside-tmux CLI Command Routing","status":"done","priority":2,"description":"**Problem**: CLI quick-start paths (portal open ., portal open \u003cpath\u003e, portal open \u003cquery\u003e) and portal attach use exec to hand off to tmux. Inside tmux, these must use detached creation + switch-client (for new sessions) or switch-client (for attach) instead of exec.\n\n**Solution**: Add InsideTmux() check to all CLI command paths that interact with tmux sessions. For portal open (quick-start): create session detached then switch-client. For portal attach: switch-client instead of attach-session. Portal exits normally after these operations when inside tmux.\n\n**Outcome**: All CLI paths work correctly inside tmux. portal open . creates a detached session and switches. portal attach \u003cname\u003e switches to the named session. No exec calls inside tmux.\n\n**Do**:\n- In cmd/open.go quick-start path: check InsideTmux(); if true, use NewSessionDetached + SwitchClient instead of exec NewSession\n- In cmd/attach.go (or wherever portal attach is handled): check InsideTmux(); if true, call SwitchClient instead of exec attach-session\n- Ensure query resolution chain (alias -\u003e zoxide -\u003e fallback) still works identically; only the final tmux command changes\n- All paths exit with os.Exit(0) after successful switch-client\n- Error handling: if switch-client fails (e.g., session killed between lookup and switch), print error and exit 1\n\n**Acceptance Criteria**:\n- [ ] portal open . inside tmux creates detached session and switches\n- [ ] portal open \u003cpath\u003e inside tmux creates detached session and switches\n- [ ] portal open \u003cquery\u003e inside tmux creates detached session and switches (after resolution)\n- [ ] portal attach \u003cname\u003e inside tmux calls switch-client\n- [ ] All CLI paths use exec outside tmux (unchanged)\n- [ ] Error printed and exit 1 if switch-client fails\n- [ ] All tests pass\n\n**Tests**:\n- open dot inside tmux uses detached creation and switch-client\n- open path inside tmux uses detached creation and switch-client\n- attach inside tmux uses switch-client\n- open dot outside tmux uses exec (unchanged)\n- attach outside tmux uses exec attach-session (unchanged)\n- switch-client failure prints error and exits 1\n\n**Edge Cases**:\n- TMUX set but session killed before switch: switch-client returns error; Portal prints error message and exits 1\n\n**Context**:\n\u003e Per spec: \"CLI commands also use switch-client instead of attach: x ., x \u003cpath\u003e, x \u003cquery\u003e -\u003e create session detached, then switch-client. xctl attach \u003cname\u003e -\u003e switch-client to the named session.\"\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- CLI Commands Inside tmux, Running Inside tmux sections.","parent":"tick-d5a1e0","created":"2026-02-22T23:00:04Z","updated":"2026-02-23T20:55:36Z","closed":"2026-02-23T20:55:36Z"}
{"id":"tick-b4c5d6","title":"Kill Session with Confirmation","status":"done","priority":2,"description":"**Problem**: Users cannot kill tmux sessions from the TUI. The K shortcut is documented in the spec but not yet implemented. Killing requires a confirmation prompt to prevent accidental destruction.\n\n**Solution**: Handle the K key in the session list TUI. When pressed on a highlighted session, display a confirmation prompt: \"Kill session '\u003cname\u003e'? (y/n)\". On y, call tmux kill-session -t \u003cname\u003e, refresh the session list, and adjust cursor position. On n or Esc, cancel and return to normal mode. The confirmation is a TUI state (e.g., confirmKill mode) that intercepts all keypresses.\n\n**Outcome**: Pressing K on a session shows a confirmation prompt. Confirming kills the session via tmux and refreshes the list. Declining returns to normal navigation.\n\n**Do**:\n- Add confirmKill state to the TUI model with pendingKillName string\n- Handle K key in normal mode: if cursor is on a session (not the [n] option), enter confirmKill state\n- In confirmKill state: render \"Kill session '\u003cname\u003e'? (y/n)\" at the bottom or inline\n- Handle y: call TmuxClient.KillSession(name), re-fetch sessions, adjust cursor if needed\n- Handle n or Esc: return to normal mode, clear confirmKill state\n- Add KillSession(name string) error to TmuxClient -- runs tmux kill-session -t \u003cname\u003e\n- After kill, re-fetch session list via a tea.Cmd\n- If cursor was on last item and it was killed, move cursor up\n- K on [n] new in project... option is a no-op\n\n**Acceptance Criteria**:\n- [ ] K on a session shows \"Kill session '\u003cname\u003e'? (y/n)\" prompt\n- [ ] y confirms kill and refreshes session list\n- [ ] n cancels and returns to normal mode\n- [ ] Esc cancels and returns to normal mode\n- [ ] Session list refreshed after kill (killed session removed)\n- [ ] Cursor adjusted if killed session was last in list\n- [ ] K on [n] option is no-op\n- [ ] All tests pass\n\n**Tests**:\n- K enters confirmation mode with session name\n- y in confirmation mode triggers kill and refresh\n- n in confirmation mode cancels\n- Esc in confirmation mode cancels\n- session list refreshes after kill\n- cursor adjusts when last session killed\n- K on new-in-project option is no-op\n- killing last remaining session shows empty state\n\n**Edge Cases**:\n- Killing last session: after refresh, empty state (\"No active sessions\" or \"No other sessions\") displayed\n- Killing current session inside tmux: tmux kill-session works on any session; if the user somehow targets the current session (shouldn't appear in list inside tmux, but defensively), tmux handles it. Per spec, current session is excluded from list when inside tmux, so this case is prevented by Task 5-2.\n\n**Context**:\n\u003e Per spec: \"Kill confirmation: Pressing K prompts for confirmation before killing the selected session: 'Kill session myapp? (y/n)'.\" Kill command is tmux kill-session -t \u003cname\u003e, same inside and outside tmux.\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Keyboard Shortcuts (Kill confirmation), tmux Integration (Kill session) sections.","parent":"tick-d5a1e0","created":"2026-02-22T23:00:05Z","updated":"2026-02-23T21:05:49Z","closed":"2026-02-23T21:05:49Z"}
{"id":"tick-e7f8a9","title":"Rename Session with Inline Input","status":"done","priority":2,"description":"**Problem**: Users cannot rename tmux sessions from the TUI. The R shortcut is documented in the spec but not yet implemented. Renaming requires an inline text input pre-filled with the current name.\n\n**Solution**: Handle the R key in the session list TUI. When pressed on a highlighted session, enter rename mode: display an inline text input pre-filled with the current session name. Enter confirms and calls tmux rename-session. Esc cancels. After successful rename, refresh the session list.\n\n**Outcome**: Pressing R on a session shows an inline text input. Confirming renames the session via tmux and refreshes the list. Cancelling returns to normal navigation.\n\n**Do**:\n- Add renameMode state to the TUI model with renameInput (Bubble Tea textinput component), renameTarget string\n- Handle R key in normal mode: if cursor is on a session, enter renameMode, initialise textinput with current name\n- In renameMode: render the text input inline (replacing the session row or at bottom)\n- Handle Enter: validate non-empty, call TmuxClient.RenameSession(oldName, newName), re-fetch sessions\n- Handle Esc: cancel rename, return to normal mode\n- Add RenameSession(oldName, newName string) error to TmuxClient -- runs tmux rename-session -t \u003coldName\u003e \u003cnewName\u003e\n- After rename, re-fetch session list, cursor stays at same index\n- R on [n] new in project... option is a no-op\n\n**Acceptance Criteria**:\n- [ ] R on a session enters rename mode with pre-filled text input\n- [ ] Enter confirms rename and refreshes session list\n- [ ] Esc cancels rename and returns to normal mode\n- [ ] tmux rename-session called with correct old and new names\n- [ ] Empty name input does not trigger rename\n- [ ] R on [n] option is no-op\n- [ ] All tests pass\n\n**Tests**:\n- R enters rename mode with current name pre-filled\n- Enter in rename mode calls rename-session and refreshes\n- Esc in rename mode cancels without renaming\n- empty input does not trigger rename\n- R on new-in-project option is no-op\n- session list refreshes after successful rename\n- renamed session appears with new name in list\n\n**Edge Cases**:\n- Invalid characters in name: tmux rename-session handles validation; if tmux returns an error, display it and stay in rename mode or return to normal mode\n- Collision with existing session: tmux rename-session returns an error if the new name already exists; Portal should display the error and not leave the session in a broken state\n\n**Context**:\n\u003e Per spec: \"Rename prompt: Pressing R shows an inline text input pre-filled with the current session name. Enter confirms, Esc cancels.\" tmux rename-session works from outside the session, so renaming is available in all contexts.\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Keyboard Shortcuts (Rename prompt), Session Naming (Renaming), tmux Integration (Rename session) sections.","parent":"tick-d5a1e0","created":"2026-02-22T23:00:06Z","updated":"2026-02-23T21:14:03Z","closed":"2026-02-23T21:14:03Z"}
{"id":"tick-c1d2e3","title":"Filter Mode Activation and Fuzzy Matching","status":"done","priority":2,"description":"**Problem**: With many sessions, users need a way to quickly narrow down the list. The spec defines a filter mode activated by / that fuzzy-matches session names, but it is not yet implemented.\n\n**Solution**: Add a filterMode state to the session list TUI. When / is pressed, enter filter mode: show a filter input at the bottom (e.g., \"filter: _\"), capture all subsequent keystrokes as filter text, fuzzy-match against session names, and display only matching sessions. The [n] new in project... option is always visible regardless of filter. Arrow keys still navigate the filtered results. Enter selects the highlighted item.\n\n**Outcome**: / activates filter mode. Typing narrows the session list by fuzzy match. [n] new in project... always visible. Enter selects from filtered results.\n\n**Do**:\n- Add filterMode bool, filterText string to the TUI model\n- Handle / key in normal mode: set filterMode = true, filterText = \"\"\n- In filterMode, all rune keypresses append to filterText\n- Implement fuzzy matching: filter sessions where name fuzzy-matches filterText (use a simple contains or subsequence match)\n- Compute filteredSessions on each filterText change\n- View renders only filteredSessions when filterMode is active\n- [n] new in project... always rendered at bottom regardless of filter\n- Arrow keys / j/k navigate filteredSessions\n- Enter on highlighted item: select session (or [n] option) -- same as normal mode\n- Cursor resets to 0 when filter text changes\n- Render \"filter: {text}\" at the bottom of the session list\n- Shortcut keys (n, K, R, q) lose their shortcut meaning in filter mode -- they become typeable characters\n\n**Acceptance Criteria**:\n- [ ] / activates filter mode with empty filter\n- [ ] Typing narrows session list by fuzzy match\n- [ ] [n] new in project... always visible during filtering\n- [ ] Arrow keys navigate filtered results\n- [ ] Enter selects highlighted item from filtered list\n- [ ] Filter input rendered at bottom\n- [ ] Shortcut keys (n, K, R, q) are typeable in filter mode\n- [ ] Cursor resets to 0 when filter changes\n- [ ] All tests pass\n\n**Tests**:\n- slash activates filter mode\n- typing narrows session list\n- fuzzy match filters correctly (subsequence matching)\n- new-in-project option always visible during filter\n- enter selects from filtered list\n- shortcut keys are typeable in filter mode\n- cursor resets when filter text changes\n- no sessions match filter shows empty filtered list with new-in-project visible\n- single character filter works correctly\n\n**Edge Cases**:\n- No sessions match filter: empty list shown, but [n] new in project... still visible and selectable\n- Single character filter: matches all sessions containing that character\n\n**Context**:\n\u003e Per spec: \"Press /. A filter input appears at the bottom of the list. All subsequent keystrokes are treated as filter input -- shortcut keys (n, k, K, etc.) lose their shortcut meaning and become typeable characters.\" Fuzzy matching against session names. \"The [n] new in project... option is always visible and never filtered out.\"\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Filter Mode section.","parent":"tick-d5a1e0","created":"2026-02-22T23:00:07Z","updated":"2026-02-23T21:20:03Z","closed":"2026-02-23T21:20:03Z"}
{"id":"tick-f4a5b6","title":"Filter Mode Exit Behaviour","status":"done","priority":2,"description":"**Problem**: Once in filter mode, users need clear ways to exit. The spec defines two exit paths: Backspace on empty filter exits mode, and Esc clears filter and exits mode. These are not yet implemented.\n\n**Solution**: Extend the filter mode key handling. Backspace removes the last character from filterText; if filterText is already empty, exit filter mode (restore full session list). Esc clears filterText and exits filter mode regardless of current filter state.\n\n**Outcome**: Backspace progressively removes filter characters and exits mode when empty. Esc immediately clears and exits. Both restore the full unfiltered session list.\n\n**Do**:\n- In filterMode, handle Backspace: if filterText non-empty, remove last character and re-filter; if filterText empty, exit filterMode\n- In filterMode, handle Esc: set filterText = \"\", set filterMode = false, restore full session list\n- When exiting filter mode, reset cursor to 0 (or optionally preserve selection if the previously highlighted session is still in the full list)\n- Ensure that after exiting filter mode, all shortcut keys (n, K, R, q, /) work again\n- q and other quit keys should NOT quit the app while in filter mode -- they are typeable characters per Task 5-7\n\n**Acceptance Criteria**:\n- [ ] Backspace removes last filter character\n- [ ] Backspace on empty filter exits filter mode\n- [ ] Esc clears filter and exits filter mode\n- [ ] Full session list restored after exiting filter mode\n- [ ] Shortcut keys work again after exiting filter mode\n- [ ] q does not quit while in filter mode\n- [ ] All tests pass\n\n**Tests**:\n- backspace removes last filter character\n- backspace on empty filter exits filter mode\n- esc clears filter and exits filter mode\n- full session list restored after exit\n- shortcut keys functional after filter mode exit\n- q in filter mode types 'q' instead of quitting\n- rapid backspace presses drain filter then exit mode\n- esc with active filter clears and exits in one action\n\n**Edge Cases**:\n- Rapid Backspace presses: each press removes one character; when empty, next press exits mode. No special debouncing needed.\n- Filter active with no matches: Esc still clears and exits; Backspace still works character by character\n\n**Context**:\n\u003e Per spec: \"Backspace deletes the last filter character; if the filter is already empty, exits filter mode. Esc clears the filter and exits filter mode.\" Outside filter mode, all single-key shortcuts work as documented.\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Filter Mode section.","parent":"tick-d5a1e0","created":"2026-02-22T23:00:08Z","updated":"2026-02-23T21:23:37Z","closed":"2026-02-23T21:23:37Z"}
{"id":"tick-d7e8f9","title":"List Command with TTY-Aware Output","status":"done","priority":2,"description":"**Problem**: Portal has no portal list (xctl list) command. Users need a CLI command that lists sessions with TTY-aware output: full details on a terminal, names only when piped. Override flags --short and --long are needed for scripting.\n\n**Solution**: Implement the portal list Cobra command. Detect whether stdout is a TTY using os.Stdout.Stat() and checking for os.ModeCharDevice. Output full details (name, attached/detached status, window count) on TTY, names only when piped. --short forces names-only, --long forces full details. When no sessions exist, output nothing and exit 0.\n\n**Outcome**: portal list outputs TTY-aware session information. --short and --long override detection. Empty output and exit 0 when no sessions.\n\n**Do**:\n- Create cmd/list.go with Cobra command for portal list\n- Add --short and --long boolean flags (mutually exclusive)\n- Detect TTY: stat, _ := os.Stdout.Stat(); isTTY := (stat.Mode() \u0026 os.ModeCharDevice) != 0\n- Determine output mode: if --short, names only; if --long, full details; else use TTY detection\n- Call TmuxClient.ListSessions()\n- Full details format: \"{name}    {attached|detached}    {N} window(s)\" per line\n- Names only format: one name per line\n- No sessions: output nothing, exit 0\n- Inside tmux: include ALL sessions (including current) -- the CLI list is always complete per spec\n\n**Acceptance Criteria**:\n- [ ] portal list on TTY shows full details\n- [ ] portal list piped shows names only\n- [ ] --short forces names only even on TTY\n- [ ] --long forces full details even when piped\n- [ ] No sessions produces empty output and exit 0\n- [ ] Window count correctly pluralised\n- [ ] Attached/detached status shown in long format\n- [ ] All sessions included (even current session inside tmux)\n- [ ] All tests pass\n\n**Tests**:\n- TTY output includes name, status, window count\n- piped output shows names only\n- short flag forces names only\n- long flag forces full details\n- no sessions produces empty output\n- exit code is 0 with no sessions\n- all sessions listed inside tmux (no exclusion)\n- window count pluralisation correct\n\n**Edge Cases**:\n- No sessions running (or no tmux server): empty stdout, exit 0\n- Piped to another command: names-only output enables xctl list | fzf pattern\n\n**Context**:\n\u003e Per spec: \"xctl list adapts its output based on whether stdout is a terminal.\" Interactive shows \"flowx-dev    attached    3 windows\", piped shows names only. \"Inside tmux: xctl list includes all sessions (including the current one). The TUI excludes the current session for UX reasons, but the CLI output is always complete.\" \"No sessions: empty stdout, exit 0.\"\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- xctl list TTY-Aware Output, Exit Codes, Scripting \u0026 fzf Integration sections.","parent":"tick-d5a1e0","created":"2026-02-22T23:00:09Z","updated":"2026-02-23T21:28:29Z","closed":"2026-02-23T21:28:29Z"}
{"id":"tick-a1b2c4","title":"Attach Command","status":"done","priority":2,"description":"**Problem**: Portal has no portal attach (xctl attach) command. Users need a CLI command to attach to a session by exact name, with inside-tmux awareness (switch-client instead of attach).\n\n**Solution**: Implement the portal attach \u003cname\u003e Cobra command. Look up the session by exact name using tmux has-session. If found, attach (outside tmux) or switch-client (inside tmux). If not found, print \"No session found: {name}\" and exit 1.\n\n**Outcome**: portal attach \u003cname\u003e connects to the named session using the correct tmux command based on context. Clear error message and exit 1 when session not found.\n\n**Do**:\n- Create cmd/attach.go with Cobra command for portal attach\n- Accept exactly one positional argument: session name\n- Call TmuxClient.HasSession(name) to check existence\n- If not found: print \"No session found: {name}\" to stderr, exit 1\n- If found and outside tmux: exec tmux attach-session -t \u003cname\u003e\n- If found and inside tmux: call SwitchClient(name), exit 0\n- Add HasSession(name string) (bool, error) to TmuxClient if not already present -- runs tmux has-session -t \u003cname\u003e, returns true on exit 0\n\n**Acceptance Criteria**:\n- [ ] portal attach \u003cname\u003e attaches to named session outside tmux\n- [ ] portal attach \u003cname\u003e switches to named session inside tmux\n- [ ] \"No session found: {name}\" printed and exit 1 when not found\n- [ ] Exact name matching (no partial/fuzzy matching)\n- [ ] Exit code 0 on success\n- [ ] All tests pass\n\n**Tests**:\n- attach to existing session outside tmux uses exec attach-session\n- attach to existing session inside tmux uses switch-client\n- non-existent session prints error and exits 1\n- exact name match only (no partial matching)\n- session killed between has-session and attach returns error\n\n**Edge Cases**:\n- Partial name match: not supported; exact match only per spec (\"xctl attach \u003cname\u003e\" implies exact name)\n- Ambiguous name: not applicable since tmux has-session uses exact match\n- Session killed between lookup and attach: tmux attach/switch will fail; Portal reports the tmux error\n\n**Context**:\n\u003e Per spec: \"xctl attach \u003cname\u003e -- Attach to session by exact name.\" Errors: \"No session found: {name}\" with exit 1. Inside tmux uses switch-client per CLI Commands Inside tmux section.\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- xctl commands (attach), Attach errors, CLI Commands Inside tmux, Exit Codes sections.","parent":"tick-d5a1e0","created":"2026-02-22T23:00:10Z","updated":"2026-02-23T21:32:37Z","closed":"2026-02-23T21:32:37Z"}
{"id":"tick-e3f4d5","title":"Kill Command","status":"done","priority":2,"description":"**Problem**: Portal has no portal kill (xctl kill) command. Users need a CLI command to kill a tmux session by exact name with proper error handling.\n\n**Solution**: Implement the portal kill \u003cname\u003e Cobra command. Check session existence with tmux has-session. If found, kill it with tmux kill-session -t \u003cname\u003e. If not found, print \"No session found: {name}\" and exit 1. No confirmation prompt for the CLI command (the TUI has its own confirmation via K key).\n\n**Outcome**: portal kill \u003cname\u003e kills the named session. Clear error message and exit 1 when session not found. No confirmation needed for CLI usage.\n\n**Do**:\n- Create cmd/kill.go with Cobra command for portal kill\n- Accept exactly one positional argument: session name\n- Call TmuxClient.HasSession(name) to check existence\n- If not found: print \"No session found: {name}\" to stderr, exit 1\n- If found: call TmuxClient.KillSession(name) (reuse method from Task 5-5)\n- Exit 0 on success\n- No confirmation prompt (CLI is non-interactive by design)\n\n**Acceptance Criteria**:\n- [ ] portal kill \u003cname\u003e kills the named session\n- [ ] \"No session found: {name}\" printed and exit 1 when not found\n- [ ] Exit code 0 on success\n- [ ] No confirmation prompt\n- [ ] tmux kill-session -t \u003cname\u003e called\n- [ ] All tests pass\n\n**Tests**:\n- kill existing session calls kill-session and exits 0\n- non-existent session prints error and exits 1\n- kill command uses exact name match\n- no confirmation prompt in CLI mode\n- killing current session inside tmux works (tmux handles it)\n\n**Edge Cases**:\n- Killing current session inside tmux: tmux kill-session -t \u003cname\u003e works even on the current session. tmux will switch the client to the next session or terminate the client if no other sessions exist. Portal does not need special handling.\n- Session name not found: error message and exit 1\n\n**Context**:\n\u003e Per spec: \"xctl kill \u003cname\u003e -- Kill a session.\" Errors: \"No session found: {name}\" with exit 1. The CLI kill command is non-interactive -- the confirmation prompt is only in the TUI (K key).\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- xctl commands (kill), Kill errors, Exit Codes sections.","parent":"tick-d5a1e0","created":"2026-02-22T23:00:11Z","updated":"2026-02-23T21:36:04Z","closed":"2026-02-23T21:36:04Z"}
{"id":"tick-b6c7a8","title":"Clean Command","status":"done","priority":2,"description":"**Problem**: Portal has no portal clean (xctl clean) command. Users need a CLI command to remove stale projects (directories that no longer exist on disk) from projects.json without interactive prompts.\n\n**Solution**: Implement the portal clean Cobra command. Load the project store, iterate all projects, check each directory with os.Stat. Remove projects whose directories no longer exist. Print each removal for visibility. Non-interactive -- no confirmation prompts.\n\n**Outcome**: portal clean removes stale projects and prints each removal. Exits 0 regardless of whether any projects were removed.\n\n**Do**:\n- Create cmd/clean.go with Cobra command for portal clean\n- Load ProjectStore\n- Iterate projects, check os.Stat on each path\n- For each non-existent directory: print \"Removed stale project: {name} ({path})\" and mark for removal\n- For permission errors: skip (keep the project, do not print)\n- Save updated project list if any removals occurred\n- Exit 0 in all cases\n- Reuse ProjectStore.CleanStale() from Phase 2 if its signature supports printing, or implement a CLI-specific variant that provides per-removal callbacks\n\n**Acceptance Criteria**:\n- [ ] Removes projects with non-existent directories\n- [ ] Prints \"Removed stale project: {name} ({path})\" for each removal\n- [ ] Does not remove projects with permission errors\n- [ ] No confirmation prompts\n- [ ] Exit 0 even when no stale projects found\n- [ ] Exit 0 when all projects are stale\n- [ ] All tests pass\n\n**Tests**:\n- removes stale project and prints removal message\n- keeps project with existing directory (no output for it)\n- keeps project with permission error\n- no stale projects produces no output\n- all projects stale removes all and prints each\n- multiple stale projects each printed\n- exit code 0 in all cases\n\n**Edge Cases**:\n- No stale projects: no output, exit 0\n- All projects stale: all removed, each printed, exit 0\n- Permission errors: project retained silently (not printed as removed, not printed as error)\n\n**Context**:\n\u003e Per spec: \"xctl clean -- Removes projects whose directories no longer exist on disk. Prints each action taken (e.g., 'Removed stale project: myapp (/Users/lee/Code/myapp)'). Non-interactive -- no confirmation prompts.\"\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Stale Project Cleanup (Via xctl clean), xctl commands (clean) sections.","parent":"tick-d5a1e0","created":"2026-02-22T23:00:12Z","updated":"2026-02-23T21:46:15Z","closed":"2026-02-23T21:46:15Z"}
{"id":"tick-a6b7c9","title":"Phase 6: Command Execution, Project Editing, and Distribution","status":"done","priority":2,"parent":"tick-77cbba","created":"2026-02-22T23:30:00Z","updated":"2026-02-24T09:53:40Z","closed":"2026-02-24T09:53:40Z"}
{"id":"tick-d9e0f1","title":"Command Flag Parsing (-e and --)","status":"done","priority":2,"description":"**Problem**: Portal's open command does not support passing a command to execute in new sessions. The spec defines two syntaxes: -e/--exec for simple commands and -- (double-dash) for compound commands with arguments. These are mutually exclusive, and both must resolve to an internal command slice early in CLI parsing.\n\n**Solution**: Extend the portal open Cobra command to accept -e/--exec as a string flag and handle -- as an args separator. Parse both into a unified []string command field. Validate mutual exclusivity -- providing both produces an error message and exit code 2. When a command is present, pass it downstream via the existing session creation flow.\n\n**Outcome**: portal open -e \u003ccmd\u003e and portal open [destination] -- \u003ccmd\u003e [args...] both parse into a command slice. Mutual exclusivity is enforced with a clear error message.\n\n**Do**:\n- In cmd/open.go, add -e/--exec string flag to the open command\n- Handle ArgsAfterDash (Cobra provides args after -- via cobra.ArbitraryArgs or manual parsing of os.Args)\n- Parse -e value into a single-element command slice: []string{execFlag}\n- Parse -- args into a command slice: os.Args after the -- separator\n- If both -e and -- are provided, print \"Error: -e/--exec and -- are mutually exclusive\" to stderr and exit 2\n- Store the parsed command in a variable accessible to downstream session creation logic\n- If -e is provided with an empty string, print \"Error: -e/--exec requires a command\" to stderr and exit 2\n- If -- is provided with no subsequent arguments, print \"Error: no command provided after --\" to stderr and exit 2\n- Ensure the destination argument is correctly parsed regardless of command syntax\n\n**Acceptance Criteria**:\n- [ ] -e flag accepted and parsed into command slice\n- [ ] -- separator parsed and subsequent args captured as command slice\n- [ ] Both -e and -- provided produces error and exit 2\n- [ ] -e with empty string produces error and exit 2\n- [ ] -- with no arguments produces error and exit 2\n- [ ] Destination argument correctly identified in both syntaxes\n- [ ] portal open (no flags) works unchanged -- no command, normal TUI flow\n- [ ] All tests pass\n\n**Tests**:\n- parses -e flag into command slice\n- parses -- args into command slice\n- both -e and -- produces exit code 2\n- -e with empty string produces exit code 2\n- -- with no arguments produces exit code 2\n- destination parsed correctly with -e flag (x -e claude myproject)\n- destination parsed correctly with -- syntax (x myproject -- claude --resume)\n- no flags produces nil command (normal flow)\n\n**Edge Cases**:\n- -e with empty string: error, not silently ignored\n- -- with no arguments after it: error, not silently treated as no command\n- Both -e and -- provided: error message names both flags, exit 2\n\n**Context**:\n\u003e Per spec: \"Both are mutually exclusive -- providing both is an error. Both resolve to the same internal command slice early in CLI parsing.\" The -e syntax is for simple commands: x -e claude myproject. The -- syntax is for compound commands: x myproject -- claude --resume --model opus. Exit code 2 is used for invalid usage per the spec's exit code table.\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- x (The Launcher) table, Command execution (-e / --) section, Exit Codes section.","parent":"tick-a6b7c9","created":"2026-02-22T23:30:01Z","updated":"2026-02-23T22:01:31Z","closed":"2026-02-23T22:01:31Z"}
{"id":"tick-c2d3e4","title":"Command-Aware Session Creation","status":"done","priority":2,"description":"**Problem**: Session creation does not support executing a command inside the new session. When -e or -- provides a command, Portal must pass it to tmux as a shell-command argument so the command runs then drops to an interactive shell.\n\n**Solution**: Extend the session creation flow (SessionCreator and TmuxClient) to accept an optional command. When a command is provided, construct the tmux shell-command argument as $SHELL -ic '\u003ccmd\u003e; exec $SHELL'. Pass this as the final argument to tmux new-session. This works for both outside-tmux (new-session -A) and inside-tmux (new-session -d) flows.\n\n**Outcome**: New sessions created with a command execute that command on startup and drop to an interactive shell when the command exits. Sessions without commands start the default shell as before.\n\n**Do**:\n- Add an optional command []string parameter to SessionCreator.CreateFromDir (or introduce CreateFromDirWithCommand)\n- In TmuxClient, extend NewSession and NewSessionDetached to accept an optional shellCommand string\n- When command is provided: join the command slice into a single string, construct \"$SHELL -ic '\u003cjoined_cmd\u003e; exec $SHELL'\"\n- For outside-tmux: tmux new-session -A -s \u003cname\u003e -c \u003cdir\u003e \"$SHELL -ic '\u003ccmd\u003e; exec $SHELL'\"\n- For inside-tmux: tmux new-session -d -s \u003cname\u003e -c \u003cdir\u003e \"$SHELL -ic '\u003ccmd\u003e; exec $SHELL'\" then switch-client\n- When no command: omit the shell-command argument entirely (existing behaviour)\n- Handle single quotes in the command by escaping them (replace ' with '\\'')\n- Read $SHELL from os.Getenv(\"SHELL\"); if empty, fall back to /bin/sh\n- Wire from cmd/open.go: pass the parsed command slice through to session creation\n\n**Acceptance Criteria**:\n- [ ] Command passed as tmux shell-command argument in correct format\n- [ ] $SHELL used to construct the shell invocation\n- [ ] Falls back to /bin/sh when $SHELL is not set\n- [ ] Single quotes in command properly escaped\n- [ ] No shell-command argument when no command provided\n- [ ] Works for outside-tmux flow (new-session -A with exec handoff)\n- [ ] Works for inside-tmux flow (new-session -d with switch-client)\n- [ ] All tests pass\n\n**Tests**:\n- command included in tmux new-session as shell-command\n- shell-command format matches $SHELL -ic '\u003ccmd\u003e; exec $SHELL'\n- SHELL env var used in command construction\n- falls back to /bin/sh when SHELL not set\n- single quotes in command escaped correctly\n- no shell-command argument when command is nil/empty\n- outside-tmux session creation with command uses exec handoff\n- inside-tmux session creation with command uses detached + switch-client\n- multi-word command from -- syntax joined correctly\n\n**Edge Cases**:\n- Command containing single quotes: must be escaped to avoid breaking the shell -ic '...' wrapper (e.g., echo 'hello' becomes echo '\\''hello'\\'')\n- $SHELL not set: use /bin/sh as fallback\n- Special shell characters (\u0026, |, ;, etc.): these are intentionally passed through since the command runs inside $SHELL -ic which handles them\n\n**Context**:\n\u003e Per spec: \"The command is passed as tmux's shell-command argument on new-session. Portal uses $SHELL to detect the user's login shell: tmux new-session -A -s \u003cname\u003e -c \u003cdir\u003e \\\"$SHELL -ic '\u003ccmd\u003e; exec $SHELL'\\\"\". This creates the session with a shell that runs the command, then replaces itself with a fresh interactive shell via exec. For inside-tmux: tmux new-session -d -s \u003cname\u003e -c \u003cdir\u003e \\\"$SHELL -ic '\u003ccmd\u003e; exec $SHELL'\\\" then switch-client.\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Command Execution in Sessions, tmux Integration sections.","parent":"tick-a6b7c9","created":"2026-02-22T23:30:02Z","updated":"2026-02-23T22:15:56Z","closed":"2026-02-23T22:15:56Z"}
{"id":"tick-f5a6b7","title":"Command-Pending TUI Mode","status":"done","priority":2,"description":"**Problem**: When a command is specified via -e or --, the TUI should skip the session list and show only the project picker. Existing sessions are not displayed because the command applies to new sessions only. There is no visual indication of the pending command.\n\n**Solution**: Add a commandPending mode to the TUI. When the command slice is non-empty, the TUI starts directly in the project picker view (skipping the session list). A banner at the top displays \"Command: \u003ccmd\u003e\" to indicate what will run. The project picker behaves normally -- selecting a project creates a session with the pending command. If query resolution produced a TUI fallback, the query is pre-filled as the filter text in the project picker.\n\n**Outcome**: With a pending command, the TUI opens directly to the project picker with a command banner. Session list is not shown. Project selection creates a session with the command.\n\n**Do**:\n- In the TUI model constructor, accept a command []string and optional queryFilter string\n- If command is non-empty, set initial view to viewProjectPicker (skip viewSessionList)\n- Render \"Command: \u003cjoined_cmd\u003e\" as a banner line at the top of the view\n- The project picker shows projects sorted by last_used with browse option at bottom (same as normal)\n- Hide the [n] new in project... option from session list (it is not shown at all since session list is skipped)\n- Esc in command-pending mode quits the TUI entirely (no session list to return to)\n- If a queryFilter is provided (from TUI fallback in query resolution), pre-fill the project picker's filter\n- Project selection flows through the command-aware session creation from Task 6-2\n- Browse option also applies the pending command to the session created from the browser\n\n**Acceptance Criteria**:\n- [ ] Command-pending mode skips session list, shows project picker directly\n- [ ] Banner displays \"Command: \u003ccmd\u003e\" at the top\n- [ ] Project picker lists projects sorted by last_used with browse option\n- [ ] Selecting a project creates session with the pending command\n- [ ] Esc quits TUI (no session list to return to)\n- [ ] Query filter pre-filled when provided\n- [ ] Browse option creates session with pending command\n- [ ] No command (normal flow) shows session list as before\n- [ ] All tests pass\n\n**Tests**:\n- command-pending mode starts in project picker view\n- banner shows command text\n- session list not displayed in command-pending mode\n- project selection creates session with command\n- esc in command-pending mode quits TUI\n- query filter pre-filled in project picker\n- browse selection applies pending command\n- no command starts in session list view (normal flow unchanged)\n- long command text in banner renders without truncation\n\n**Edge Cases**:\n- No saved projects: empty state (\"No saved projects yet.\") with browse still visible; command banner still shown\n- Query pre-filled as filter: project picker filter mode activates with the query text\n- Long command in banner: render fully, no truncation\n\n**Context**:\n\u003e Per spec: \"When -e or -- is provided, the TUI skips the session list and shows the project picker directly, with a banner indicating the pending command.\" The empty state layout shows \"Command: claude\" as the banner and \"PROJECTS\" as the header. The query resolution fallback pre-fills the query as filter text: \"If a command is pending (-e/--), this opens the project picker\" with filter.\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Empty States (Command pending), x (The Launcher) table, Query Resolution section.","parent":"tick-a6b7c9","created":"2026-02-22T23:30:03Z","updated":"2026-02-23T22:23:07Z","closed":"2026-02-23T22:23:07Z"}
{"id":"tick-e8f9a0","title":"Project Picker Edit Mode","status":"done","priority":2,"description":"**Problem**: Users cannot rename projects or manage aliases from the project picker TUI. The spec defines an e shortcut that opens an inline edit for the selected project, allowing renaming and alias management.\n\n**Solution**: Add an editMode state to the project picker. When e is pressed on a highlighted project, display an inline edit with two fields: project name (from projects.json) and aliases (read from ~/.config/portal/aliases filtered to aliases matching the project's directory path). Tab cycles between fields, Enter confirms changes, Esc cancels. Project name changes update projects.json; alias changes update the aliases file.\n\n**Outcome**: Pressing e on a project opens inline edit with name and alias fields. Changes save to the appropriate files. Cancel returns to the project list unchanged.\n\n**Do**:\n- Add editMode state to ProjectPickerModel with editFields: projectName (text input), aliasList (display of current aliases with add/remove)\n- Handle e key in normal mode: if cursor is on a project (not browse option), enter editMode\n- Load current project name from projects.json, load aliases matching project's directory from AliasStore\n- Render inline edit: project name input field, then list of current aliases with [x] to remove, then input to add new alias\n- Tab cycles focus between name field and alias management area\n- Enter confirms: save updated project name via ProjectStore, save alias changes via AliasStore\n- Esc cancels: discard all changes, return to project list\n- e on browse option is a no-op\n- After confirm, refresh project list to show updated name\n\n**Acceptance Criteria**:\n- [ ] e on a project enters edit mode with pre-filled name\n- [ ] Current aliases for the project's directory displayed\n- [ ] Tab cycles between name field and alias area\n- [ ] Enter saves project name and alias changes\n- [ ] Esc cancels without saving\n- [ ] Updated project name reflected in project list after save\n- [ ] Alias additions saved to ~/.config/portal/aliases\n- [ ] Alias removals saved to ~/.config/portal/aliases\n- [ ] e on browse option is no-op\n- [ ] All tests pass\n\n**Tests**:\n- e enters edit mode with current project name\n- aliases for project directory displayed\n- tab cycles between fields\n- enter saves project name change\n- enter saves alias additions\n- enter saves alias removals\n- esc cancels without changes\n- project list refreshes after save\n- e on browse option is no-op\n- edit with no aliases shows empty alias list\n- multiple aliases displayed and manageable\n- alias name collision shows error\n- empty project name not saved\n\n**Edge Cases**:\n- No aliases for the project: alias list shows empty, user can add new ones\n- Multiple aliases: all displayed, each removable independently\n- Alias collision: if the user enters an alias name that already exists (for a different path), show inline error message\n- Empty project name: do not save, keep edit mode active or show validation error\n\n**Context**:\n\u003e Per spec: \"Edit mode: Pressing e opens an inline edit for the selected project. Editable fields: project name (stored in projects.json) and aliases (read/written from ~/.config/portal/aliases, filtered to aliases whose path matches the selected project's directory). Cycle fields with Tab, confirm with Enter, cancel with Esc.\" Project renames update projects.json. Alias changes update the aliases file. Neither affects existing tmux session names.\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Project Picker Interaction (Edit mode), Project Management, Alias Storage sections.","parent":"tick-a6b7c9","created":"2026-02-22T23:30:04Z","updated":"2026-02-23T22:32:23Z","closed":"2026-02-23T22:32:23Z"}
{"id":"tick-b1c2d3","title":"Project Picker Remove with Confirmation","status":"done","priority":2,"description":"**Problem**: Users cannot remove a remembered project from the project picker TUI. The spec defines an x shortcut that removes the selected project with a confirmation prompt.\n\n**Solution**: Handle the x key in the project picker. When pressed on a highlighted project, display a confirmation prompt. On confirmation, remove the project from projects.json via ProjectStore.Remove. Adjust cursor position and refresh the project list. On cancel, return to normal navigation.\n\n**Outcome**: Pressing x on a project shows a confirmation prompt. Confirming removes the project from the remembered list. The project list refreshes with the project gone.\n\n**Do**:\n- Add confirmRemove state to ProjectPickerModel with pendingRemovePath string and pendingRemoveName string\n- Handle x key in normal mode: if cursor is on a project (not browse option), enter confirmRemove state\n- Render confirmation prompt (e.g., \"Remove project '\u003cname\u003e'? (y/n)\")\n- Handle y: call ProjectStore.Remove(path), refresh project list, adjust cursor if needed\n- Handle n or Esc: return to normal mode, clear confirmRemove state\n- If cursor was on last project and it was removed, move cursor up\n- x on browse option is a no-op\n- Do NOT remove aliases associated with the project -- aliases are independent of the project registry per spec\n- After removal, if project list is now empty, show \"No saved projects yet.\" empty state\n\n**Acceptance Criteria**:\n- [ ] x on a project shows confirmation prompt\n- [ ] y confirms removal and refreshes project list\n- [ ] n cancels and returns to normal mode\n- [ ] Esc cancels and returns to normal mode\n- [ ] Removed project no longer appears in list\n- [ ] Cursor adjusted if removed project was last in list\n- [ ] x on browse option is no-op\n- [ ] Aliases not removed when project is removed\n- [ ] Empty state shown when last project removed\n- [ ] All tests pass\n\n**Tests**:\n- x enters confirmation mode with project name\n- y confirms removal and refreshes list\n- n cancels removal\n- esc cancels removal\n- removed project gone from list\n- cursor adjusts when last project removed\n- x on browse option is no-op\n- removing last project shows empty state\n- aliases preserved after project removal\n- rapid key presses do not cause double removal\n\n**Edge Cases**:\n- Removing last project: empty state (\"No saved projects yet.\") displayed, browse option still visible\n- Rapid key presses: confirmation state intercepts all keys, preventing double removal\n- Project has aliases: aliases are NOT removed; they are independent per spec (\"Aliases are pure navigation shortcuts -- they map a short name to a directory path. They are independent of the project registry\")\n\n**Context**:\n\u003e Per spec: \"x -- Remove selected project from remembered list (with confirmation)\". Aliases are independent of the project registry and are not affected by project removal. The project store's Remove method handles the persistence.\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Project Picker Interaction (keyboard shortcuts), Project Management sections.","parent":"tick-a6b7c9","created":"2026-02-22T23:30:05Z","updated":"2026-02-23T22:38:35Z","closed":"2026-02-23T22:38:35Z"}
{"id":"tick-a4b5c6","title":"tmux Runtime Dependency Check","status":"done","priority":1,"description":"**Problem**: Portal requires tmux at runtime. If tmux is not installed or not on PATH, Portal should display a clear error message and exit rather than failing with an obscure error from exec.LookPath or tmux command execution.\n\n**Solution**: Add a tmux availability check at startup (in the root command's PersistentPreRun or at the start of commands that need tmux). Use exec.LookPath(\"tmux\") to verify tmux is available. If not found, print \"Portal requires tmux. Install with: brew install tmux\" to stderr and exit 1. Commands that do not need tmux (portal version, portal init, portal help) should skip this check.\n\n**Outcome**: Running any tmux-dependent portal command without tmux installed shows a clear install message and exits. Non-tmux commands (version, init, help) work regardless.\n\n**Do**:\n- Create internal/tmux/check.go with CheckTmuxAvailable() error -- uses exec.LookPath(\"tmux\")\n- If LookPath fails, return a descriptive error\n- In cmd/root.go, add PersistentPreRunE that calls CheckTmuxAvailable() for tmux-dependent commands\n- Skip the check for: portal version, portal init, portal help (and their subcommands)\n- Alternatively, add the check to each tmux-dependent command's PreRunE (open, list, attach, kill, clean)\n- Print \"Portal requires tmux. Install with: brew install tmux\" and exit 1 on failure\n- Remove any ad-hoc LookPath checks from other commands (e.g., the one in Task 1-6 attach flow) and centralise here\n\n**Acceptance Criteria**:\n- [ ] Missing tmux prints \"Portal requires tmux. Install with: brew install tmux\" to stderr\n- [ ] Exit code 1 when tmux is missing\n- [ ] portal version works without tmux\n- [ ] portal init works without tmux\n- [ ] portal help works without tmux\n- [ ] portal open fails with message when tmux missing\n- [ ] portal list fails with message when tmux missing\n- [ ] portal attach fails with message when tmux missing\n- [ ] portal kill fails with message when tmux missing\n- [ ] All tests pass\n\n**Tests**:\n- CheckTmuxAvailable returns nil when tmux is on PATH\n- CheckTmuxAvailable returns error when tmux is not on PATH\n- tmux-dependent commands show error when tmux missing\n- portal version does not check for tmux\n- portal init does not check for tmux\n- error message matches spec text exactly\n\n**Edge Cases**:\n- tmux not executable (permissions issue): LookPath may find it but execution will fail; this is caught at command execution time, not at startup\n- Broken symlink to tmux: LookPath finds the binary but it cannot execute; handled similarly to tmux not found\n\n**Context**:\n\u003e Per spec: \"If tmux is somehow missing at runtime, Portal displays: 'Portal requires tmux. Install with: brew install tmux'\". tmux is a runtime dependency, not a build-time dependency. The Homebrew formula declares tmux as a dependency for automatic install, but this check handles edge cases where tmux is removed or Portal is installed manually.\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Runtime Dependency, Distribution sections.","parent":"tick-a6b7c9","created":"2026-02-22T23:30:06Z","updated":"2026-02-23T12:57:55Z","closed":"2026-02-23T12:57:55Z"}
{"id":"tick-d7e8f0","title":"Version Command","status":"done","priority":2,"description":"**Problem**: Portal has no portal version command. Users and package managers need a way to query the installed version.\n\n**Solution**: Add a portal version Cobra command that prints version information. The version string is set at build time via Go linker flags (-ldflags \"-X main.version=...\"). If not set (development builds), display \"dev\" as the version.\n\n**Outcome**: portal version prints the version string. Build-time injection via ldflags sets the version. Development builds show \"dev\".\n\n**Do**:\n- Create cmd/version.go with Cobra command for portal version\n- Declare a package-level var version = \"dev\" in main.go (or cmd/version.go)\n- GoReleaser will set this via ldflags: -X main.version={{.Version}} (or equivalent)\n- Output format: \"portal version {version}\" (e.g., \"portal version 1.2.3\" or \"portal version dev\")\n- No tmux dependency check needed for this command\n\n**Acceptance Criteria**:\n- [ ] portal version prints version string\n- [ ] Default version is \"dev\" when not set at build time\n- [ ] Version injectable via -ldflags \"-X main.version=1.0.0\"\n- [ ] Output format: \"portal version {version}\"\n- [ ] No tmux check on this command\n- [ ] All tests pass\n\n**Tests**:\n- version command outputs version string\n- default version is \"dev\"\n- version set via ldflags overrides default\n- output matches expected format\n\n**Edge Cases**:\n- Version not set at build time: defaults to \"dev\", not empty string or panic\n\n**Context**:\n\u003e Per spec: \"portal version -- Show version information\". This is a direct command on the portal binary. It is listed alongside portal help as a non-tmux command.\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- portal (Direct Commands) table.","parent":"tick-a6b7c9","created":"2026-02-22T23:30:07Z","updated":"2026-02-24T09:53:20Z","closed":"2026-02-24T09:53:20Z"}
{"id":"tick-f1a2b3","title":"GoReleaser Configuration","status":"done","priority":2,"description":"**Problem**: Portal needs a cross-platform build and release pipeline. The spec requires macOS (arm64, amd64) and Linux (arm64, amd64) builds distributed via Homebrew tap.\n\n**Solution**: Create a .goreleaser.yaml configuration file that builds for all target platforms, sets version via ldflags, creates GitHub releases, and auto-updates the Homebrew formula in leeovery/homebrew-tools.\n\n**Outcome**: GoReleaser configuration produces cross-platform binaries, GitHub releases, and auto-updated Homebrew formula on tag push.\n\n**Do**:\n- Create .goreleaser.yaml at project root\n- Configure builds: GOOS=darwin/linux, GOARCH=arm64/amd64\n- Set ldflags: -s -w -X main.version={{.Version}}\n- Configure archives: binary name \"portal\", tar.gz for Linux, zip for macOS\n- Configure changelog: auto-generated from git commits\n- Configure brews section: tap repository leeovery/homebrew-tools, formula name \"portal\"\n- Add tmux as a Homebrew dependency in the formula template\n- Add homepage, description, and license fields\n- Configure release section: GitHub release with auto-generated notes\n- Test locally with goreleaser check (validates config syntax)\n\n**Acceptance Criteria**:\n- [ ] .goreleaser.yaml exists at project root\n- [ ] Builds configured for darwin/arm64, darwin/amd64, linux/arm64, linux/amd64\n- [ ] ldflags inject version into main.version\n- [ ] Homebrew tap configured for leeovery/homebrew-tools\n- [ ] tmux declared as Homebrew dependency\n- [ ] goreleaser check passes (config validation)\n- [ ] Binary name is \"portal\"\n\n**Tests**:\n- goreleaser check validates config without errors\n- build targets include all four platform/arch combinations\n- ldflags include version injection\n- Homebrew tap points to correct repository\n- tmux listed as dependency in brew config\n\n**Edge Cases**: None -- this is a static configuration file.\n\n**Context**:\n\u003e Per spec: \"GoReleaser handles cross-platform builds and distribution.\" Target platforms: macOS (arm64, amd64) and Linux (arm64, amd64). \"Distributed via Homebrew tap: brew tap leeovery/tools; brew install portal.\" \"The Homebrew formula declares tmux as a dependency, ensuring it's installed automatically.\"\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Distribution (Target Platforms, Installation Method, Build \u0026 Release) section.","parent":"tick-a6b7c9","created":"2026-02-22T23:30:08Z","updated":"2026-02-24T08:59:11Z","closed":"2026-02-24T08:59:11Z"}
{"id":"tick-c4d5e6","title":"GitHub Actions Release Workflow","status":"done","priority":2,"description":"**Problem**: There is no CI/CD pipeline to automate building and releasing Portal. The spec defines a release process triggered by version tag push that runs GoReleaser via GitHub Actions.\n\n**Solution**: Create a GitHub Actions workflow file that triggers on version tag push (v*), checks out the code, sets up Go, and runs GoReleaser. GoReleaser creates the GitHub release with binaries and updates the Homebrew formula. The workflow needs write permissions for contents (to create releases) and a personal access token for cross-repo Homebrew tap updates.\n\n**Outcome**: Pushing a version tag (e.g., v1.0.0) triggers automated build, GitHub release creation, and Homebrew formula update.\n\n**Do**:\n- Create .github/workflows/release.yml\n- Trigger: on push tags matching v* pattern (e.g., v1.0.0, v0.1.0)\n- Steps: checkout with fetch-depth 0 (GoReleaser needs full history), setup Go, run GoReleaser\n- Use goreleaser/goreleaser-action@v6 (or latest)\n- Set GITHUB_TOKEN env var on the GoReleaser step for release creation\n- Set HOMEBREW_TAP_GITHUB_TOKEN env var on the GoReleaser step (sourced from repo secret HOMEBREW_TAP_TOKEN) for cross-repo Homebrew tap push (GoReleaser reads this env var to authenticate when pushing the formula update)\n- Permissions: contents: write (for GitHub releases)\n- GoReleaser args: release --clean\n- Ensure the workflow does NOT trigger on tags without v prefix (tags like 1.0.0 are ignored)\n\n**Acceptance Criteria**:\n- [ ] .github/workflows/release.yml exists\n- [ ] Triggers on push of v* tags only\n- [ ] Checks out code with full git history\n- [ ] Sets up Go toolchain\n- [ ] Runs GoReleaser with release --clean\n- [ ] GITHUB_TOKEN provided for release creation\n- [ ] HOMEBREW_TAP_GITHUB_TOKEN set from HOMEBREW_TAP_TOKEN secret for Homebrew tap updates\n- [ ] Does not trigger on non-v tags or branch pushes\n- [ ] Workflow permissions set correctly\n\n**Tests**:\n- workflow file is valid YAML\n- trigger matches v* tag pattern\n- trigger does not match tags without v prefix\n- GoReleaser action version is current\n- GITHUB_TOKEN and HOMEBREW_TAP_GITHUB_TOKEN referenced\n- checkout uses fetch-depth 0\n- Go version matches go.mod\n\n**Edge Cases**:\n- Tag without v prefix (e.g., 1.0.0): should NOT trigger the workflow; the on.push.tags pattern v* handles this\n- Workflow permissions: contents: write is required for GoReleaser to create GitHub releases; if missing, the release step fails with 403\n\n**Context**:\n\u003e Per spec: \"GitHub Actions workflow triggers GoReleaser on version tag push.\" The release process is: 1. Generate version tag, 2. Push tag, 3. GitHub Actions triggers GoReleaser, 4. GoReleaser builds binaries and creates release, 5. GoReleaser auto-updates Homebrew formula. The Homebrew tap is in a separate repository (leeovery/homebrew-tools), requiring a personal access token with repo scope for cross-repo push. GoReleaser uses the env var HOMEBREW_TAP_GITHUB_TOKEN for authentication.\n\n**Spec Reference**: .workflows/specification/portal/specification.md -- Distribution (Build \u0026 Release) section.","parent":"tick-a6b7c9","created":"2026-02-22T23:30:09Z","updated":"2026-02-24T09:53:02Z","closed":"2026-02-24T09:53:02Z"}
{"id":"tick-98bd31","title":"Phase 7: Analysis (Cycle 1)","status":"done","priority":2,"parent":"tick-77cbba","created":"2026-02-26T09:14:36Z","updated":"2026-02-26T09:45:15Z","closed":"2026-02-26T09:45:15Z"}
{"id":"tick-feb4e0","title":"Wire all dependencies into openTUI and adopt functional options for tui.Model","status":"done","priority":2,"description":"**Problem**: The `openTUI` function in `cmd/open.go:284-318` creates the TUI model via `tui.NewWithKiller(client, client)`, which only sets sessionLister and sessionKiller. The TUI model supports session renaming (R key), project picker ([n] new in project...), and file browser navigation -- but none of these work in the real binary because sessionRenamer, projectStore, sessionCreator, and dirLister are nil. The spec defines these as core TUI features. Additionally, tui.Model has 5 telescoping constructors (New, NewWithKiller, NewWithRenamer, NewWithDeps, NewWithAllDeps) that grow combinatorially with each new dependency.\n\n**Solution**: (1) Replace the 5 constructors with a single `New(lister SessionLister, opts ...Option)` constructor using the functional options pattern (e.g., `WithKiller(k)`, `WithRenamer(r)`, `WithProjectStore(s)`, `WithSessionCreator(c)`, `WithDirLister(d, startPath)`). (2) Update `openTUI` to pass all required dependencies: renamer (tmux client), project store (loaded from projects.json), session creator (session.NewSessionCreator), dir lister, and start path (cwd).\n\n**Outcome**: The production binary's TUI supports all specified features: session rename, project picker, new session creation, and file browser navigation. The tui.Model API is extensible without constructor proliferation.\n\n**Do**:\n1. In `internal/tui/model.go`, define an `Option` type (`type Option func(*Model)`) and create `WithKiller`, `WithRenamer`, `WithProjectStore`, `WithSessionCreator`, `WithDirLister` option functions.\n2. Replace all 5 constructors with a single `New(lister SessionLister, opts ...Option)` that applies options.\n3. Keep `NewModelWithSessions` for test use (it serves a different purpose).\n4. Update all callers of the old constructors across tests and production code to use the new `New` + options pattern.\n5. In `cmd/open.go` `openTUI`, construct the model with all dependencies:\n   - `tui.WithKiller(client)` (already wired)\n   - `tui.WithRenamer(client)` (tmux client implements RenameSession)\n   - `tui.WithProjectStore(store)` where store is loaded from projects.json (use `projectsFilePath()` or equivalent)\n   - `tui.WithSessionCreator(session.NewSessionCreator(gitResolver, store, client, gen))` with proper dependencies\n   - `tui.WithDirLister(...)` with cwd as start path\n6. Verify the TUI correctly creates sessions, renames, and browses files.\n\n**Acceptance Criteria**:\n- The production binary's TUI can create new sessions from the project picker\n- The production binary's TUI can rename sessions via R key\n- The production binary's TUI can navigate the file browser\n- tui.Model has a single public constructor `New` plus functional options\n- All existing tests pass\n\n**Tests**:\n- Existing TUI tests updated to use new constructor pattern\n- Integration test or manual verification that `portal open` TUI can create a new session from a project","parent":"tick-98bd31","created":"2026-02-26T09:15:03Z","updated":"2026-02-26T09:28:57Z","closed":"2026-02-26T09:28:57Z"}
{"id":"tick-7943e4","title":"Extract shared session-creation pipeline from SessionCreator and QuickStart","status":"done","priority":2,"description":"**Problem**: `SessionCreator.CreateFromDir` (`internal/session/create.go:73-101`) and `QuickStart.Run` (`internal/session/quickstart.go:51-83`) implement the same 5-step pipeline independently: (1) resolve git root, (2) derive project name from filepath.Base, (3) generate session name, (4) upsert project in store, (5) build shell command. The only divergence is the final action -- CreateFromDir calls tmux.NewSession while Run builds exec args. Both structs hold identical dependency fields. This is ~30 lines of duplicated orchestration logic that can drift independently.\n\n**Solution**: Extract the shared pipeline (steps 1-5) into a single internal function or method that returns an intermediate result struct containing resolvedDir, projectName, sessionName, and shellCmd. Both SessionCreator and QuickStart consume this result and only perform their respective final step.\n\n**Outcome**: A single source of truth for the session preparation pipeline. Changes to git root resolution, name generation, or project upsert logic are made in one place.\n\n**Do**:\n1. Define a `preparedSession` struct in `internal/session/` with fields: `ResolvedDir`, `ProjectName`, `SessionName`, `ShellCmd`.\n2. Extract a `prepareSession(path string, command []string)` method (or standalone function) that takes the shared dependencies (git, store, checker, gen, shell) and returns `*preparedSession`.\n3. Refactor `SessionCreator.CreateFromDir` to call `prepareSession` then pass the result to `tmux.NewSession`.\n4. Refactor `QuickStart.Run` to call `prepareSession` then build exec args from the result.\n5. Consider whether SessionCreator and QuickStart can share a common embedded struct for their dependencies, or whether the function accepts explicit parameters.\n\n**Acceptance Criteria**:\n- The git-root-resolution, name-generation, project-upsert, and shell-command-building logic exists in exactly one place\n- SessionCreator.CreateFromDir and QuickStart.Run both delegate to the shared pipeline\n- All existing tests pass without behavioral changes\n\n**Tests**:\n- Existing tests for SessionCreator and QuickStart continue to pass\n- Unit test for the extracted prepareSession function covering git resolution, name generation, project upsert, and shell command building","parent":"tick-98bd31","created":"2026-02-26T09:15:15Z","updated":"2026-02-26T09:33:35Z","closed":"2026-02-26T09:33:35Z"}
{"id":"tick-4aedcc","title":"Fix GoReleaser config to use brews instead of homebrew_casks","status":"cancelled","priority":2,"description":"**Problem**: `.goreleaser.yaml:34-44` uses `homebrew_casks` as the top-level key for Homebrew distribution. Portal is a CLI binary, not a macOS .app -- `homebrew_casks` generates Homebrew Cask definitions for GUI applications. GoReleaser v2 uses `brews` for CLI tool formulae. This means the release pipeline will not produce a valid Homebrew formula in the `leeovery/homebrew-tools` tap, breaking `brew install portal`.\n\n**Solution**: Replace `homebrew_casks` with `brews` in `.goreleaser.yaml` and adjust the inner structure to match the GoReleaser v2 `brews` schema.\n\n**Outcome**: `goreleaser release` generates a proper Homebrew formula that installs Portal as a CLI binary via `brew tap leeovery/tools \u0026\u0026 brew install portal`.\n\n**Do**:\n1. In `.goreleaser.yaml`, change `homebrew_casks:` to `brews:`.\n2. Adjust the inner structure to match GoReleaser v2 brews schema. The `repository`, `name`, `homepage`, `description`, `license` fields stay the same. Change `dependencies` from `- formula: tmux` to `- name: tmux` (GoReleaser v2 brews dependency format).\n3. Verify the config is valid by running `goreleaser check` if available.\n\n**Acceptance Criteria**:\n- `.goreleaser.yaml` uses `brews` key, not `homebrew_casks`\n- Dependencies use the correct `name:` format for brews\n- `goreleaser check` passes (if available)\n\n**Tests**:\n- Run `goreleaser check` to validate config syntax","parent":"tick-98bd31","created":"2026-02-26T09:15:24Z","updated":"2026-02-26T09:34:42Z","closed":"2026-02-26T09:34:42Z"}
{"id":"tick-ae743d","title":"Extract fuzzyMatch into shared internal package","status":"done","priority":2,"description":"**Problem**: The `fuzzyMatch` function (subsequence matching) is independently implemented with identical logic in `internal/tui/model.go:550-558` and `internal/ui/projectpicker.go:135-143`. A near-identical pattern also exists in `internal/ui/browser.go` for directory filtering. If fuzzy match behavior is refined (e.g., case folding, scoring), multiple files must be updated independently.\n\n**Solution**: Extract `fuzzyMatch` into a shared package (`internal/fuzzy/match.go` or similar) and import it from all locations.\n\n**Outcome**: A single fuzzyMatch implementation used by the session list, project picker, and file browser.\n\n**Do**:\n1. Create `internal/fuzzy/match.go` with an exported `Match(text, pattern string) bool` function containing the existing subsequence logic.\n2. Add tests in `internal/fuzzy/match_test.go` covering the existing test cases from both packages.\n3. Replace `fuzzyMatch` in `internal/tui/model.go` with `fuzzy.Match`.\n4. Replace `fuzzyMatch` in `internal/ui/projectpicker.go` with `fuzzy.Match`.\n5. Update `internal/ui/browser.go` to use `fuzzy.Match` if it has inline matching logic.\n\n**Acceptance Criteria**:\n- No `fuzzyMatch` function definitions remain in `internal/tui/` or `internal/ui/`\n- All fuzzy matching imports from `internal/fuzzy`\n- All existing tests pass\n\n**Tests**:\n- Unit tests in `internal/fuzzy/match_test.go` for empty input, exact match, subsequence match, no match, case sensitivity","parent":"tick-98bd31","created":"2026-02-26T09:15:31Z","updated":"2026-02-26T09:38:30Z","closed":"2026-02-26T09:38:30Z"}
{"id":"tick-218aad","title":"Extract config file path helper to eliminate duplication","status":"done","priority":2,"description":"**Problem**: `aliasFilePath()` in `cmd/alias.go:103-114` and `projectsFilePath()` in `cmd/clean.go:52-63` have identical structure: check an env var override, fall back to `os.UserConfigDir()` + `filepath.Join(\"portal\", filename)`. A third site in `cmd/open.go:247-251` also duplicates the `UserConfigDir + filepath.Join(\"portal\", ...)` pattern inline. Three independent implementations of the same path resolution logic.\n\n**Solution**: Extract a `configFilePath(envVar, filename string) (string, error)` helper that encapsulates the env-var-override + UserConfigDir fallback. All three call sites use this single function.\n\n**Outcome**: Config path resolution logic exists in one place. Adding new config files (or changing the base path) requires a single edit.\n\n**Do**:\n1. Create a helper function `configFilePath(envVar, filename string) (string, error)` in the `cmd` package (e.g., in a new `cmd/config.go` or existing shared file).\n2. The function checks `os.Getenv(envVar)`, returns it if non-empty, otherwise calls `os.UserConfigDir()` and returns `filepath.Join(configDir, \"portal\", filename)`.\n3. Rewrite `aliasFilePath()` to call `configFilePath(\"PORTAL_ALIASES_FILE\", \"aliases\")`.\n4. Rewrite `projectsFilePath()` to call `configFilePath(\"PORTAL_PROJECTS_FILE\", \"projects.json\")`.\n5. Update the inline path in `cmd/open.go:247-251` to use `configFilePath` (or reuse `projectsFilePath`).\n\n**Acceptance Criteria**:\n- A single `configFilePath` helper exists\n- `aliasFilePath` and `projectsFilePath` delegate to it\n- The inline path resolution in `cmd/open.go` is replaced\n- All existing tests pass\n\n**Tests**:\n- Unit test for `configFilePath` with env var set, env var unset","parent":"tick-98bd31","created":"2026-02-26T09:15:44Z","updated":"2026-02-26T09:42:26Z","closed":"2026-02-26T09:42:26Z"}
{"id":"tick-4a035c","title":"Pass parsedCommand as parameter instead of package-level variable","status":"done","priority":2,"description":"**Problem**: `parsedCommand` is declared as a package-level `var` in `cmd/open.go:77`. It is set during `openCmd.RunE` and consumed by `openPath` and `openTUI`. This is shared mutable state that creates hidden coupling -- callers of `openPath` and `openTUI` must know to set the global first. It prevents test isolation and parallel test execution.\n\n**Solution**: Pass the command slice explicitly through function parameters. Remove the package-level variable.\n\n**Outcome**: No package-level mutable state for command passing. Functions are self-contained with explicit parameters.\n\n**Do**:\n1. Change `openPath(resolvedPath string)` to `openPath(resolvedPath string, command []string)`.\n2. Change `openTUI(initialFilter string)` to `openTUI(initialFilter string, command []string)`.\n3. Update the call sites in `openCmd.RunE` to pass `command` directly from `parseCommandArgs` return value.\n4. Remove the `var parsedCommand []string` package-level declaration.\n5. Update any test code that references `parsedCommand`.\n\n**Acceptance Criteria**:\n- No `parsedCommand` package-level variable exists\n- `openPath` and `openTUI` accept command as a parameter\n- All existing tests pass\n\n**Tests**:\n- Existing open command tests continue to pass\n- Verify no package-level `parsedCommand` remains via grep","parent":"tick-98bd31","created":"2026-02-26T09:15:52Z","updated":"2026-02-26T09:45:04Z","closed":"2026-02-26T09:45:04Z"}
{"id":"tick-3a2937","title":"Phase 8: Analysis (Cycle 2)","status":"done","priority":2,"parent":"tick-77cbba","created":"2026-02-26T09:50:27Z","updated":"2026-02-26T10:00:40Z","closed":"2026-02-26T10:00:40Z"}
{"id":"tick-312e8c","title":"Extract generic FuzzyFilter function","status":"done","priority":2,"description":"**Problem**: Three locations implement identical fuzzy filter-and-collect logic: `internal/tui/model.go:542-553` (sessions), `internal/ui/projectpicker.go:121-133` (projects), and `internal/ui/browser.go:125-137` (directory entries). The model.go version has a copy-paste drift bug: `strings.ToLower(m.filterText)` is called inside the loop on every iteration instead of being hoisted outside.\n\n**Solution**: Add a generic `Filter` function to `internal/fuzzy/match.go`: `func Filter[T any](items []T, filter string, nameOf func(T) string) []T`. It returns all items if filter is empty, otherwise collects items where `fuzzy.Match` succeeds on lowercased name vs lowercased filter. Replace all three callsites.\n\n**Outcome**: Single implementation of the fuzzy filter pattern. The ToLower-per-iteration bug in model.go is fixed. Future filter sites use the same helper.\n\n**Do**:\n1. In `internal/fuzzy/match.go`, add:\n   ```go\n   func Filter[T any](items []T, filter string, nameOf func(T) string) []T {\n       if filter == \"\" {\n           return items\n       }\n       lowerFilter := strings.ToLower(filter)\n       var result []T\n       for _, item := range items {\n           if Match(strings.ToLower(nameOf(item)), lowerFilter) {\n               result = append(result, item)\n           }\n       }\n       return result\n   }\n   ```\n2. Add `\"strings\"` import to `internal/fuzzy/match.go`.\n3. In `internal/tui/model.go`, replace `filterMatchedSessions()` body with:\n   ```go\n   return fuzzy.Filter(m.sessions, m.filterText, func(s tmux.Session) string { return s.Name })\n   ```\n4. In `internal/ui/projectpicker.go`, replace `filteredProjects()` body with:\n   ```go\n   return fuzzy.Filter(m.projects, m.filterText, func(p project.Project) string { return p.Name })\n   ```\n5. In `internal/ui/browser.go`, replace `filteredEntries()` body with:\n   ```go\n   return fuzzy.Filter(m.entries, m.filterText, func(e browser.DirEntry) string { return e.Name })\n   ```\n6. Remove now-unused `strings` imports from the three callsite files if no other usage remains.\n\n**Acceptance Criteria**:\n- `fuzzy.Filter` exists and is generic over any type with a name accessor\n- All three previous filter callsites use `fuzzy.Filter`\n- No direct fuzzy.Match + ToLower loop remains in tui/model.go, ui/projectpicker.go, or ui/browser.go\n- The ToLower-per-iteration bug in model.go is gone\n\n**Tests**:\n- Unit tests for `fuzzy.Filter` in `internal/fuzzy/match_test.go`: empty filter returns all items, non-matching filter returns empty, partial match filters correctly, case-insensitive matching works\n- Existing tests in tui and ui packages continue to pass","parent":"tick-3a2937","created":"2026-02-26T09:50:47Z","updated":"2026-02-26T09:55:17Z","closed":"2026-02-26T09:55:17Z"}
{"id":"tick-7f0e35","title":"Deduplicate ProjectStore interface","status":"done","priority":2,"description":"**Problem**: `internal/tui/model.go:32-36` and `internal/ui/projectpicker.go:14-18` define identical `ProjectStore` interfaces with the same three methods (`List`, `CleanStale`, `Remove`). The tui package already imports from ui (it aliases `DirLister = ui.DirLister` at line 54), establishing precedent for cross-package type reuse.\n\n**Solution**: Remove the `ProjectStore` definition from `internal/tui/model.go` and add a type alias `type ProjectStore = ui.ProjectStore`, following the existing `DirLister` pattern.\n\n**Outcome**: Single source of truth for the ProjectStore interface in `internal/ui/projectpicker.go`. The tui package reuses it via alias.\n\n**Do**:\n1. In `internal/tui/model.go`, replace the `ProjectStore` interface definition (lines 32-36) with:\n   ```go\n   type ProjectStore = ui.ProjectStore\n   ```\n2. Verify the tui package already imports `\"github.com/leeovery/portal/internal/ui\"` (it does, for DirLister).\n3. Run `go build ./...` to confirm no compilation errors.\n\n**Acceptance Criteria**:\n- `internal/tui/model.go` no longer defines its own ProjectStore interface\n- `internal/tui/model.go` uses `ui.ProjectStore` via type alias\n- All existing tests pass without modification\n\n**Tests**:\n- All existing tests in `internal/tui/` and `internal/ui/` pass unchanged (the alias is structurally identical)","parent":"tick-3a2937","created":"2026-02-26T09:50:55Z","updated":"2026-02-26T09:57:35Z","closed":"2026-02-26T09:57:35Z"}
{"id":"tick-200812","title":"Remove redundant quickStartResult mirror type","status":"done","priority":2,"description":"**Problem**: `cmd/open.go:162-166` defines a local `quickStartResult` struct that is a field-for-field copy of `session.QuickStartResult` (lines 10-17 of `internal/session/quickstart.go`). A `quickStartAdapter` (lines 187-202) exists solely to convert between them. The cmd package already imports `internal/session`, and `session.QuickStartResult` is a plain data struct with no behavior -- there is no encapsulation benefit to the mirror type.\n\n**Solution**: Change the `quickStarter` interface to return `*session.QuickStartResult` directly. Remove the local `quickStartResult` struct and the `quickStartAdapter` type. Have `PathOpener` use `*session.QuickStartResult`. Create a simple `quickStartAdapter` that just delegates without field copying.\n\n**Outcome**: One fewer redundant type. No field-by-field copy adapter. The `quickStarter` interface and `PathOpener` use `session.QuickStartResult` directly.\n\n**Do**:\n1. In `cmd/open.go`, change the `quickStarter` interface:\n   ```go\n   type quickStarter interface {\n       Run(path string, command []string) (*session.QuickStartResult, error)\n   }\n   ```\n2. Remove the `quickStartResult` struct definition (lines 162-166).\n3. Replace the `quickStartAdapter` with a simpler version that delegates directly:\n   ```go\n   type quickStartAdapter struct {\n       qs *session.QuickStart\n   }\n\n   func (a *quickStartAdapter) Run(path string, command []string) (*session.QuickStartResult, error) {\n       return a.qs.Run(path, command)\n   }\n   ```\n4. In `PathOpener.Open`, the `result` from `po.qs.Run(...)` is now `*session.QuickStartResult` -- no changes needed since the field names are the same (`ExecArgs`).\n5. Update any test mocks in `cmd/open_test.go` that return `*quickStartResult` to return `*session.QuickStartResult` instead.\n\n**Acceptance Criteria**:\n- No `quickStartResult` struct exists in `cmd/open.go`\n- The `quickStarter` interface returns `*session.QuickStartResult`\n- The `quickStartAdapter` delegates without field-by-field copying\n- `PathOpener.Open` works unchanged\n\n**Tests**:\n- All existing tests in `cmd/` pass (mock returns updated to `*session.QuickStartResult`)","parent":"tick-3a2937","created":"2026-02-26T09:51:08Z","updated":"2026-02-26T10:00:31Z","closed":"2026-02-26T10:00:31Z"}
{"id":"tick-0ed051","title":"Phase 9: Analysis (Cycle 3)","status":"done","priority":2,"parent":"tick-77cbba","created":"2026-02-26T10:08:24Z","updated":"2026-02-26T10:13:08Z","closed":"2026-02-26T10:13:08Z"}
{"id":"tick-1bd4ee","title":"Apply initial filter to session list on query resolution fallback","status":"done","priority":2,"description":"**Problem**: When query resolution falls back to the TUI (spec step 4: \"Fall back to the TUI with the query pre-filled as the filter text\"), the session list does not activate filter mode. `WithInitialFilter` stores the filter string in `m.initialFilter` but never sets `m.filterMode = true` or `m.filterText`. The user sees the full unfiltered session list instead of it being pre-filtered by their query. For example, `x myapp` where \"myapp\" has no alias/zoxide match should open the session picker with \"myapp\" already typed into the filter.\n\n**Solution**: In the `SessionsMsg` handler in `internal/tui/model.go`, after setting `m.loaded = true`, check if `m.initialFilter` is non-empty. If so, activate filter mode by setting `m.filterMode = true` and `m.filterText = m.initialFilter`, then apply the fuzzy filter to the session list. Clear `m.initialFilter` after consuming it so it only applies on the first load.\n\n**Outcome**: When query resolution falls back to the session list TUI with a filter string, the session list opens with filter mode active and the query pre-filled, matching the spec's query resolution step 4.\n\n**Do**:\n1. In `internal/tui/model.go`, locate the `SessionsMsg` handler (around line 320-331).\n2. After the `m.loaded = true` line, add a block that checks `m.initialFilter \\!= \"\"`.\n3. When the initial filter is present: set `m.filterMode = true`, set `m.filterText = m.initialFilter`, apply fuzzy filtering to `m.sessions` using the same logic as the existing filter mode, and clear `m.initialFilter = \"\"\" to prevent re-application.\n4. In `internal/tui/model_test.go`, update or add tests to verify:\n   - When `WithInitialFilter(\"myapp\")` is set (without command pending) and `SessionsMsg` arrives, the model enters filter mode with `filterText` set to \"myapp\".\n   - The session list is filtered by the initial filter text.\n   - The filter is only applied on the first `SessionsMsg` (subsequent session refreshes do not re-apply it).\n\n**Acceptance Criteria**:\n- `WithInitialFilter(\"query\")` on a non-command-pending model causes the session list to open in filter mode with \"query\" pre-filled after sessions load.\n- The filtered session list shows only sessions matching the fuzzy filter.\n- The `[n] new in project...` option remains visible.\n- The initial filter is consumed on first load and not re-applied on subsequent session refreshes.\n- Existing behavior preserved: `WithInitialFilter` with command pending still forwards to project picker.\n\n**Tests**:\n- Test that `SessionsMsg` with a non-empty `initialFilter` activates filter mode and pre-fills filter text.\n- Test that sessions are fuzzy-filtered by the initial filter value.\n- Test that a second `SessionsMsg` does not re-apply the consumed initial filter.\n- Test that command-pending mode with initial filter still forwards to project picker (existing behavior unchanged).","parent":"tick-0ed051","created":"2026-02-26T10:08:44Z","updated":"2026-02-26T10:13:00Z","closed":"2026-02-26T10:13:00Z"}
{"id":"tick-c85ba3","title":"Phase 10: Analysis (Cycle 4)","status":"done","priority":2,"parent":"tick-77cbba","created":"2026-02-26T10:29:23Z","updated":"2026-02-26T10:38:46Z","closed":"2026-02-26T10:38:46Z"}
{"id":"tick-eef443","title":"Align GoReleaser config and release workflow with tick reference pattern","status":"done","priority":2,"description":"**Problem**: The `.goreleaser.yaml` contains a `homebrew_casks` section which is semantically wrong (portal is a CLI binary, not a macOS GUI .app bundle) and diverges from the tick reference project that shares the same `leeovery/homebrew-tools` tap. The archives use `format_overrides` with zip for darwin instead of the simpler `formats: [tar.gz]`. The `files: [none*]` exclusion is missing. The changelog is set to `sort: asc` instead of `disable: true`. The release workflow passes `HOMEBREW_TAP_GITHUB_TOKEN` and relies on GoReleaser's Homebrew integration instead of the correct pattern: extract checksums from GoReleaser output and dispatch to the homebrew-tools repo via GitHub API.\n\n**Solution**: Rewrite `.goreleaser.yaml` and `.github/workflows/release.yml` to match the tick reference pattern exactly (adapted for portal).\n\n**Outcome**: Portal's release pipeline matches the established pattern used by tick. GoReleaser produces tar.gz archives only. Homebrew formula updates are triggered via repository dispatch to `leeovery/homebrew-tools` with checksums, using the `CICD_PAT` secret.\n\n**Do**:\n\n1. Replace `.goreleaser.yaml` with:\n   ```yaml\n   version: 2\n\n   project_name: portal\n\n   builds:\n     - id: portal\n       main: .\n       binary: portal\n       env:\n         - CGO_ENABLED=0\n       goos:\n         - darwin\n         - linux\n       goarch:\n         - amd64\n         - arm64\n       ldflags:\n         - -s -w -X github.com/leeovery/portal/cmd.version={{.Version}}\n\n   archives:\n     - id: portal\n       formats:\n         - tar.gz\n       name_template: \"portal_{{ .Version }}_{{ .Os }}_{{ .Arch }}\"\n       files:\n         - none*\n\n   changelog:\n     disable: true\n\n   release:\n     draft: false\n   ```\n\n2. Replace `.github/workflows/release.yml` with:\n   ```yaml\n   name: Release\n\n   on:\n     push:\n       tags:\n         - 'v[0-9]*.[0-9]*.[0-9]*'\n         - '\\!v*-*'\n\n   permissions:\n     contents: write\n\n   jobs:\n     release:\n       runs-on: ubuntu-latest\n       steps:\n         - name: Checkout\n           uses: actions/checkout@v4\n           with:\n             fetch-depth: '0'\n\n         - name: Setup Go\n           uses: actions/setup-go@v5\n           with:\n             go-version-file: go.mod\n\n         - name: Run GoReleaser\n           uses: goreleaser/goreleaser-action@v6\n           with:\n             args: release --clean\n           env:\n             GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n\n         - name: Extract checksums\n           id: checksums\n           run: |\n             VERSION=\"${GITHUB_REF_NAME#v}\"\n             CHECKSUMS_FILE=\"dist/portal_${VERSION}_checksums.txt\"\n             SHA256_ARM64=$(grep \"portal_${VERSION}_darwin_arm64.tar.gz\" \"$CHECKSUMS_FILE\" | awk '{print $1}')\n             SHA256_AMD64=$(grep \"portal_${VERSION}_darwin_amd64.tar.gz\" \"$CHECKSUMS_FILE\" | awk '{print $1}')\n             echo \"version=$VERSION\" \u003e\u003e \"$GITHUB_OUTPUT\"\n             echo \"sha256_arm64=$SHA256_ARM64\" \u003e\u003e \"$GITHUB_OUTPUT\"\n             echo \"sha256_amd64=$SHA256_AMD64\" \u003e\u003e \"$GITHUB_OUTPUT\"\n\n         - name: Dispatch to homebrew-tools\n           run: |\n             curl -fsSL -X POST \\\n               -H \"Accept: application/vnd.github.v3+json\" \\\n               -H \"Authorization: token ${{ secrets.CICD_PAT }}\" \\\n               https://api.github.com/repos/leeovery/homebrew-tools/dispatches \\\n               -d '{\n                 \"event_type\": \"update-formula\",\n                 \"client_payload\": {\n                   \"tool\": \"portal\",\n                   \"version\": \"${{ steps.checksums.outputs.version }}\",\n                   \"sha256_arm64\": \"${{ steps.checksums.outputs.sha256_arm64 }}\",\n                   \"sha256_amd64\": \"${{ steps.checksums.outputs.sha256_amd64 }}\"\n                 }\n               }'\n   ```\n\n3. Verify no other files reference `HOMEBREW_TAP_TOKEN` or `homebrew_casks` -- if found, remove those references.\n\n**Acceptance Criteria**:\n- `.goreleaser.yaml` has no `homebrew_casks` section\n- `.goreleaser.yaml` archives use `formats: [tar.gz]` with no `format_overrides`\n- `.goreleaser.yaml` archives include `files: [none*]`\n- `.goreleaser.yaml` has `changelog: disable: true`\n- `.goreleaser.yaml` has `release: draft: false` (no explicit github owner/name)\n- `.github/workflows/release.yml` has no `HOMEBREW_TAP_GITHUB_TOKEN` env var\n- `.github/workflows/release.yml` extracts checksums from `dist/portal_*_checksums.txt`\n- `.github/workflows/release.yml` dispatches to `leeovery/homebrew-tools` with tool, version, sha256_arm64, sha256_amd64\n- `.github/workflows/release.yml` uses `CICD_PAT` secret for the dispatch step\n- `.github/workflows/release.yml` tag pattern is `v[0-9]*.[0-9]*.[0-9]*` with `\\!v*-*` exclusion\n- `goreleaser check` passes (run locally or verify YAML is valid)\n\n**Tests**:\n- Run `goreleaser check` against the new `.goreleaser.yaml` to validate syntax\n- Confirm no references to `HOMEBREW_TAP_TOKEN` or `homebrew_casks` remain in the repo","parent":"tick-c85ba3","created":"2026-02-26T10:29:54Z","updated":"2026-02-26T10:38:38Z","closed":"2026-02-26T10:38:38Z"}
{"id":"tick-dd35bb","title":"TUI Session Picker","status":"open","priority":2,"created":"2026-02-28T08:54:21Z","updated":"2026-02-28T08:54:21Z"}
{"id":"tick-f20382","title":"Phase 1: Sessions Page with bubbles/list","status":"done","priority":2,"parent":"tick-dd35bb","created":"2026-02-28T08:54:26Z","updated":"2026-02-28T12:56:07Z","closed":"2026-02-28T12:56:07Z"}
{"id":"tick-5d021f","title":"Session List Item and Custom ItemDelegate","status":"done","priority":2,"description":"**Problem**: The current session list renders items via hand-rolled strings.Builder code in viewSessionList() within internal/tui/model.go. To adopt bubbles/list, each session must implement the list.Item interface and a custom ItemDelegate must handle rendering with the same visual information: session name, window count (with correct singular/plural), and attached badge.\n\n**Solution**: Create a SessionItem type that wraps tmux.Session and implements list.Item (providing FilterValue() returning the session name). Create a SessionDelegate struct implementing list.ItemDelegate with Render, Height, Spacing, and Update methods. The delegate renders each item as: {name}  {N window(s)}  { attached} using lipgloss styles. The delegate's Update method returns nil (no item-level keybinding handling needed; session actions are handled at the page level).\n\n**Outcome**: A SessionItem type and SessionDelegate type exist in internal/tui/, are fully tested, and can be passed to list.New() to render a session list with correct formatting.\n\n**Do**:\n- Create internal/tui/session_item.go containing:\n  - type SessionItem struct wrapping tmux.Session\n  - func (i SessionItem) FilterValue() string returning i.Session.Name\n  - func (i SessionItem) Title() string returning the session name (useful for display)\n  - func (i SessionItem) Description() string returning the window count + attached badge string\n- Create type SessionDelegate struct{} implementing list.ItemDelegate:\n  - Height() int returns 1 (single-line items, matching current behavior)\n  - Spacing() int returns 0\n  - Update(msg tea.Msg, m *list.Model) tea.Cmd returns nil\n  - Render(w io.Writer, m list.Model, index int, item list.Item) casts item to SessionItem, formats: cursor indicator, bold name, dimmed window count with correct pluralization (\"1 window\" vs \"N windows\"), green \" attached\" badge if attached. Use lipgloss styles similar to existing cursorStyle, nameStyle, detailStyle, attachedStyle from model.go. Highlight the selected item by checking index == m.Index().\n- Create internal/tui/session_item_test.go with tests\n- Helper: func toListItems(sessions []tmux.Session) []list.Item converts a slice of sessions to list items\n\n**Acceptance Criteria**:\n- [ ] SessionItem implements list.Item interface (compiler check)\n- [ ] FilterValue() returns the session name\n- [ ] SessionDelegate implements list.ItemDelegate interface (compiler check)\n- [ ] Render output contains session name, window count, and attached badge when attached\n- [ ] Window count uses \"1 window\" (singular) and \"N windows\" (plural) correctly\n- [ ] Long session names render without truncation\n- [ ] Non-attached sessions do not show the attached badge\n- [ ] toListItems correctly converts []tmux.Session to []list.Item\n\n**Tests**:\n- \"SessionItem FilterValue returns session name\"\n- \"SessionDelegate renders session name and window count\"\n- \"SessionDelegate renders singular window for count of 1\"\n- \"SessionDelegate renders plural windows for count \u003e 1\"\n- \"SessionDelegate renders attached badge for attached session\"\n- \"SessionDelegate does not render attached badge for detached session\"\n- \"SessionDelegate highlights selected item\"\n- \"long session name renders without truncation\"\n- \"toListItems converts tmux sessions to list items\"\n\n**Edge Cases**:\n- Singular window pluralization: session with Windows: 1 must render \"1 window\" not \"1 windows\"\n- Long session names: names like \"my-very-long-project-name-that-should-not-be-truncated-x7k2m9\" must render fully\n- Attached vs detached display: only attached sessions show the \" attached\" badge\n\n**Context**:\nThe spec says: \"Sessions show the session name, window count, and attached badge\" via a custom ItemDelegate. The existing tmux.Session struct has fields Name string, Windows int, Attached bool. The existing lipgloss styles (cursorStyle, nameStyle, detailStyle, attachedStyle) in model.go provide the visual reference for the delegate. The list.ItemDelegate interface requires Render(w io.Writer, m Model, index int, item Item), Height() int, Spacing() int, and Update(msg tea.Msg, m *Model) tea.Cmd.\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-f20382","created":"2026-02-28T08:54:50Z","updated":"2026-02-28T10:54:10Z","closed":"2026-02-28T10:54:10Z"}
{"id":"tick-c64e34","title":"Sessions Page with bubbles/list Core","status":"done","priority":2,"description":"**Problem**: The current TUI model in internal/tui/model.go uses a hand-rolled session list with manual cursor tracking, keyboard navigation, and strings.Builder rendering. This needs to be replaced with a bubbles/list.Model that provides built-in cursor management, pagination, help, and status bar, while maintaining all existing behavior: session fetching via SessionsMsg, inside-tmux current session exclusion, and enter-to-attach.\n\n**Solution**: Refactor the Model in internal/tui/model.go to hold a list.Model for the sessions page. On SessionsMsg, convert sessions to []list.Item using toListItems() from Task 1 (excluding the current session when inside tmux), then call list.SetItems(). The list title is \"Sessions\" (or \"Sessions (current: {name})\" when inside tmux). Enter on a selected item sets m.selected to that session's name and quits. q quits. The View() method for the session list state returns the list's View() output. Remove manual cursor tracking (cursor int), manual keyboard nav (j/k/up/down), and strings.Builder rendering for the session list view.\n\n**Outcome**: The sessions page renders using bubbles/list, with automatic cursor management, pagination for long lists, and correct attach behavior on enter. Inside-tmux mode excludes the current session and sets the list title accordingly.\n\n**Do**:\n- In internal/tui/model.go:\n  - Add sessionList list.Model field to Model\n  - In New(), initialize the list: list.New(nil, SessionDelegate{}, 0, 0). Set title to \"Sessions\". Disable the default quit keybinding (m.sessionList.KeyMap.Quit.SetEnabled(false)). Set m.sessionList.SetShowStatusBar(false) initially.\n  - Remove cursor int, loaded bool fields (list manages cursor; loaded is replaced by checking if items are set)\n  - In Init(), keep the existing SessionsMsg fetch command\n  - In updateSessionList handling of SessionsMsg: convert msg.Sessions to []list.Item via toListItems(), filter out current session if inside tmux, call m.sessionList.SetItems(items). If error, tea.Quit (existing behavior). Set the title to \"Sessions (current: {name})\" when inside tmux.\n  - For enter key: get m.sessionList.SelectedItem(), cast to SessionItem, set m.selected = item.Session.Name, return tea.Quit\n  - Handle tea.WindowSizeMsg to call m.sessionList.SetSize(msg.Width, msg.Height)\n  - In viewSessionList(): return m.sessionList.View()\n  - Wire custom keybindings for the sessions page via the list's AdditionalShortHelpKeys / AdditionalFullHelpKeys\n- Update internal/tui/model_test.go tests that reference the old rendering\n- Keep NewModelWithSessions working for tests by populating the list with items\n\n**Acceptance Criteria**:\n- [ ] Sessions page renders using bubbles/list.Model.View()\n- [ ] SessionsMsg populates the list via SetItems()\n- [ ] Inside-tmux mode excludes current session from items and sets title to \"Sessions (current: {name})\"\n- [ ] Enter on a session sets Selected() and quits\n- [ ] q and Ctrl+C quit the TUI\n- [ ] SessionsMsg with error triggers quit\n- [ ] tea.WindowSizeMsg updates list dimensions\n- [ ] Empty session list shows the list's built-in empty state\n- [ ] Help bar shows session-specific keybindings\n\n**Tests**:\n- \"SessionsMsg populates list items\"\n- \"SessionsMsg with error triggers quit\"\n- \"enter selects session and quits\"\n- \"q key triggers quit\"\n- \"Ctrl+C triggers quit\"\n- \"inside tmux excludes current session from list\"\n- \"inside tmux sets title with current session name\"\n- \"empty session list shows empty state\"\n- \"WindowSizeMsg updates list dimensions\"\n- \"inside tmux with only current session shows empty list\"\n\n**Edge Cases**:\n- Empty session list: list shows built-in empty message\n- SessionsMsg error triggers tea.Quit (existing behavior preserved)\n- Inside-tmux with only the current session: after filtering, list is empty, shows empty state\n\n**Context**:\nThe spec says: \"The current session is excluded from the items list  filtered out before calling SetItems()\" and \"The current session is displayed in the list title: Sessions (current: {session-name})\". The list.New() constructor takes (items []Item, delegate ItemDelegate, width, height int). Use list.SetItems() for dynamic updates. Custom help keys are added via list.AdditionalShortHelpKeys and list.AdditionalFullHelpKeys function fields on the list model.\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-f20382","created":"2026-02-28T08:55:44Z","updated":"2026-02-28T11:20:55Z","closed":"2026-02-28T11:20:55Z"}
{"id":"tick-b29c05","title":"Modal Overlay System and Kill Confirmation","status":"done","priority":2,"description":"**Problem**: The current kill confirmation is inline text appended to the session list view. The spec requires a modal overlay system where the list stays visible but inactive behind a styled modal positioned with lipgloss.Place(). This modal system will be reused for rename (Task 4) and future project modals (Phase 2).\n\n**Solution**: Create a reusable modal overlay system and implement the kill confirmation modal as the first consumer. The modal system consists of: (1) a modalState type tracking which modal is active (none, kill-confirm, etc.), (2) a renderModal(content string, listView string, width, height int) string function that uses lipgloss.Place() to center the modal content over the list output, (3) input routing that sends all keys to the modal handler when a modal is active. The kill confirmation modal shows \"Kill {name}? (y/n)\" in a bordered box. On y: kill via tmux, fetch fresh sessions, call SetItems(). On n or Esc: dismiss modal.\n\n**Outcome**: A modal overlay pattern exists that can render styled content over the list view. Kill confirmation works as a modal: k opens it, y confirms and refreshes, n/Esc dismisses. The pattern is easily extensible for rename and other modals.\n\n**Do**:\n- In internal/tui/modal.go:\n  - Define type modalState int with constants: modalNone, modalKillConfirm (additional modal states added by subsequent tasks as needed)\n  - Create func renderModal(content string, listView string, width, height int) string that uses lipgloss.Place(width, height, lipgloss.Center, lipgloss.Center, styledModal) where styledModal is the content wrapped in a lipgloss border style\n  - Create modal content styling (bordered box with padding)\n- In internal/tui/model.go:\n  - Replace confirmKill bool and pendingKillName string with modal modalState and pendingKillName string\n  - Change keybinding: k (lowercase, not K as currently) opens kill confirmation modal when a session is selected\n  - When modal == modalKillConfirm, route all tea.KeyMsg to a kill-confirm handler\n  - Kill confirm handler: y -\u003e kill session, fetch fresh list, dismiss modal; n/Esc -\u003e dismiss modal\n  - Existing killAndRefresh function is reused\n  - In View(): when modal is active, call renderModal() to overlay modal content on top of the list view\n- In internal/tui/modal_test.go: test renderModal output contains both the modal content and is a valid string\n- In internal/tui/model_test.go: update/add kill confirmation tests\n\n**Acceptance Criteria**:\n- [ ] k (lowercase) on a selected session opens the kill confirmation modal\n- [ ] Modal displays \"Kill {name}? (y/n)\" in a styled overlay\n- [ ] y confirms kill, refreshes session list, and dismisses modal\n- [ ] n dismisses the modal without killing\n- [ ] Esc dismisses the modal without killing\n- [ ] All other keys are ignored while modal is active\n- [ ] After killing the last session, the list shows empty state\n- [ ] k on an empty list is a no-op (no selected item)\n- [ ] Kill error triggers a session list refresh (via SessionsMsg error path)\n- [ ] renderModal overlays content over the list view string\n\n**Tests**:\n- \"k opens kill confirmation modal for selected session\"\n- \"y in kill modal kills session and refreshes list\"\n- \"n in kill modal dismisses without killing\"\n- \"Esc in kill modal dismisses without killing\"\n- \"other keys ignored during kill modal\"\n- \"kill last remaining session shows empty state\"\n- \"k on empty list is no-op\"\n- \"kill error triggers refresh via SessionsMsg\"\n- \"renderModal produces overlay string containing modal content\"\n\n**Edge Cases**:\n- Kill last remaining session: after kill + refresh, list receives empty SessionsMsg, list shows empty state automatically\n- Kill error: killAndRefresh returns SessionsMsg{Err: ...} which triggers quit (existing behavior)\n\n**Context**:\nThe spec says: \"All action prompts use a single reusable modal overlay pattern. Bubble Tea does not have built-in modals  lipgloss.Place() positions styled content over the list output in View().\" And: \"Action triggers modal -\u003e list stays visible but inactive behind it. All key input routes to the modal while it is active. Esc always dismisses the modal and returns to the list.\" Note the spec uses lowercase k for kill (help bar: [k] kill), while the current code uses uppercase K. The new code must use lowercase k.\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-f20382","created":"2026-02-28T08:56:26Z","updated":"2026-02-28T11:34:18Z","closed":"2026-02-28T11:34:18Z"}
{"id":"tick-34ba3d","title":"Rename Modal with TextInput","status":"done","priority":2,"description":"**Problem**: The current rename mode is an inline textinput appended below the session list. The spec requires rename to use the modal overlay system (from Task 3) with a bubbles/textinput pre-populated with the current session name.\n\n**Solution**: Implement rename as a modal overlay using the modal system from Task 3. When r (lowercase) is pressed with a session selected, set modal = modalRename, create a textinput.Model pre-populated with the selected session's name and focused. The modal renders the textinput inside the styled overlay. Enter confirms (if non-empty), Esc cancels. On confirm, rename via tmux and refresh the session list.\n\n**Outcome**: Rename works as a modal overlay: r opens it with the name pre-filled, enter confirms the rename, Esc dismisses. Empty input is rejected (no-op on enter). Same-name rename is allowed (tmux handles it as a no-op).\n\n**Do**:\n- In internal/tui/model.go:\n  - Keep renameInput textinput.Model and renameTarget string fields\n  - Change keybinding: r (lowercase, not R as currently) opens rename modal when a session is selected\n  - When r pressed: set modal = modalRename, create textinput.New(), set prompt to \"New name: \", pre-populate with item.Session.Name, focus it\n  - When modal == modalRename, route all messages to rename handler\n  - Rename handler: Enter -\u003e trim input, reject empty, call renameAndRefresh(oldName, newName), dismiss modal; Esc -\u003e dismiss modal; other messages -\u003e delegate to textinput.Update()\n  - Existing renameAndRefresh function is reused\n  - In View(): when modal == modalRename, render renderModal(renameInput.View(), listView, width, height)\n- Update internal/tui/model_test.go: rename tests\n\n**Acceptance Criteria**:\n- [ ] r (lowercase) on a selected session opens the rename modal\n- [ ] Rename modal shows a textinput pre-populated with the current session name\n- [ ] Enter with non-empty input renames the session and refreshes\n- [ ] Enter with empty input is a no-op (modal stays open)\n- [ ] Esc dismisses the rename modal without renaming\n- [ ] After rename, the session list refreshes showing the new name\n- [ ] r on an empty list is a no-op\n- [ ] r with no session renamer configured is a no-op\n\n**Tests**:\n- \"r opens rename modal with pre-populated session name\"\n- \"enter in rename modal renames session and refreshes\"\n- \"empty rename input is rejected on enter\"\n- \"Esc dismisses rename modal without renaming\"\n- \"rename to same name is allowed\"\n- \"rename error triggers refresh\"\n- \"r on empty list is no-op\"\n- \"r without renamer configured is no-op\"\n\n**Edge Cases**:\n- Empty rename input: pressing enter with empty/whitespace-only input does nothing (modal stays open)\n- Rename to same name: allowed  tmux handles this gracefully, no special-casing needed\n- Rename error: renameAndRefresh returns SessionsMsg{Err: ...} which triggers quit (existing behavior)\n\n**Context**:\nThe spec says: \"r triggers a modal overlay with a textinput pre-populated with the current session name. On confirm: rename session via tmux, refresh list.\" The current code uses uppercase R; the new code must use lowercase r per the spec help bar: [r] rename. The textinput.Model from bubbles/textinput is already used in the codebase.\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-f20382","created":"2026-02-28T08:57:16Z","updated":"2026-02-28T11:42:46Z","closed":"2026-02-28T11:42:46Z"}
{"id":"tick-01c27d","title":"N-Key New Session in CWD","status":"done","priority":2,"description":"**Problem**: The current n key jumps the cursor to a \"[n] new in project...\" option at the bottom of the session list. The spec changes n to immediately create a new session in the current working directory and attach  no confirmation, no cursor movement. This is equivalent to portal open . / x .\n\n**Solution**: When n is pressed on the sessions page, immediately call m.sessionCreator.CreateFromDir(cwd, nil) where cwd is the current working directory (passed into the TUI at construction). On success (SessionCreatedMsg), set m.selected and quit. On error, handle gracefully. Remove the old \"[n] new in project...\" option and its divider from the session list view.\n\n**Outcome**: Pressing n creates a session in cwd immediately and exits the TUI. No \"[n] new in project...\" option in the list.\n\n**Do**:\n- In internal/tui/model.go:\n  - Add a cwd string field to Model (the current working directory)\n  - Add a WithCWD(path string) Option to set cwd on the model\n  - Handle n key in the sessions page update: if sessionCreator is not nil, return m.createSessionInCWD() command\n  - func (m Model) createSessionInCWD() tea.Cmd calls m.sessionCreator.CreateFromDir(m.cwd, nil), returns SessionCreatedMsg or sessionCreateErrMsg\n  - Remove the \"[n] new in project...\" option from the view: remove the divider rendering, the \"new in project\" line, and the totalItems() method that counted sessions+1\n  - Remove the n-key-jumps-to-new-option behavior\n  - SessionCreatedMsg and sessionCreateErrMsg handling already exists in Update()\n- Update cmd/open.go openTUI to pass cwd to the model (it already gets cwd via os.Getwd())\n- Update tests in internal/tui/model_test.go\n\n**Acceptance Criteria**:\n- [ ] n key creates a session in the current working directory immediately\n- [ ] Session creation uses CreateFromDir(cwd, nil) -- command forwarding is added in Phase 3 task 3-5\n- [ ] On success, Selected() returns the new session name and TUI quits\n- [ ] On error (sessionCreateErrMsg), TUI handles gracefully (no crash)\n- [ ] n with no session creator configured is a no-op\n- [ ] The \"[n] new in project...\" option and divider are removed from the session list\n\n**Tests**:\n- \"n creates session in cwd and quits\"\n- \"n with no session creator is no-op\"\n- \"session creation error is handled gracefully\"\n- \"session list no longer shows new in project option\"\n\n**Edge Cases**:\n- Session creation error: sessionCreateErrMsg is emitted; existing handler returns to session list view\n- No session creator configured: n key is a no-op (guard on m.sessionCreator == nil)\n\n**Context**:\nThe spec says: \"n immediately creates a session in the current working directory and attaches. No confirmation, no cursor movement  equivalent to portal open . / x .\" And: \"Works from both pages (cwd does not change based on page). No spinner  session creation is near-instant.\" The cmd/open.go openTUI function already gets cwd via os.Getwd() and passes it to WithDirLister. The cwd needs to also be stored on the model directly for the n key handler. Command forwarding through n-key is handled later in Phase 3 task 3-5.\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-f20382","created":"2026-02-28T08:57:41Z","updated":"2026-02-28T11:51:30Z","closed":"2026-02-28T11:51:30Z"}
{"id":"tick-b00429","title":"Built-in Filtering and Initial Filter","status":"done","priority":2,"description":"**Problem**: The current filtering implementation is hand-rolled: a filterMode boolean, filterText string, manual filterMatchedSessions() using internal/fuzzy, and custom keyboard handling in updateFilter(). The spec requires using bubbles/list's built-in filtering which provides all of this out of the box. Additionally, the --filter CLI flag needs to pre-apply a filter using the bubbles/list API.\n\n**Solution**: Remove the hand-rolled filter code (filterMode, filterText, filterMatchedSessions, updateFilter). bubbles/list already handles / to activate filtering, Esc to cancel, and fuzzy matching via its built-in FilterFunc. For the initial filter (--filter flag), call m.sessionList.SetFilterText(filter) followed by m.sessionList.SetFilterState(list.FilterApplied) on the sessions list during initialization (after items are loaded). The SessionItem.FilterValue() from Task 1 returns the session name, which is what the built-in filter matches against.\n\n**Outcome**: Filtering is fully handled by bubbles/list. The / key activates filtering, Esc cancels it, and fuzzy matching works on session names. The --filter flag pre-applies a filter on launch.\n\n**Do**:\n- In internal/tui/model.go:\n  - Remove filterMode bool, filterText string fields\n  - Remove updateFilter() method\n  - Remove filterMatchedSessions() method\n  - Remove displaySessions() method\n  - Remove the case msg.Type == tea.KeyRunes \u0026\u0026 string(msg.Runes) == \"/\" handler (list handles / natively)\n  - In the SessionsMsg handler, after calling SetItems(), if m.initialFilter \\!= \"\", call m.sessionList.SetFilterText(m.initialFilter) then m.sessionList.SetFilterState(list.FilterApplied), then clear m.initialFilter\n  - The list's default keybinding for / activates filter mode automatically\n- Remove internal/fuzzy usage from the TUI model (may still be used by browser)\n- Update WithInitialFilter to just store the string (remove project picker filter forwarding for now)\n- Update tests in internal/tui/model_test.go\n\n**Acceptance Criteria**:\n- [ ] / activates the built-in filter mode\n- [ ] Filtering fuzzy-matches on session names (via FilterValue())\n- [ ] Esc while filtering clears the filter (built-in behavior)\n- [ ] --filter flag pre-applies filter text on launch after items load\n- [ ] Hand-rolled filter code is removed (filterMode, filterText, updateFilter, filterMatchedSessions, displaySessions)\n- [ ] Initial filter with no matches shows the list's built-in \"no matches\" state\n- [ ] Empty initial filter string is a no-op (no filter applied)\n\n**Tests**:\n- \"initial filter pre-applies filter text after items load\"\n- \"initial filter with no matches shows empty filtered state\"\n- \"empty initial filter is no-op\"\n- \"list handles filter activation via slash key\"\n- \"Esc clears active filter\"\n\n**Edge Cases**:\n- Initial filter with no matches: the list shows its built-in \"no matches\" message\n- Empty initial filter: when initialFilter == \"\", skip the SetFilterText call entirely  no-op\n\n**Context**:\nThe spec says: \"Apply SetFilterText() and SetFilterState(list.FilterApplied) on whichever page is the default (sessions if they exist, otherwise projects). Same behavior as the current implementation, using bubbles/list API.\" And: \"Independent filters per page. Each bubbles/list manages its own filter state.\" The bubbles/list SetFilterText method sets filter text. The / key is the default filter activation key in the list's KeyMap.Filter binding.\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-f20382","created":"2026-02-28T08:58:13Z","updated":"2026-02-28T12:03:10Z","closed":"2026-02-28T12:03:10Z"}
{"id":"tick-fe1e6f","title":"Page-Switching Skeleton and Help Bar","status":"done","priority":2,"description":"**Problem**: The current TUI uses a viewState enum (viewSessionList, viewProjectPicker, viewFileBrowser) with the project picker as a separate sub-model. The spec requires a two-page architecture where Sessions and Projects are equal peers, switchable via p (go to projects), s (go to sessions), and x (toggle). Phase 1 needs to establish the page-switching skeleton so Phase 2 can plug in the Projects page.\n\n**Solution**: Replace the viewState enum with a page type (pageSessions, pageProjects). Add a stub projects page (a list.Model with placeholder text or empty list) that Phase 2 will replace. Implement p to switch to projects page, s to switch to sessions page, and x to toggle. The help bar on the sessions page shows p for projects; the projects stub shows s for sessions. Each page's help bar is configured via the list's AdditionalShortHelpKeys.\n\n**Outcome**: Page switching works between sessions and a stub projects page. p, s, and x keys navigate correctly. The skeleton is ready for Phase 2 to replace the stub with a real projects page.\n\n**Do**:\n- In internal/tui/model.go:\n  - Replace viewState with type page int and constants pageSessions, pageProjects (keep pageFileBrowser for browser sub-view)\n  - Replace view viewState field with activePage page\n  - Add projectList list.Model field (stub for now  initialized with empty items and a placeholder delegate)\n  - Handle p key on sessions page: switch to pageProjects\n  - Handle s key on projects page: switch to pageSessions\n  - Handle x key on either page: toggle between pageSessions and pageProjects\n  - View() dispatches to m.sessionList.View() or m.projectList.View() based on activePage\n  - Update() dispatches to the active page's update logic\n  - Configure sessions list help keys to include p for \"projects\"\n  - Configure projects stub help keys to include s for \"sessions\"\n  - Set projects list empty text to \"No saved projects\"\n  - Set sessions list empty text to \"No sessions running\"\n- Update tests for page switching\n\n**Acceptance Criteria**:\n- [ ] p on sessions page switches to projects page\n- [ ] s on projects page switches to sessions page\n- [ ] x toggles between pages from either page\n- [ ] Switching pages preserves list state (cursor position, filter state) on the source page\n- [ ] Sessions page help bar includes [p] projects\n- [ ] Projects stub page help bar includes [s] sessions\n- [ ] Empty sessions page shows \"No sessions running\"\n- [ ] Empty projects stub shows \"No saved projects\"\n\n**Tests**:\n- \"p on sessions page switches to projects page\"\n- \"s on projects page switches to sessions page\"\n- \"x toggles from sessions to projects\"\n- \"x toggles from projects to sessions\"\n- \"switching to projects and back preserves session list state\"\n- \"switching to empty stub projects page shows empty message\"\n\n**Edge Cases**:\n- Switching to empty stub page: should display the list's built-in empty message\n- Switching back preserves list state: session list cursor and filter state should not reset on page switch\n\n**Context**:\nThe spec says: \"p  go to Projects page (shown in Sessions help bar), s  go to Sessions page (shown in Projects help bar), x  toggle between pages (undocumented power-user shortcut). All keybindings are lowercase.\" And: \"Empty pages are always reachable via p/s  navigation is consistent regardless of state. Empty pages display the bubbles/list built-in empty message ('No sessions running' / 'No saved projects').\" The x key is undocumented  it does not appear in help bars. Custom help keys use list.AdditionalShortHelpKeys which is a func() []key.Binding field.\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-f20382","created":"2026-02-28T08:58:38Z","updated":"2026-02-28T12:25:40Z","closed":"2026-02-28T12:25:40Z"}
{"id":"tick-f7693a","title":"Esc Progressive Back Behavior","status":"done","priority":2,"description":"**Problem**: The current Esc handling is inconsistent: Esc on the session list quits, Esc in filter mode clears the filter, Esc in confirm/rename mode dismisses the modal. The spec requires a unified progressive \"back\" behavior where Esc unwinds one layer of context at a time: modal -\u003e filter -\u003e page -\u003e quit.\n\n**Solution**: Implement a centralized Esc handler that checks layers in priority order: (1) if a modal is active, dismiss it; (2) if a filter is active, let bubbles/list handle it (it clears the filter on Esc); (3) if the file browser is active, return to projects page; (4) if on sessions or projects page with nothing active, exit the TUI. This requires intercepting Esc before passing it to the list when a modal is active, and letting the list consume it when filtering. After the list consumes Esc for filter clearing, a subsequent Esc reaches our handler and triggers quit.\n\n**Outcome**: Esc progressively unwinds context: dismiss modal first, then clear filter, then quit. Each press of Esc moves exactly one layer back.\n\n**Do**:\n- In internal/tui/model.go:\n  - In the sessions page update handler, intercept tea.KeyEsc:\n    1. If modal \\!= modalNone -\u003e dismiss modal, return (already handled by Task 3/4 modal handlers)\n    2. If list is filtering (m.sessionList.FilterState() == list.Filtering) -\u003e pass Esc to list (it clears filter)\n    3. If list has applied filter (m.sessionList.FilterState() == list.FilterApplied) -\u003e pass Esc to list (it clears the applied filter via ClearFilter keybinding)\n    4. Otherwise -\u003e tea.Quit\n  - bubbles/list binds Esc to CancelWhileFiltering when in Filtering state, and ClearFilter is bound to Esc when in FilterApplied state. So the list handles Esc for filter states automatically. Our handler only needs to intercept Esc when a modal is active (before passing to list) and when no filter is active (to quit).\n  - Remove the old case msg.Type == tea.KeyEsc -\u003e tea.Quit from the default session list handler\n  - Ensure modal handlers catch Esc before the list sees it\n  - For the projects page (stub): same progressive behavior applies\n- Update tests\n\n**Acceptance Criteria**:\n- [ ] Esc during kill modal dismisses the modal (does not quit)\n- [ ] Esc during rename modal dismisses the modal (does not quit)\n- [ ] Esc during active filtering clears the filter (does not quit)\n- [ ] Esc with applied filter clears the filter (does not quit)\n- [ ] Esc with no modal, no filter, on a page -\u003e quits TUI\n- [ ] Multiple Esc presses unwind layers in order: modal -\u003e filter -\u003e quit\n- [ ] Ctrl+C always force-quits regardless of state\n\n**Tests**:\n- \"Esc during kill modal dismisses modal\"\n- \"Esc during rename modal dismisses modal\"\n- \"Esc with filter active clears filter\"\n- \"Esc with no modal or filter quits TUI\"\n- \"Ctrl+C force-quits from any state\"\n- \"Esc during rename then Esc again quits TUI\"\n- \"Esc clears filter then second Esc quits\"\n\n**Edge Cases**:\n- Esc during rename modal vs kill modal: both should dismiss their respective modal without side effects\n- Esc with filter active but no modal: list consumes Esc to clear filter; next Esc quits\n\n**Context**:\nThe spec says: \"Esc acts as a progressive 'back' key, unwinding one layer of context at a time: 1. Modal active -\u003e dismiss modal, return to list. 2. Filter active -\u003e clear filter (bubbles/list handles this). 3. File browser active -\u003e return to Projects page. 4. Sessions or Projects page (nothing active) -\u003e exit TUI.\" The bubbles/list KeyMap has CancelWhileFiltering (Esc when in Filtering state) and ClearFilter (Esc when in FilterApplied state). When unfiltered, the list does not consume Esc.\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-f20382","created":"2026-02-28T08:59:04Z","updated":"2026-02-28T12:50:01Z","closed":"2026-02-28T12:50:01Z"}
{"id":"tick-f08098","title":"Remove Old Hand-Rolled Session Code","status":"done","priority":2,"description":"**Problem**: After Tasks 1-8, the old hand-rolled session list code is dead: manual cursor tracking, strings.Builder rendering, inline filter logic, the \"[n] new in project...\" option, the old viewState enum, and potentially unused helpers. Dead code should be removed to keep the codebase clean and avoid confusion.\n\n**Solution**: Audit internal/tui/model.go and internal/tui/model_test.go for any remaining dead code from the old implementation. Remove it. Also remove any test helpers or mock types that only existed for the old implementation. Ensure all existing tests either pass against the new implementation or have been replaced by equivalent tests in earlier tasks.\n\n**Outcome**: The internal/tui/ package contains only the new bubbles/list-based implementation with no remnants of the old hand-rolled approach. All tests pass.\n\n**Do**:\n- In internal/tui/model.go, remove:\n  - filteredSessions() method (if not already removed in Task 6)\n  - totalItems() method (if not already removed in Task 5)\n  - displaySessions() method (if not already removed in Task 6)\n  - handleSessionListEnter() if replaced by new enter logic in Task 2\n  - Old lipgloss style variables (cursorStyle, nameStyle, detailStyle, attachedStyle, dividerStyle) if they've been moved to the delegate in Task 1\n  - NewModelWithSessions() constructor if no longer needed (or update it to work with the new list-based model for test convenience)\n  - Any unused fields from Model struct\n- In internal/tui/model_test.go:\n  - Remove cursorLine() helper if no longer needed\n  - Remove or update test cases that reference the old rendering format\n  - Ensure all tests compile and pass\n- Run go vet ./... and go test ./internal/tui/... to verify no compilation errors or test failures\n- Verify no unused imports remain\n\n**Acceptance Criteria**:\n- [ ] No dead code from the old hand-rolled session list remains in internal/tui/\n- [ ] All tests in internal/tui/ pass\n- [ ] go vet ./internal/tui/... reports no issues\n- [ ] No unused imports in any file under internal/tui/\n- [ ] The NewModelWithSessions test helper either works with the new implementation or has been replaced\n\n**Tests**:\n- \"all existing tests pass after cleanup\"\n- \"go vet reports no issues\"\n- No new tests needed  this task verifies the cleanup doesn't break existing functionality\n\n**Edge Cases**: None  this is a cleanup task.\n\n**Context**:\nThe spec says: \"Hand-rolled strings.Builder rendering is replaced by bubbles/list delegates and lipgloss styling\" and \"Any code, tests, or message types that exist solely to support the old ProjectPickerModel should be removed rather than left as dead code.\" While ProjectPickerModel removal is Phase 2, the same principle applies to old session list code in Phase 1. This task is a final sweep to ensure nothing was missed during the incremental refactoring in Tasks 1-8.\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-f20382","created":"2026-02-28T08:59:26Z","updated":"2026-02-28T12:56:00Z","closed":"2026-02-28T12:56:00Z"}
{"id":"tick-364f1a","title":"Phase 2: Projects Page with bubbles/list","status":"in_progress","priority":2,"parent":"tick-dd35bb","created":"2026-02-28T09:10:37Z","updated":"2026-02-28T12:56:34Z"}
{"id":"tick-df51d2","title":"Project List Item and Custom ItemDelegate","status":"done","priority":2,"description":"**Problem**: The Projects page needs a bubbles/list-based rendering, but there is no list.Item implementation for projects. Phase 1 established the pattern with SessionItem and SessionDelegate. The projects page requires an analogous ProjectItem type (wrapping project.Project) and a ProjectDelegate that renders each project as name + path.\n\n**Solution**: Create a ProjectItem type wrapping project.Project that implements list.Item (providing FilterValue() returning the project name, plus Title() and Description() accessors). Create a ProjectDelegate struct implementing list.ItemDelegate with Render, Height, Spacing, and Update methods. The delegate renders each item as: {name}  {path} using lipgloss styles.\n\n**Outcome**: A ProjectItem type and ProjectDelegate type exist in internal/tui/, are fully tested, and can be passed to list.New() to render a project list.\n\n**Do**:\n- Create internal/tui/project_item.go containing:\n  - type ProjectItem struct wrapping project.Project\n  - func (i ProjectItem) FilterValue() string returning i.Project.Name\n  - func (i ProjectItem) Title() string returning the project name\n  - func (i ProjectItem) Description() string returning the project path\n- Create type ProjectDelegate struct{} implementing list.ItemDelegate:\n  - Height() int returns 2 (name on line 1, path on line 2)\n  - Spacing() int returns 0\n  - Update(msg tea.Msg, m *list.Model) tea.Cmd returns nil\n  - Render(w io.Writer, m list.Model, index int, item list.Item) formats with lipgloss: bold name, dimmed path\n- Create internal/tui/project_item_test.go with tests\n- Helper: func projectsToListItems(projects []project.Project) []list.Item\n\n**Acceptance Criteria**:\n- [ ] ProjectItem implements list.Item interface (compiler check)\n- [ ] FilterValue() returns the project name\n- [ ] ProjectDelegate implements list.ItemDelegate interface (compiler check)\n- [ ] Render output contains project name and path\n- [ ] Long project paths render without truncation\n- [ ] Projects with identical names both render (differentiated by path)\n- [ ] projectsToListItems correctly converts []project.Project to []list.Item\n\n**Tests**:\n- \"ProjectItem FilterValue returns project name\"\n- \"ProjectItem Title returns project name\"\n- \"ProjectItem Description returns project path\"\n- \"ProjectDelegate renders project name and path\"\n- \"ProjectDelegate highlights selected item\"\n- \"long project path renders without truncation\"\n- \"projects with identical names both render with different paths\"\n- \"projectsToListItems converts projects to list items\"\n\n**Edge Cases**:\n- Long project paths render fully without truncation\n- Projects with identical names differentiated by path\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-364f1a","created":"2026-02-28T09:11:17Z","updated":"2026-02-28T13:00:02Z","closed":"2026-02-28T13:00:02Z"}
{"id":"tick-9184b3","title":"Projects Page with bubbles/list Core","status":"done","priority":2,"description":"**Problem**: Phase 1 created a stub projects page. This stub needs to be replaced with a fully functional projects page that loads projects from the ProjectStore, displays them via bubbles/list using the ProjectDelegate, and handles enter to create a new session in the selected project directory.\n\n**Solution**: Replace the stub projectList with a real list.Model initialized with ProjectDelegate. On initialization, load projects from the store via CleanStale() then List(), convert to []list.Item via projectsToListItems(), and call SetItems(). Enter key on a selected project calls m.createSession(project.Path) and on success sets m.selected and quits. n key works on this page too (creates session in cwd).\n\n**Outcome**: The projects page loads and displays all saved projects via bubbles/list, with enter creating a new session in the selected project directory.\n\n**Do**:\n- In internal/tui/model.go:\n  - Define a ProjectsLoadedMsg struct carrying []project.Project and error\n  - Replace the stub projectList initialization with: list.New(nil, ProjectDelegate{}, 0, 0), set title to \"Projects\", set empty text to \"No saved projects\", disable default quit keybinding\n  - Add a loadProjects() tea.Cmd method that calls m.projectStore.CleanStale() then m.projectStore.List() and returns a ProjectsLoadedMsg\n  - In Init(), fire the loadProjects command in addition to session fetching\n  - Handle ProjectsLoadedMsg: convert to list items, call m.projectList.SetItems(items). On error, remain empty.\n  - Create func (m Model) createSession(path string) tea.Cmd that calls m.sessionCreator.CreateFromDir(path, nil) and returns SessionCreatedMsg or sessionCreateErrMsg. Refactor createSessionInCWD to delegate: return m.createSession(m.cwd)\n  - Handle enter on projects page: get m.projectList.SelectedItem(), cast to ProjectItem, call m.createSession(item.Project.Path)\n  - Handle n on projects page: m.createSessionInCWD() (which delegates to createSession)\n  - Handle tea.WindowSizeMsg: update m.projectList.SetSize() as well\n  - Configure projects list AdditionalShortHelpKeys for projects-specific bindings\n  - In View() for pageProjects: return m.projectList.View()\n- Create or update internal/tui/model_test.go with projects page tests\n\n**Acceptance Criteria**:\n- [ ] Projects page renders using bubbles/list.Model.View()\n- [ ] ProjectsLoadedMsg populates the list via SetItems()\n- [ ] createSession(path) method created; createSessionInCWD delegates to it\n- [ ] enter on a project creates a session in the project directory and quits\n- [ ] n on the projects page creates a session in cwd and quits\n- [ ] q and Ctrl+C quit the TUI from projects page\n- [ ] Empty project list shows \"No saved projects\" built-in empty message\n- [ ] Project load error leaves list empty (does not crash)\n- [ ] Session creation error is handled gracefully\n- [ ] Help bar shows projects-specific keybindings\n- [ ] tea.WindowSizeMsg updates projects list dimensions\n\n**Tests**:\n- \"ProjectsLoadedMsg populates project list items\"\n- \"createSession creates session at given path\"\n- \"createSessionInCWD delegates to createSession with cwd\"\n- \"enter on project creates session and quits\"\n- \"n on projects page creates session in cwd\"\n- \"q key quits from projects page\"\n- \"empty project list shows empty message\"\n- \"project load error leaves list empty\"\n- \"session creation error handled gracefully\"\n- \"WindowSizeMsg updates project list dimensions\"\n- \"projects help bar shows correct keybindings\"\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-364f1a","created":"2026-02-28T09:11:41Z","updated":"2026-02-28T13:09:43Z","closed":"2026-02-28T13:09:43Z"}
{"id":"tick-5509f1","title":"Delete Confirmation Modal for Projects","status":"done","priority":2,"description":"**Problem**: The projects page needs a delete action (d key) that removes a saved project after user confirmation. Phase 1 established the modal overlay system. The projects page needs to reuse this same modal system for delete confirmation.\n\n**Solution**: Add a modalDeleteProject constant to the existing modalState enum. When d is pressed on the projects page with a project selected, set modal = modalDeleteProject and store the pending project's path and name. The modal displays \"Delete {name}? (y/n)\". On y: call m.projectStore.Remove(path), reload projects, and call SetItems(). On n/Esc: dismiss modal.\n\n**Outcome**: Pressing d on a project opens a delete confirmation modal. Confirming removes the project and refreshes the list. Dismissing returns to the list.\n\n**Do**:\n- In internal/tui/modal.go: Add modalDeleteProject to the modalState enum\n- In internal/tui/model.go:\n  - Add pendingDeletePath string and pendingDeleteName string fields\n  - Handle d key on projects page: if selected item exists, set modal = modalDeleteProject, store project path and name\n  - When modal == modalDeleteProject, route all tea.KeyMsg to a delete-confirm handler:\n    - y: call m.projectStore.Remove(pendingDeletePath), fire loadProjects() to refresh, dismiss modal\n    - n/Esc: dismiss modal, clear pending state\n    - All other keys: no-op\n  - In View(): when modal == modalDeleteProject, render renderModal(\"Delete {name}? (y/n)\", projectListView, width, height)\n- Add/update tests\n\n**Acceptance Criteria**:\n- [ ] d on a selected project opens the delete confirmation modal\n- [ ] Modal displays \"Delete {name}? (y/n)\" in a styled overlay\n- [ ] y confirms deletion, removes project from store, and refreshes list\n- [ ] n dismisses the modal without deleting\n- [ ] Esc dismisses the modal without deleting\n- [ ] All other keys are ignored while modal is active\n- [ ] After deleting the last project, the list shows the empty state\n- [ ] d on an empty list is a no-op\n- [ ] Delete while filter is active works correctly\n\n**Tests**:\n- \"d opens delete confirmation modal for selected project\"\n- \"y in delete modal removes project and refreshes list\"\n- \"n in delete modal dismisses without deleting\"\n- \"Esc in delete modal dismisses without deleting\"\n- \"other keys ignored during delete modal\"\n- \"delete last remaining project shows empty state\"\n- \"d on empty project list is no-op\"\n- \"delete while filter active removes the correct project\"\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-364f1a","created":"2026-02-28T09:12:01Z","updated":"2026-03-01T10:11:51Z","closed":"2026-03-01T10:11:51Z"}
{"id":"tick-fd7b3f","title":"Project Edit Modal","status":"done","priority":2,"description":"**Problem**: The projects page needs an edit action (e key) that opens a larger modal with the project's name field, alias list, and full edit controls. This is the most complex modal in the TUI  it requires text input for name editing, alias listing with removal, alias addition with collision detection, and save/cancel operations.\n\n**Solution**: Add a modalEditProject constant to the modalState enum. When e is pressed on a project, open the edit modal populated with the project's current name and its aliases. The modal has two fields: a name text input and an alias section. Tab switches focus between fields. In the alias section, existing aliases are listed with x to remove, and an \"Add:\" input at the bottom. Enter saves all changes (name rename via ProjectEditor.Rename, alias removals via AliasEditor.Delete, new alias via AliasEditor.Set), Esc cancels. Empty name is rejected. Alias collisions show an error.\n\n**Outcome**: Pressing e on a project opens an edit modal with name and alias editing. Changes are saved on Enter, cancelled on Esc. Validation prevents empty names and alias collisions.\n\n**Do**:\n- In internal/tui/modal.go: Add modalEditProject to the modalState enum\n- In internal/tui/model.go:\n  - Add ProjectEditor and AliasEditor interfaces (move or re-declare from internal/ui/projectpicker.go):\n    - ProjectEditor: Rename(path, newName string) error\n    - AliasEditor: Load() (map[string]string, error), Set(name, path string), Delete(name string) bool, Save() error\n  - Add projectEditor ProjectEditor and aliasEditor AliasEditor fields to Model\n  - Add WithProjectEditor(e ProjectEditor) Option and WithAliasEditor(a AliasEditor) Option\n  - Add edit-mode state fields: editProject project.Project, editName string, editAliases []string, editRemoved []string, editNewAlias string, editFocus editField, editAliasCursor int, editError string\n  - Define type editField int with editFieldName and editFieldAliases constants\n  - Handle e key on projects page: populate edit state, load aliases, set modal = modalEditProject\n  - When modal == modalEditProject, route all messages to an edit handler:\n    - Tab: toggle editFocus between name and aliases\n    - Esc: dismiss modal, clear edit state\n    - Enter: validate (reject empty name), save changes, dismiss modal, refresh\n    - Rune keys: x on existing alias removes it; otherwise append to active input\n  - Render the edit modal via renderModal() with styled box\n- Add/update tests\n\n**Acceptance Criteria**:\n- [ ] e on a selected project opens the edit modal with current name and aliases\n- [ ] Tab switches focus between name field and alias section\n- [ ] Enter saves name change and alias modifications, then refreshes list\n- [ ] Esc cancels edit without saving changes\n- [ ] Empty name is rejected with error message\n- [ ] Alias collision shows error message\n- [ ] x on an existing alias marks it for removal\n- [ ] New alias text is entered in the \"Add:\" input\n- [ ] e with no editor configured is a no-op\n- [ ] e on empty list is a no-op\n- [ ] Alias removal is committed on save (not immediately)\n\n**Tests**:\n- \"e opens edit modal with project name and aliases\"\n- \"Tab switches focus between name and aliases\"\n- \"Enter saves name change and refreshes list\"\n- \"Esc cancels edit without saving\"\n- \"empty name rejected with error on Enter\"\n- \"alias collision shows error message\"\n- \"x removes alias from list in edit mode\"\n- \"new alias is added on save\"\n- \"alias removal is committed on save\"\n- \"e with no editor configured is no-op\"\n- \"e on empty project list is no-op\"\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-364f1a","created":"2026-02-28T09:12:29Z","updated":"2026-03-01T10:20:08Z","closed":"2026-03-01T10:20:08Z"}
{"id":"tick-f14aa6","title":"File Browser Integration from Projects Page","status":"done","priority":2,"description":"**Problem**: The projects page needs a b key to open the custom file browser (internal/ui/browser.go) as a sub-view. The browser is not a modal -- it replaces the projects page view entirely. When the browser emits BrowserDirSelectedMsg, the TUI creates a session and exits. When the browser emits BrowserCancelMsg, the TUI returns to the projects page.\n\n**Solution**: Handle b on the projects page by creating a FileBrowserModel (using the existing ui.NewFileBrowser()) and switching to pageFileBrowser. Messages from the browser (BrowserDirSelectedMsg, BrowserCancelMsg) are handled in the top-level Update(). Ensure BrowserDirSelectedMsg triggers m.createSession(msg.Path) and BrowserCancelMsg returns to pageProjects.\n\n**Outcome**: b on the projects page opens the file browser. Selecting a directory creates a session and exits. Cancelling returns to the projects page.\n\n**Do**:\n- In internal/tui/model.go:\n  - Handle b key on the projects page update: create m.fileBrowser = ui.NewFileBrowser(m.startPath, m.dirLister), set m.activePage = pageFileBrowser\n  - Ensure existing cross-view message handlers work:\n    - ui.BrowserDirSelectedMsg: calls m.createSession(msg.Path)\n    - ui.BrowserCancelMsg: sets m.activePage = pageProjects (update from the old viewProjectPicker)\n  - In View() for pageFileBrowser: return m.fileBrowser.View()\n  - In Update() for pageFileBrowser: delegate to m.fileBrowser.Update(msg)\n  - Ensure b is included in the projects page AdditionalShortHelpKeys\n- Update tests\n\n**Acceptance Criteria**:\n- [ ] b on projects page opens the file browser sub-view\n- [ ] File browser shows the starting path (cwd) and directory entries\n- [ ] Selecting a directory in the browser creates a session and exits TUI\n- [ ] Cancelling the browser (Esc with no filter) returns to the projects page\n- [ ] Esc in the browser with a filter active clears the filter (browser's own behavior)\n- [ ] b works regardless of filter state on the projects page\n- [ ] The projects page state is preserved when returning from the browser\n\n**Tests**:\n- \"b on projects page opens file browser\"\n- \"BrowserDirSelectedMsg creates session and quits\"\n- \"BrowserCancelMsg returns to projects page\"\n- \"Esc in browser with no filter returns to projects page\"\n- \"Esc in browser with filter clears filter\"\n- \"b works when projects list has active filter\"\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-364f1a","created":"2026-02-28T09:12:55Z","updated":"2026-03-01T10:25:54Z","closed":"2026-03-01T10:25:54Z"}
{"id":"tick-9aebe2","title":"Two-Way Page Navigation and Independent Filters","status":"done","priority":2,"description":"**Problem**: Phase 1 established the page-switching skeleton with a stub projects page. Now that the projects page is fully functional (Phase 2), the independent filter behavior across pages needs to be verified  switching pages must not carry filter text.\n\n**Solution**: Verify that filter state is independent per page  filtering on sessions and switching to projects shows unfiltered projects, and vice versa. Also verify that the projects help bar shows correct project-specific keybindings now that the real page replaces the stub.\n\n**Outcome**: Independent filter state per page confirmed. Projects page help bar shows correct keybindings.\n\n**Do**:\n- In internal/tui/model.go:\n  - Confirm switching pages does NOT reset or transfer filter state (each bubbles/list manages its own filter independently)\n  - Verify projects list AdditionalShortHelpKeys includes [s] sessions and project-specific keys ([e] edit, [d] delete, [b] browse)\n- Add/update tests\n\n**Acceptance Criteria**:\n- [ ] Switching pages preserves filter state on the source page\n- [ ] Switching pages does not carry filter text to the destination page\n- [ ] Projects page help bar shows [s] sessions (verifies real page replaces stub)\n- [ ] Projects page help bar shows correct project-specific keybindings ([e] edit, [d] delete, [b] browse)\n\n**Tests**:\n- \"switching pages does not carry filter text\"\n- \"filter state preserved when switching back to source page\"\n- \"projects help bar includes s for sessions and project-specific keys\"\n- \"sessions help bar still includes p for projects after projects page replacement\"\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-364f1a","created":"2026-02-28T09:13:11Z","updated":"2026-03-01T10:33:19Z","closed":"2026-03-01T10:33:19Z"}
{"id":"tick-de5cb8","title":"Remove Old ProjectPickerModel","status":"done","priority":2,"description":"**Problem**: After Tasks 1-6, the old ProjectPickerModel in internal/ui/projectpicker.go is dead code. All project listing, filtering, editing, and deletion functionality has been reimplemented using bubbles/list within the internal/tui/ package.\n\n**Solution**: Delete internal/ui/projectpicker.go and internal/ui/projectpicker_test.go. Remove any message types, interfaces, or helper functions in internal/ui/ that were only used by ProjectPickerModel. Update imports in internal/tui/model.go. Verify that the file browser (internal/ui/browser.go) still compiles.\n\n**Outcome**: internal/ui/projectpicker.go and internal/ui/projectpicker_test.go are deleted. No dead code from the old project picker remains. All tests pass. The file browser continues to work.\n\n**Do**:\n- Delete internal/ui/projectpicker.go\n- Delete internal/ui/projectpicker_test.go\n- In internal/ui/, audit remaining types. If defined in projectpicker.go and still needed by browser.go or new TUI, keep or move.\n  - Browser messages (BrowserCancelMsg, BrowserDirSelectedMsg) are in browser.go -- keep\n  - ProjectStore, ProjectEditor, AliasEditor interfaces: if re-declared in internal/tui/, remove from internal/ui/\n  - ProjectsLoadedMsg, ProjectSelectedMsg, BrowseSelectedMsg, BackMsg: remove if replaced\n  - editField type and constants: remove\n- In internal/tui/model.go:\n  - Remove projectPicker ui.ProjectPickerModel field if it still exists\n  - Remove ui.ProjectPickerModel-related imports\n  - Remove updateProjectPicker() method if it still exists\n  - Ensure ProjectStore type alias is replaced with direct interface if needed\n  - Ensure DirLister type alias still works (DirLister is in browser.go)\n- Run go vet ./... and go test ./internal/tui/... ./internal/ui/...\n- Verify no unused imports remain\n\n**Acceptance Criteria**:\n- [ ] internal/ui/projectpicker.go is deleted\n- [ ] internal/ui/projectpicker_test.go is deleted\n- [ ] No dead code from the old ProjectPickerModel remains in internal/ui/\n- [ ] All tests in internal/tui/ pass\n- [ ] All tests in internal/ui/ pass (browser tests)\n- [ ] go vet ./... reports no issues\n- [ ] No unused imports in any modified file\n- [ ] File browser (internal/ui/browser.go) still compiles and its tests pass\n- [ ] internal/tui/model.go no longer references ProjectPickerModel or its specific message types\n\n**Tests**:\n- \"all existing tests pass after cleanup\"\n- \"go vet reports no issues\"\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-364f1a","created":"2026-02-28T09:13:30Z","updated":"2026-03-01T10:48:50Z","closed":"2026-03-01T10:48:50Z"}
{"id":"tick-68f174","title":"Phase 3: Command-Pending Mode and Launch Defaults","status":"open","priority":2,"parent":"tick-dd35bb","created":"2026-02-28T09:20:28Z","updated":"2026-02-28T09:20:28Z"}
{"id":"tick-2f0ec0","title":"Default Page Selection on Launch","status":"done","priority":2,"description":"**Problem**: The TUI needs to select the correct default page (Sessions or Projects) on launch based on available data. Sessions page if sessions exist (after inside-tmux filtering), Projects page otherwise.\n\n**Solution**: After both sessions and projects data are fetched, evaluate which page to display: sessions exist (after inside-tmux filtering) -\u003e Sessions; no sessions -\u003e Projects; both empty -\u003e Projects. Track load completion with two booleans.\n\n**Outcome**: The TUI opens on the correct page based on available data, only after both data sources have loaded.\n\n**Do**:\n- Add sessionsLoaded bool and projectsLoaded bool fields to Model\n- Modify Init() to fetch both sessions and projects concurrently (using tea.Batch with session fetch and loadProjects commands)\n- In SessionsMsg handler: set sessionsLoaded = true, populate session list items as before, then call evaluateDefaultPage()\n- In ProjectsLoadedMsg handler: set projectsLoaded = true, populate project list items as before, then call evaluateDefaultPage()\n- func evaluateDefaultPage(): if \\!sessionsLoaded || \\!projectsLoaded, return (wait for both). Otherwise apply default page rules: (1) session list has items (after inside-tmux exclusion) -\u003e pageSessions, (2) no session items -\u003e pageProjects, (3) both empty -\u003e pageProjects\n- evaluateDefaultPage also triggers initial filter application (deferred to task 3-7)\n\n**Acceptance Criteria**:\n- [ ] When sessions exist (post inside-tmux filtering), TUI opens on Sessions page\n- [ ] When no sessions exist but projects exist, TUI opens on Projects page\n- [ ] When both are empty, TUI opens on Projects page\n- [ ] Page switching (p/s/x) still works after default page selection\n- [ ] Inside-tmux filtering applied before the default page decision\n- [ ] Default page evaluated only after both SessionsMsg and ProjectsLoadedMsg received\n\n**Tests**:\n- \"defaults to Sessions page when sessions exist\"\n- \"defaults to Projects page when no sessions exist but projects exist\"\n- \"defaults to Projects page when both pages are empty\"\n- \"defaults to Projects page when all sessions filtered by inside-tmux exclusion\"\n- \"page switching works after defaulting to Sessions page\"\n- \"page switching works after defaulting to Projects page\"\n- \"default page waits for both data sources before evaluating\"\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-68f174","created":"2026-02-28T09:20:41Z","updated":"2026-03-01T10:56:50Z","closed":"2026-03-01T10:56:50Z"}
{"id":"tick-310db8","title":"Command-Pending Mode Core","status":"done","priority":2,"description":"**Problem**: When portal open -e cmd is used, the TUI must enter command-pending mode: locked to Projects page with s and x keybindings disabled.\n\n**Solution**: Add a commandPending flag. When set, lock to Projects page: s, x, e, and d keys are not registered. Implement WithCommand(command []string) that sets commandPending = true, stores command, sets active page to Projects.\n\n**Outcome**: In command-pending mode, the TUI shows only the Projects page. s, x, e, and d keys are inert and absent from the help bar.\n\n**Do**:\n- Add commandPending bool and command []string fields\n- Implement WithCommand(command []string) Option\n- When commandPending true, do not register s, x, e, or d keybindings (only enter, n, b, /, q remain; p is already absent from Projects help bar)\n- Help bar shows: [enter] run here  [n] new in cwd  [b] browse  [/] filter  [q] quit\n\n**Acceptance Criteria**:\n- [ ] WithCommand sets commandPending = true and starts on Projects page\n- [ ] Pressing s in command-pending mode does nothing\n- [ ] Pressing x in command-pending mode does nothing\n- [ ] Pressing e in command-pending mode does nothing\n- [ ] Pressing d in command-pending mode does nothing\n- [ ] Help bar does not show s, x, e, or d keybindings in command-pending mode\n- [ ] Normal mode still has s, x, e, and d keybindings working\n- [ ] enter label shows \"run here\" in command-pending mode\n\n**Tests**:\n- \"WithCommand sets command-pending mode and starts on Projects page\"\n- \"pressing s in command-pending mode does nothing\"\n- \"pressing x in command-pending mode does nothing\"\n- \"pressing e in command-pending mode does nothing\"\n- \"pressing d in command-pending mode does nothing\"\n- \"help bar omits s, x, e, and d in command-pending mode\"\n- \"help bar shows run here for enter in command-pending mode\"\n- \"normal mode retains s, x, e, and d keybindings\"\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-68f174","created":"2026-02-28T09:20:55Z","updated":"2026-03-01T11:02:52Z","closed":"2026-03-01T11:02:52Z"}
{"id":"tick-f8d97a","title":"Command-Pending Status Line and Help Bar","status":"done","priority":2,"description":"**Problem**: In command-pending mode, the user needs visual feedback showing which command will be executed. The spec requires a status line below the title: Select project to run: {command}.\n\n**Solution**: When commandPending true, render a status line between the list title and items showing Select project to run: {command} where command is strings.Join(m.command, \" \"). Title remains \"Projects\".\n\n**Outcome**: Users see a clear indication of the pending command. Full command text displayed without truncation.\n\n**Do**:\n- In View(), when commandPending true, render status line after title\n- Join command slice with spaces: strings.Join(m.command, \" \")\n- Title stays \"Projects\"\n- Long command text renders without truncation\n\n**Acceptance Criteria**:\n- [ ] Status line shows \"Select project to run: {command}\" when command-pending active\n- [ ] Title remains \"Projects\" in command-pending mode\n- [ ] Single-word command renders correctly\n- [ ] Multi-word command renders all args space-separated\n- [ ] Status line absent in normal mode\n- [ ] Long command text not artificially truncated\n\n**Tests**:\n- \"status line shows pending command text\"\n- \"status line absent in normal mode\"\n- \"multi-word command shown space-separated\"\n- \"long command text renders without truncation\"\n- \"title stays Projects in command-pending mode\"\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-68f174","created":"2026-02-28T09:21:50Z","updated":"2026-03-01T11:09:54Z","closed":"2026-03-01T11:09:54Z"}
{"id":"tick-e8fd08","title":"Command-Pending Enter Creates Session with Command","status":"done","priority":2,"description":"**Problem**: When enter is pressed on a project in command-pending mode, the TUI must create a session in that project's directory with the pending command passed through.\n\n**Solution**: Modify createSession(path) to forward m.command instead of nil. This is backward-compatible  m.command is nil in normal mode. Then enter on Projects page calls createSession(project.Path) which now automatically forwards the command.\n\n**Outcome**: Selecting a project in command-pending mode creates a session with the specified command, then exits.\n\n**Do**:\n- Modify createSession(path string) to pass m.command instead of nil: change CreateFromDir(path, nil) to CreateFromDir(path, m.command). This is backward-compatible -- m.command is nil in normal mode, so existing behavior is unchanged.\n- In Projects page enter handler, enter calls createSession(item.Project.Path) which now forwards m.command automatically\n- Handle SessionCreatedMsg: set m.selected = msg.SessionName, return tea.Quit\n- Handle sessionCreateErrMsg: stay on Projects page\n\n**Acceptance Criteria**:\n- [ ] enter on a project in command-pending mode calls CreateFromDir(projectPath, command)\n- [ ] Command slice forwarded exactly as stored\n- [ ] On success, Selected() returns the created session name\n- [ ] On success, TUI quits\n- [ ] On session creation error, TUI does not crash and stays on Projects page\n- [ ] When no command set (normal mode), nil passed as command (backward-compatible)\n\n**Tests**:\n- \"enter on project in command-pending mode creates session with command\"\n- \"command slice forwarded exactly to CreateFromDir\"\n- \"selected returns session name after creation\"\n- \"TUI quits after successful session creation\"\n- \"session creation error keeps TUI on Projects page\"\n- \"normal mode enter on project passes nil command\"\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-68f174","created":"2026-02-28T09:21:50Z","updated":"2026-03-01T11:13:21Z","closed":"2026-03-01T11:13:21Z"}
{"id":"tick-c5bbbb","title":"Command-Pending Browse and N-Key with Command","status":"done","priority":2,"description":"**Problem**: In command-pending mode, b (browse) and n (new in cwd) must also carry the pending command through to session creation.\n\n**Solution**: Ensure browse flow (b -\u003e file browser -\u003e BrowserDirSelectedMsg) and n key flow both pass m.command to CreateFromDir. Browse cancel returns to locked Projects page.\n\n**Outcome**: Browse and n-key actions in command-pending mode create sessions with the pending command.\n\n**Do**:\n- Verify BrowserDirSelectedMsg handling calls createSession(msg.Path) which passes m.command\n- Verify BrowserCancelMsg returns to Projects page (not Sessions) in command-pending mode\n- n key handler calls createSession(m.cwd) which passes m.command\n- n key works from both pages in normal mode and from Projects in command-pending mode\n\n**Acceptance Criteria**:\n- [ ] Browse directory selection in command-pending mode creates session with pending command\n- [ ] Browse cancel in command-pending mode returns to locked Projects page\n- [ ] n key creates session in cwd with pending command in command-pending mode\n- [ ] n key creates session in cwd without command in normal mode\n- [ ] n key works from both Sessions and Projects pages\n- [ ] Command slice forwarded to CreateFromDir for all three paths (enter, browse, n-key)\n\n**Tests**:\n- \"browse directory selection forwards command in command-pending mode\"\n- \"browse cancel returns to locked Projects page in command-pending mode\"\n- \"n-key creates session in cwd with command in command-pending mode\"\n- \"n-key creates session in cwd without command in normal mode\"\n- \"n-key works from Sessions page\"\n- \"n-key works from Projects page\"\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-68f174","created":"2026-02-28T09:21:50Z","updated":"2026-03-01T11:16:15Z","closed":"2026-03-01T11:16:15Z"}
{"id":"tick-5c4639","title":"Command-Pending Esc and Quit Behavior","status":"done","priority":2,"description":"**Problem**: In command-pending mode, Esc and q must exit TUI entirely since there is no Sessions page to go back to. But Esc must respect progressive back/dismiss layering.\n\n**Solution**: Progressive Esc in command-pending mode: (1) modal active -\u003e dismiss, (2) filter active -\u003e clear (bubbles/list handles), (3) file browser -\u003e return to Projects, (4) nothing active -\u003e exit TUI.\n\n**Outcome**: Esc progressively unwinds state layers before exiting. q always exits immediately.\n\n**Do**:\n- When handling bare Esc on Projects page, check commandPending. If true, return tea.Quit instead of switching to Sessions\n- Ensure bubbles/list handles Esc for filter dismissal internally\n- Ensure modal Esc dismisses modal before reaching page-level handler\n- q key quits from any state\n\n**Acceptance Criteria**:\n- [ ] Esc with nothing active in command-pending mode exits TUI\n- [ ] Esc with filter active clears filter first (does not exit)\n- [ ] Second Esc after clearing filter exits TUI\n- [ ] Esc with modal active dismisses modal first\n- [ ] Esc in file browser during command-pending returns to Projects page\n- [ ] q exits from any state in command-pending mode\n- [ ] In normal mode, Esc on Projects page with nothing active exits TUI (same as command-pending)\n\n**Tests**:\n- \"Esc with nothing active in command-pending mode exits TUI\"\n- \"Esc with filter active clears filter first in command-pending mode\"\n- \"two Esc presses: clear filter then exit in command-pending mode\"\n- \"Esc with modal active dismisses modal in command-pending mode\"\n- \"Esc in file browser returns to Projects page in command-pending mode\"\n- \"q exits from any state in command-pending mode\"\n- \"Esc on Projects page in normal mode with nothing active exits TUI\"\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-68f174","created":"2026-02-28T09:21:50Z","updated":"2026-03-01T11:21:12Z","closed":"2026-03-01T11:21:12Z"}
{"id":"tick-bd640d","title":"Initial Filter Applied to Default Page","status":"done","priority":2,"description":"**Problem**: The --filter flag passes an initial filter string to the TUI. This filter must be applied to whichever page is the default using the bubbles/list API.\n\n**Solution**: Move initial filter application from the SessionsMsg handler (added in task 1-6) to evaluateDefaultPage (from task 3-1). After determining the default page, if initialFilter is non-empty, apply it to the default page's bubbles/list.Model using SetFilterText() and SetFilterState(list.FilterApplied). In command-pending mode, always apply to Projects page.\n\n**Outcome**: When launching with --filter myapp, the default page shows filtered results matching \"myapp\".\n\n**Do**:\n- Remove the initial filter application from the SessionsMsg handler (added in task 1-6) -- this logic moves to evaluateDefaultPage\n- In evaluateDefaultPage (from task 3-1), after default page is determined: if initialFilter \\!= \"\", call SetFilterText(initialFilter) and SetFilterState(list.FilterApplied) on the default page's list\n- In command-pending mode, always apply to Projects page's list\n- If initialFilter empty, do nothing (no-op)\n- Consume initial filter after applying (set initialFilter = \"\")\n\n**Acceptance Criteria**:\n- [ ] Initial filter applied to Sessions page when sessions exist\n- [ ] Initial filter applied to Projects page when no sessions\n- [ ] Initial filter applied to Projects page in command-pending mode\n- [ ] Filter text visible in the bubbles/list filter bar\n- [ ] Only matching items shown after filter applied\n- [ ] Empty initial filter is a no-op\n- [ ] Filter consumed after first application (not re-applied on refresh)\n- [ ] Old initial filter code removed from SessionsMsg handler\n\n**Tests**:\n- \"initial filter applied to Sessions page when sessions exist\"\n- \"initial filter applied to Projects page when no sessions exist\"\n- \"initial filter applied to Projects page in command-pending mode\"\n- \"initial filter with no matches shows empty filtered state\"\n- \"empty initial filter is no-op\"\n- \"filter consumed after first application\"\n- \"SessionsMsg handler no longer applies initial filter\"\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-68f174","created":"2026-02-28T09:21:50Z","updated":"2026-03-01T11:29:08Z","closed":"2026-03-01T11:29:08Z"}
{"id":"tick-dc682b","title":"Wire cmd/open.go to New Model API","status":"done","priority":2,"description":"**Problem**: The cmd/open.go file creates the TUI model and configures it with dependencies. The new bubbles/list-based model may have a different API surface. The openTUI function needs updating.\n\n**Solution**: Update openTUI to use the new model API. Ensure all configuration flows: WithCommand, WithInitialFilter, WithInsideTmux, and functional options (WithKiller, WithRenamer, WithProjectStore, WithSessionCreator, WithDirLister) wire correctly.\n\n**Outcome**: cmd/open.go correctly constructs and runs the new TUI model. All launch configurations work end-to-end.\n\n**Do**:\n- In cmd/open.go, update openTUI to match new model API\n- Ensure WithCommand(command) called when len(command) \u003e 0\n- Ensure WithInitialFilter(filter) called when filter \\!= \"\"\n- Ensure WithInsideTmux(sessionName) called when inside tmux\n- Verify model.Selected() returns correct session name for connector\n- Verify clean exit (quit without selecting) returns \"\" and nil error\n- Ensure tea.NewProgram with tea.WithAltScreen() preserved\n\n**Acceptance Criteria**:\n- [ ] openTUI(\"\", nil) launches TUI with no command and no filter\n- [ ] openTUI(\"\", []string{\"claude\"}) launches TUI in command-pending mode\n- [ ] openTUI(\"myapp\", nil) launches TUI with initial filter\n- [ ] openTUI(\"myapp\", []string{\"claude\"}) launches with both filter and command\n- [ ] Inside-tmux detection and current session name passed to model\n- [ ] Selected() return value used for session attachment\n- [ ] Clean exit returns nil error\n- [ ] All functional options wired correctly\n\n**Tests**:\n- \"openTUI with no command and no filter creates default model\"\n- \"openTUI with command creates model in command-pending mode\"\n- \"openTUI with filter creates model with initial filter\"\n- \"openTUI with command and filter combines both\"\n- \"clean exit without selection returns nil\"\n- \"selected session name forwarded to connector\"\n\n**Spec Reference**: .workflows/specification/tui-session-picker/specification.md","parent":"tick-68f174","created":"2026-02-28T09:21:50Z","updated":"2026-03-01T11:36:22Z","closed":"2026-03-01T11:36:22Z"}
{"id":"tick-dfe7e0","title":"Phase 4: Analysis (Cycle 1)","status":"open","priority":2,"parent":"tick-dd35bb","created":"2026-03-01T11:51:51Z","updated":"2026-03-01T11:51:51Z"}
{"id":"tick-d2056e","title":"Replace ANSI-unaware placeOverlay with lipgloss.Place","status":"done","priority":2,"description":"**Problem**: `placeOverlay` in `internal/tui/modal.go:37-67` operates on raw runes, treating each rune as one display column. ANSI escape sequences from lipgloss styling (bold session names, colored attached badges, modal borders) are zero-width on screen but occupy runes in the string. This causes the modal overlay to misalign horizontally when composited over styled background content. The specification explicitly states modals should use `lipgloss.Place()` for positioning.\n\n**Solution**: Replace the custom `placeOverlay` function with `lipgloss.Place()` for centering the modal content over the list view. The `renderModal` function should use lipgloss's ANSI-aware layout primitives instead of manual rune-based compositing.\n\n**Outcome**: Modal overlays render correctly centered regardless of ANSI styling in the background content. The custom `placeOverlay` function is removed entirely.\n\n**Do**:\n1. In `internal/tui/modal.go`, modify `renderModal` to use `lipgloss.Place(width, height, lipgloss.Center, lipgloss.Center, styledModal, lipgloss.WithWhitespaceChars(\" \"))` or equivalent lipgloss centering to position the modal\n2. If lipgloss.Place does not support compositing over existing content, use `lipgloss.PlaceHorizontal` and `lipgloss.PlaceVertical` with the styled modal, then overlay that onto the background using ANSI-aware width measurement (`lipgloss.Width()`) instead of `len([]rune(...))`\n3. Delete the `placeOverlay` function\n4. Verify existing modal tests still pass\n5. Manually verify modals display correctly over styled session and project lists\n\n**Acceptance Criteria**:\n- `placeOverlay` function is removed from `internal/tui/modal.go`\n- `renderModal` uses lipgloss layout functions for positioning\n- All existing modal-related tests pass without modification\n- Modal overlays center correctly over styled list content\n\n**Tests**:\n- Existing tests in model_test.go covering kill confirmation, rename, delete, and edit modals continue to pass\n- Add a test that renders a modal over content containing ANSI escape sequences and verifies the modal is horizontally centered (using lipgloss.Width for measurement)","parent":"tick-dfe7e0","created":"2026-03-01T11:52:09Z","updated":"2026-03-01T12:05:52Z","closed":"2026-03-01T12:05:52Z"}
{"id":"tick-6fac0d","title":"Unify duplicated modal dispatch into single method","status":"in_progress","priority":2,"description":"**Problem**: `updateModal` (line 980) and `updateProjectModal` (line 704) in `internal/tui/model.go` are structural clones -- both check for Ctrl+C quit, then switch on `m.modal` to dispatch to specific modal handlers. The only difference is which modal constants they handle. Since `modalState` is a single shared enum, a new modal type requires edits in two places.\n\n**Solution**: Merge into a single `updateModal` method that handles all modal states (kill, rename, deleteProject, editProject). Both `updateSessionList` and `updateProjectsPage` call the same unified dispatcher.\n\n**Outcome**: One modal dispatch point. Adding a new modal type requires a single switch case addition.\n\n**Do**:\n1. In `internal/tui/model.go`, merge the body of `updateProjectModal` into `updateModal` by adding cases for `modalDeleteProject` and `modalEditProject` to the existing switch\n2. Delete `updateProjectModal`\n3. Update `updateProjectsPage` (the caller of `updateProjectModal`) to call `updateModal` instead\n4. Verify the Ctrl+C guard appears exactly once in the unified method\n5. Run all tests\n\n**Acceptance Criteria**:\n- Only one modal dispatch method exists (`updateModal`)\n- `updateProjectModal` is deleted\n- The unified method handles all four modal states: `modalKillConfirm`, `modalRename`, `modalDeleteProject`, `modalEditProject`\n- All existing tests pass\n\n**Tests**:\n- All existing modal tests (kill, rename, delete project, edit project) pass unchanged\n- Ctrl+C during any modal state still triggers quit","parent":"tick-dfe7e0","created":"2026-03-01T11:52:19Z","updated":"2026-03-01T12:05:55Z"}
{"id":"tick-f56bab","title":"Extract shared view-list-with-modal rendering helper","status":"open","priority":2,"description":"**Problem**: `viewProjectList` (lines 1123-1143) and `viewSessionList` (lines 1193-1214) in `internal/tui/model.go` share identical structure: get list view string, extract width/height with fallback to 80x24 when zero, then switch on modal state to overlay content. The dimension-fallback block is duplicated verbatim.\n\n**Solution**: Extract a helper function that takes a `list.Model` and a function that returns optional modal content, handles the dimension fallback, and applies the modal overlay if present.\n\n**Outcome**: Dimension-fallback logic exists in one place. Adding a new modal type on either page only requires updating the modal content provider.\n\n**Do**:\n1. Create a helper method on Model (or a standalone function) like `renderListWithModal(l list.Model, modalContent string, hasModal bool) string` that: gets `l.View()`, extracts width/height with 80/24 fallback, and calls `renderModal` if `hasModal` is true\n2. Refactor `viewSessionList` to compute its modal content and call the helper\n3. Refactor `viewProjectList` to compute its modal content and call the helper\n4. Run all tests\n\n**Acceptance Criteria**:\n- Dimension-fallback logic (w==0 -\u003e 80, h==0 -\u003e 24) appears exactly once\n- `viewSessionList` and `viewProjectList` delegate to the shared helper\n- All existing tests pass\n\n**Tests**:\n- All existing view rendering tests pass unchanged\n- Modal overlay tests for both pages continue to produce correct output","parent":"tick-dfe7e0","created":"2026-03-01T11:52:29Z","updated":"2026-03-01T11:52:29Z"}
{"id":"tick-dad932","title":"Eliminate duplicated window-label pluralization in SessionDelegate.Render","status":"open","priority":2,"description":"**Problem**: Window count pluralization logic is implemented identically in both `SessionItem.Description()` (lines 39-42) and `SessionDelegate.Render()` (lines 80-83) in `internal/tui/session_item.go`. The `Description()` method already computes the correct label, but `Render()` re-derives it independently.\n\n**Solution**: Have `SessionDelegate.Render()` use the already-computed description logic rather than re-implementing it. Either call a shared helper or restructure so the pluralization exists once.\n\n**Outcome**: Window-label pluralization logic exists in exactly one place. Changes to the label format only require one edit.\n\n**Do**:\n1. In `internal/tui/session_item.go`, extract a `windowLabel(count int) string` function that returns the pluralized string\n2. Update `SessionItem.Description()` to call `windowLabel(i.Session.Windows)`\n3. Update `SessionDelegate.Render()` to call `windowLabel(si.Session.Windows)` and apply `detailStyle.Render()` to the result\n4. Run all tests\n\n**Acceptance Criteria**:\n- Pluralization logic (`\\\"%d windows\\\"` with special case for 1) appears exactly once\n- `Description()` and `Render()` both use the shared helper\n- All existing session item and delegate tests pass\n\n**Tests**:\n- Existing tests for SessionItem.Description and SessionDelegate.Render pass unchanged\n- Verify that `windowLabel(1)` returns \"1 window\" and `windowLabel(3)` returns \"3 windows\"","parent":"tick-dfe7e0","created":"2026-03-01T11:52:37Z","updated":"2026-03-01T11:52:37Z"}
{"id":"tick-717ebc","title":"Fix command-pending status line position to below title","status":"open","priority":2,"description":"**Problem**: In `internal/tui/model.go:1106-1113`, the command-pending status line (\"Select project to run: {command}\") is prepended before the project list view, causing it to render above the \"Projects\" title. The spec states: \"Title stays 'Projects' for consistency\" and \"A status line below the title indicates the pending command\".\n\n**Solution**: Move the status line so it appears below the list title rather than above it. This can be done by setting the status line as the list's subtitle or by injecting it after the title row in the rendered output.\n\n**Outcome**: When in command-pending mode, the rendering order is: \"Projects\" title, then status line, then list items -- matching the specification.\n\n**Do**:\n1. In `internal/tui/model.go`, in the `View()` method's `commandPending` branch (lines 1106-1113), instead of prepending the status line before `viewProjectList()`, set the status message on the project list model before rendering (e.g., use `m.projectList.NewStatusMessage()` or set a subtitle-style field)\n2. If bubbles/list does not support subtitle injection, split the list View output string at the first newline (title line) and insert the status line after it\n3. Remove the current `strings.Builder` prepend approach\n4. Run all tests\n\n**Acceptance Criteria**:\n- In command-pending mode, the \"Projects\" title renders first, followed by the status line, followed by list items\n- The status line text remains \"Select project to run: {command}\"\n- All existing command-pending tests pass\n\n**Tests**:\n- Existing command-pending view tests pass (may need assertion updates if they checked the old ordering)\n- Add or update a test that verifies the status line appears after the title line in the rendered output","parent":"tick-dfe7e0","created":"2026-03-01T11:52:49Z","updated":"2026-03-01T11:52:49Z"}
